!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.webglRenderEngine=e():t.webglRenderEngine=e()}(window,(function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=15)}([function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}},function(t,e){function r(e){return t.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},r(e)}t.exports=r},function(t,e,r){var n=r(8),i=r(9);t.exports=function(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?i(t):e}},function(t,e,r){var n=r(10);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}},function(t,e){t.exports=function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}},function(t,e,r){var n=r(11);function i(e,r,a){return"undefined"!=typeof Reflect&&Reflect.get?t.exports=i=Reflect.get:t.exports=i=function(t,e,r){var i=n(t,e);if(i){var a=Object.getOwnPropertyDescriptor(i,e);return a.get?a.get.call(r):a.value}},i(e,r,a||e)}t.exports=i},function(t,e,r){var n=r(12),i=r(13),a=r(14);t.exports=function(t){return n(t)||i(t)||a()}},function(t,e){function r(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=r=function(t){return typeof t}:t.exports=r=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(e)}t.exports=r},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e){function r(e,n){return t.exports=r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},r(e,n)}t.exports=r},function(t,e,r){var n=r(2);t.exports=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=n(t)););return t}},function(t,e){t.exports=function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}},function(t,e){t.exports=function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(t,e,r){"use strict";r.r(e);var n={};r.r(n),r.d(n,"GL_DRAW_MODE_POINTS",(function(){return l})),r.d(n,"GL_DRAW_MODE_LINES",(function(){return c})),r.d(n,"GL_DRAW_MODE_LINE_STRIP",(function(){return f})),r.d(n,"GL_DRAW_MODE_LINE_LOOP",(function(){return m})),r.d(n,"GL_DRAW_MODE_TRIANGLES",(function(){return d})),r.d(n,"GL_DRAW_MODE_TRIANGLE_STRIP",(function(){return v})),r.d(n,"GL_DRAW_MODE_TRIANGLE_FAN",(function(){return y})),r.d(n,"OBJECT_TYPE_MESH",(function(){return p})),r.d(n,"OBJECT_TYPE_PERSPECTIVE_CAMERA",(function(){return g})),r.d(n,"OBJECT_TYPE_ORTHOGRAPHIC_CAMERA",(function(){return _})),r.d(n,"OBJECT_TYPE_LINE",(function(){return x})),r.d(n,"OBJECT_TYPE_LINE_SEGMENTS",(function(){return M})),r.d(n,"OBJECT_TYPE_LINE_LOOP",(function(){return b})),r.d(n,"OBJECT_TYPE_POINTS",(function(){return k})),r.d(n,"OBJECT_TYPE_GROUP",(function(){return w})),r.d(n,"OBJECT_TYPE_SCENE",(function(){return A})),r.d(n,"MATERIAL_TYPE_BASIC",(function(){return T})),r.d(n,"MATERIAL_TYPE_LINE_BASIC",(function(){return z})),r.d(n,"LINEAR_INTERPOLATION",(function(){return E})),r.d(n,"STEP_INTERPOLATION",(function(){return S})),r.d(n,"CUBIC_SPLINE_INTERPOLATION",(function(){return P}));var i={};r.r(i),r.d(i,"clamp",(function(){return O})),r.d(i,"degToRad",(function(){return R})),r.d(i,"radToDeg",(function(){return F})),r.d(i,"arrayMax",(function(){return L})),r.d(i,"generateUid",(function(){return j}));var a=r(0),o=r.n(a),s=r(1),u=r.n(s),h=function(){function t(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];o()(this,t),this._autoStart=e,this._startTime=0,this._prevTime=0,this._elapsedTime=0}return u()(t,[{key:"now",value:function(){return(performance||Date).now()}},{key:"start",value:function(){this._startTime=this.now(),this._prevTime=this._startTime,this._elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getDeltaTime(),this.running=!1}},{key:"getDeltaTime",value:function(){var t=0;if(!this.running&&this._autoStart)return this.start(),t;if(this.running){var e=this.now();t=(e-this._prevTime)/1e3,this._prevTime=e,this._elapsedTime+=t}return t}},{key:"getElapsedTime",value:function(){return this.getDeltaTime(),this._elapsedTime}}]),t}(),l=0,c=1,f=2,m=3,d=4,v=5,y=6,p=0,g=1,_=2,x=3,M=4,b=5,k=7,w=8,A=9,T="BasicMaterial",z="LineBasicMaterial",E=2020,S=2021,P=2022,I=Math.PI/180,C=180/Math.PI;function O(t,e,r){return Math.min(r,Math.max(e,t))}function R(t){return t*I}function F(t){return t*C}function L(t){if(0===t.length)return-1/0;for(var e=t[0],r=1,n=t.length;r<n;r++)t[r]>e&&(e=t[r]);return e}var N=0;function j(){return N++}var U=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2?arguments[2]:void 0;o()(this,t),this.name=e,this.duration=r,this.tracks=n,this.uid=j(),this.duration<0&&this.setDurationFromTracks()}return u()(t,[{key:"setDurationFromTracks",value:function(){for(var t=this.tracks,e=0,r=0,n=t.length;r<n;r++){var i=t[r];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this}}]),t}(),B=function(){function t(e){o()(this,t),this._time=0,this._clips=e,this.timeScale=1}return u()(t,[{key:"update",value:function(t){t*=this.timeScale,this._time+=t;for(var e=this._time,r=this._clips,n=0,i=r.length;n<i;n++){var a=r[n],o=a.tracks;e%=a.duration;for(var s=0,u=o.length;s<u;s++){var h=o[s],l=h.node,c=h.property,f=h.interpolant.evaluate(e);f&&("morphTargetInfluences"===c?l[c]=f:l[c].setFromArray(f))}}}},{key:"destroy",value:function(){}}]),t}(),D=r(3),V=r.n(D),G=r(2),W=r.n(G),Y=r(4),H=r.n(Y),q=function(){function t(e,r,n){o()(this,t),this.xArray=e,this.yArray=r,this.ySize=n}return u()(t,[{key:"evaluate",value:function(t){for(var e,r,n,i=this.xArray,a=0,o=i.length;a<o;a++){if(t===i[a]){0===a?(e=a+1,r=i[a],n=i[e]):(e=a,r=i[a-1],n=i[e]);break}if(t>i[a]&&t<i[a+1]){e=a+1,r=i[a],n=i[e];break}}return void 0!==e&&void 0!==r&&void 0!==n?this._interpolate(e,r,t,n):null}}]),t}(),X=function(t){function e(){return o()(this,e),V()(this,W()(e).apply(this,arguments))}return H()(e,t),u()(e,[{key:"_interpolate",value:function(t,e,r,n){for(var i=this.yArray,a=this.ySize,o=new i.constructor(a),s=t*a,u=s-a,h=(r-e)/(n-e),l=1-h,c=0,f=o.length;c<f;c++)o[c]=i[u+c]*l+i[s+c]*h;return o}}]),e}(q),Z=function(t){function e(){return o()(this,e),V()(this,W()(e).apply(this,arguments))}return H()(e,t),u()(e,[{key:"_interpolate",value:function(t){for(var e=this.yArray,r=this.ySize,n=new e.constructor(r),i=t*r,a=0,o=n.length;a<o;a++)n[a]=e[i+a];return n}}]),e}(q),K=function(t){function e(){return o()(this,e),V()(this,W()(e).apply(this,arguments))}return H()(e,t),u()(e,[{key:"_interpolate",value:function(t,e,r,n){var i=this.xArray,a=this.yArray,o=this.ySize,s=new a.constructor(o),u=t-2,h=t+1,l=i[u],c=i[h];void 0===l&&(u=t,l=n),void 0===c&&(h=t-1,c=e);for(var f=(r-e)/(n-e),m=f*f,d=m*f,v=(e-n)/(e-l)*.5,y=(e-n)/(c-n)*.5,p=-(d-2*m+f)*v,g=(1+v)*d+(-1.5-2*v)*m+(-.5+v)*f+1,_=(-1-y)*d+(1.5+y)*m+.5*f,x=y*d-y*m,M=u*o,b=t*o,k=b-o,w=h*o,A=0;A<o;A++)s[A]=p*a[M+A]+g*a[k+A]+_*a[b+A]+x*a[w+A];return s}}]),e}(q),Q=function(){function t(e,r,n,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:E;o()(this,t),this.node=e,this.property=r,this.name=e.name+"."+r,this.times=n,this.values=i,this.setInterpolant(a)}return u()(t,[{key:"getValueSize",value:function(){return this.values.length/this.times.length}},{key:"createLinearInterpolant",value:function(){return new X(this.times,this.values,this.getValueSize())}},{key:"createStepInterpolant",value:function(){return new Z(this.times,this.values,this.getValueSize())}},{key:"createCubicSplineInterpolant",value:function(){return new K(this.times,this.values,this.getValueSize())}},{key:"setInterpolant",value:function(t){var e;void 0===this.createInterpolant&&(t===E?e=this.createLinearInterpolant:t===S?e=this.createStepInterpolant:t===P&&(e=this.createCubicSplineInterpolant),this.createInterpolant=e);this.interpolant=this.createInterpolant()}}]),t}(),J=function(t){function e(){return o()(this,e),V()(this,W()(e).apply(this,arguments))}return H()(e,t),e}(Q),$=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;o()(this,t),this._x=e,this._y=r,this._z=n,this._w=i}return u()(t,[{key:"set",value:function(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._w=n,this}},{key:"copy",value:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this}},{key:"setFromArray",value:function(t){this._x=t[0],this._y=t[1],this._z=t[2],this._w=t[3]}},{key:"setFromEuler",value:function(t){var e=t.x,r=t.y,n=t.z,i=t.order,a=Math.cos(e/2),o=Math.cos(r/2),s=Math.cos(n/2),u=Math.sin(e/2),h=Math.sin(r/2),l=Math.sin(n/2);return"XYZ"===i?(this._x=u*o*s+a*h*l,this._y=a*h*s-u*o*l,this._z=a*o*l+u*h*s,this._w=a*o*s-u*h*l):"YXZ"===i?(this._x=u*o*s+a*h*l,this._y=a*h*s-u*o*l,this._z=a*o*l-u*h*s,this._w=a*o*s+u*h*l):"ZXY"===i?(this._x=u*o*s-a*h*l,this._y=a*h*s+u*o*l,this._z=a*o*l+u*h*s,this._w=a*o*s-u*h*l):"ZYX"===i?(this._x=u*o*s-a*h*l,this._y=a*h*s+u*o*l,this._z=a*o*l-u*h*s,this._w=a*o*s+u*h*l):"YZX"===i?(this._x=u*o*s+a*h*l,this._y=a*h*s+u*o*l,this._z=a*o*l-u*h*s,this._w=a*o*s-u*h*l):"XZY"===i&&(this._x=u*o*s-a*h*l,this._y=a*h*s-u*o*l,this._z=a*o*l+u*h*s,this._w=a*o*s+u*h*l),this}},{key:"setFromAxisAngle",value:function(t,e){var r=e/2,n=Math.sin(r),i=Math.cos(r);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=i,this}},{key:"setFromRotationMatrix",value:function(t){var e,r=t.elements,n=r[0],i=r[4],a=r[8],o=r[1],s=r[5],u=r[9],h=r[2],l=r[6],c=r[10],f=n+s+c;return f>0?(e=.5/Math.sqrt(f+1),this._w=.25/e,this._x=(l-u)*e,this._y=(a-h)*e,this._z=(o-i)*e):n>s&&n>c?(e=2*Math.sqrt(1+n-s-c),this._w=(l-u)/e,this._x=.25*e,this._y=(i+o)/e,this._z=(a+h)/e):s>c?(e=2*Math.sqrt(1+s-n-c),this._w=(a-h)/e,this._x=(i+o)/e,this._y=.25*e,this._z=(u+l)/e):(e=2*Math.sqrt(1+c-n-s),this._w=(o-i)/e,this._x=(a+h)/e,this._y=(u+l)/e,this._z=.25*e),this}},{key:"setFromQuaternionsProduct",value:function(t,e){var r=t.x,n=t.y,i=t.z,a=t.w,o=e.x,s=e.y,u=e.z,h=e.w;return this._x=r*h+a*o+n*u-i*s,this._y=n*h+a*s+i*o-r*u,this._z=i*h+a*u+r*s-n*o,this._w=a*h-r*o-n*s-i*u,this}},{key:"conjugate",value:function(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this}},{key:"multiply",value:function(t){return this.setFromQuaternionsProduct(this,t)}},{key:"premultiply",value:function(t){return this.setFromQuaternionsProduct(t,this)}},{key:"inverse",value:function(){return this.conjugate()}},{key:"dot",value:function(t){return this._x*t.x+this._y*t.y+this._z*t.z+this._w*t.w}},{key:"lengthSquared",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"normalize",value:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(this._x/=t,this._y/=t,this._z/=t,this._w/=t),this}},{key:"slerp",value:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var r=this._x,n=this._y,i=this._z,a=this._w,o=a*t.w+r*t.x+n*t.y+i*t.z;if(o>=1)return this;o<0?(this._x=-t.x,this._y=-t.y,this._z=-t.z,this._w=-t.w,o=-o):this.copy(t);var s=Math.sqrt(1-o*o);if(s<=Number.EPSILON){var u=1-e;return this._w=u*a+e*this._w,this._x=u*r+e*this._x,this._y=u*n+e*this._y,this._z=u*i+e*this._z,this.normalize()}var h=Math.atan2(s,o),l=Math.sin((1-e)*h)/s,c=Math.sin(e*h)/s;return this._w=l*a+c*this._w,this._x=l*r+c*this._x,this._y=l*n+c*this._y,this._z=l*i+c*this._z,this}},{key:"x",get:function(){return this._x},set:function(t){this._x=t}},{key:"y",get:function(){return this._y},set:function(t){this._y=t}},{key:"z",get:function(){return this._z},set:function(t){this._z=t}},{key:"w",get:function(){return this._w},set:function(t){this._w=t}}],[{key:"slerp",value:function(t,e,r,n){return r.copy(t).slerp(e,n)}},{key:"slerpFlat",value:function(t,e,r,n,i,a,o){var s=r[n+0],u=r[n+1],h=r[n+2],l=r[n+3],c=i[a+0],f=i[a+1],m=i[a+2],d=i[a+3];if(l!==d||s!==c||u!==f||h!==m){var v=1-o,y=s*c+u*f+h*m+l*d,p=y>=0?1:-1,g=1-y*y;if(g>Number.EPSILON){var _=Math.sqrt(g),x=Math.atan2(_,y*p);v=Math.sin(v*x)/_,o=Math.sin(o*x)/_}var M=o*p;if(s=s*v+c*M,u=u*v+f*M,h=h*v+m*M,l=l*v+d*M,v===1-o){var b=1/Math.sqrt(s*s+u*u+h*h+l*l);s*=b,u*=b,h*=b,l*=b}}t[e+0]=s,t[e+1]=u,t[e+2]=h,t[e+3]=l}}]),t}(),tt=function(t){function e(){return o()(this,e),V()(this,W()(e).apply(this,arguments))}return H()(e,t),u()(e,[{key:"_interpolate",value:function(t,e,r,n){var i=this.yArray,a=this.ySize,o=t*a,s=(r-e)/(n-e),u=new i.constructor(a);return $.slerpFlat(u,0,i,o-a,i,o,s),u}}]),e}(q),et=function(t){function e(){return o()(this,e),V()(this,W()(e).apply(this,arguments))}return H()(e,t),u()(e,[{key:"createLinearInterpolant",value:function(){return new tt(this.times,this.values,this.getValueSize())}}]),e}(Q),rt=function(t){function e(){return o()(this,e),V()(this,W()(e).apply(this,arguments))}return H()(e,t),e}(Q),nt=r(6),it=r.n(nt),at=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;o()(this,t),this.x=e,this.y=r,this.z=n}return u()(t,[{key:"set",value:function(t,e,r){return this.x=t,this.y=e,this.z=r,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"setFromScalar",value:function(t){return this.x=t,this.y=t,this.z=t,this}},{key:"setFromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}},{key:"setFromVectorsSum",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}},{key:"setFromVectorsDiff",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}},{key:"setFromMatrixPosition",value:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}},{key:"setFromMatrix4Column",value:function(t,e){return this.setFromArray(t.elements,4*e)}},{key:"setFromMatrix3Column",value:function(t,e){return this.setFromArray(t.elements,3*e)}},{key:"getComponent",value:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("Vec3: 索引".concat(t,"超过边界"))}}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"subScalar",value:function(t){return this.addScalar(-t)}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"applyMatrix4",value:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements,a=1/(i[3]*e+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*e+i[4]*r+i[8]*n+i[12])*a,this.y=(i[1]*e+i[5]*r+i[9]*n+i[13])*a,this.z=(i[2]*e+i[6]*r+i[10]*n+i[14])*a,this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"cross",value:function(t){return this.setFromVectorsCross(this,t)}},{key:"setFromVectorsCross",value:function(t,e){var r=t.x,n=t.y,i=t.z,a=e.x,o=e.y,s=e.z;return this.x=n*s-i*o,this.y=i*a-r*s,this.z=r*o-n*a,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"setFromSphericalCoords",value:function(t,e,r){var n=Math.sin(e);return this.x=n*Math.sin(r)*t,this.y=Math.cos(e)*t,this.z=n*Math.cos(r)*t,this}},{key:"setFromSpherical",value:function(t){return this.setFromSphericalCoords(t.radius,t.theta,t.phi)}},{key:"setFromBufferAttribute",value:function(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}},{key:"project",value:function(t){return this.applyMatrix4(t.worldMatrixInverse).applyMatrix4(t.projectionMatrix)}},{key:"unproject",value:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.worldMatrix)}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}}]),t}(),ot=function(){function t(e){if(o()(this,t),e){for(var r=new Array(16),n=0;n<16;n++)r[n]=e[n];this.elements=r}else this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}return u()(t,[{key:"copy",value:function(t){var e=t.elements,r=this.elements;if(e!==r){for(var n=0;n<16;++n)r[n]=e[n];return this}}},{key:"set",value:function(t,e,r,n,i,a,o,s,u,h,l,c,f,m,d,v){var y=this.elements;return y[0]=t,y[4]=e,y[8]=r,y[12]=n,y[1]=i,y[5]=a,y[9]=o,y[13]=s,y[2]=u,y[6]=h,y[10]=l,y[14]=c,y[3]=f,y[7]=m,y[11]=d,y[15]=v,this}},{key:"setFromArray",value:function(t){for(var e=this.elements,r=0;r<16;++r)e[r]=t[r];return this}},{key:"multiply",value:function(t){return this.multiplyMatrices(this,t)}},{key:"premultiply",value:function(t){return this.multiplyMatrices(t,this)}},{key:"multiplyMatrices",value:function(t,e){var r=t.elements,n=e.elements,i=this.elements,a=r[0],o=r[4],s=r[8],u=r[12],h=r[1],l=r[5],c=r[9],f=r[13],m=r[2],d=r[6],v=r[10],y=r[14],p=r[3],g=r[7],_=r[11],x=r[15],M=n[0],b=n[4],k=n[8],w=n[12],A=n[1],T=n[5],z=n[9],E=n[13],S=n[2],P=n[6],I=n[10],C=n[14],O=n[3],R=n[7],F=n[11],L=n[15];return i[0]=a*M+o*A+s*S+u*O,i[4]=a*b+o*T+s*P+u*R,i[8]=a*k+o*z+s*I+u*F,i[12]=a*w+o*E+s*C+u*L,i[1]=h*M+l*A+c*S+f*O,i[5]=h*b+l*T+c*P+f*R,i[9]=h*k+l*z+c*I+f*F,i[13]=h*w+l*E+c*C+f*L,i[2]=m*M+d*A+v*S+y*O,i[6]=m*b+d*T+v*P+y*R,i[10]=m*k+d*z+v*I+y*F,i[14]=m*w+d*E+v*C+y*L,i[3]=p*M+g*A+_*S+x*O,i[7]=p*b+g*T+_*P+x*R,i[11]=p*k+g*z+_*I+x*F,i[15]=p*w+g*E+_*C+x*L,this}},{key:"determinant",value:function(){var t=this.elements,e=t[0],r=t[4],n=t[8],i=t[12],a=t[1],o=t[5],s=t[9],u=t[13],h=t[2],l=t[6],c=t[10],f=t[14],m=t[3],d=t[7],v=t[11],y=t[15];return i*s*l*m-n*u*l*m-i*o*c*m+r*u*c*m+n*o*f*m-r*s*f*m-i*s*h*d+n*u*h*d+i*a*c*d-e*u*c*d-n*a*f*d+e*s*f*d+i*o*h*v-r*u*h*v-i*a*l*v+e*u*l*v+r*a*f*v-e*o*f*v-n*o*h*y+r*s*h*y+n*a*l*y-e*s*l*y-r*a*c*y+e*o*c*y}},{key:"setInverseOf",value:function(t){var e=this.elements,r=t.elements,n=r[0],i=r[4],a=r[8],o=r[12],s=r[1],u=r[5],h=r[9],l=r[13],c=r[2],f=r[6],m=r[10],d=r[14],v=r[3],y=r[7],p=r[11],g=r[15],_=t.determinant();return e[0]=(h*d*y-l*m*y+l*f*p-u*d*p-h*f*g+u*m*g)/_,e[4]=(o*m*y-a*d*y-o*f*p+i*d*p+a*f*g-i*m*g)/_,e[8]=(a*l*y-o*h*y+o*u*p-i*l*p-a*u*g+i*h*g)/_,e[12]=(o*h*f-a*l*f-o*u*m+i*l*m+a*u*d-i*h*d)/_,e[1]=(l*m*v-h*d*v-l*c*p+s*d*p+h*c*g-s*m*g)/_,e[5]=(a*d*v-o*m*v+o*c*p-n*d*p-a*c*g+n*m*g)/_,e[9]=(o*h*v-a*l*v-o*s*p+n*l*p+a*s*g-n*h*g)/_,e[13]=(a*l*c-o*h*c+o*s*m-n*l*m-a*s*d+n*h*d)/_,e[2]=(u*d*v-l*f*v+l*c*y-s*d*y-u*c*g+s*f*g)/_,e[6]=(o*f*v-i*d*v-o*c*y+n*d*y+i*c*g-n*f*g)/_,e[10]=(i*l*v-o*u*v+o*s*y-n*l*y-i*s*g+n*u*g)/_,e[14]=(o*u*c-i*l*c-o*s*f+n*l*f+i*s*d-n*u*d)/_,e[3]=(h*f*v-u*m*v-h*c*y+s*m*y+u*c*p-s*f*p)/_,e[7]=(i*m*v-a*f*v+a*c*y-n*m*y-i*c*p+n*f*p)/_,e[11]=(a*u*v-i*h*v-a*s*y+n*h*y+i*s*p-n*u*p)/_,e[15]=(i*h*c-a*u*c+a*s*f-n*h*f-i*s*m+n*u*m)/_,this}},{key:"transpose",value:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}},{key:"setBasis",value:function(){}},{key:"setRotationFromEuler",value:function(t){var e=this.elements,r=t.x,n=t.y,i=t.z,a=Math.cos(r),o=Math.sin(r),s=Math.cos(n),u=Math.sin(n),h=Math.cos(i),l=Math.sin(i);if("XYZ"===t.order){var c=a*h,f=a*l,m=o*h,d=o*l;e[0]=s*h,e[4]=-s*l,e[8]=u,e[1]=f+m*u,e[5]=c-d*u,e[9]=-o*s,e[2]=d-c*u,e[6]=m+f*u,e[10]=a*s}else if("YXZ"===t.order){var v=s*h,y=s*l,p=u*h,g=u*l;e[0]=v+g*o,e[4]=p*o-y,e[8]=a*u,e[1]=a*l,e[5]=a*h,e[9]=-o,e[2]=y*o-p,e[6]=g+v*o,e[10]=a*s}else if("ZXY"===t.order){var _=s*h,x=s*l,M=u*h,b=u*l;e[0]=_-b*o,e[4]=-a*l,e[8]=M+x*o,e[1]=x+M*o,e[5]=a*h,e[9]=b-_*o,e[2]=-a*u,e[6]=o,e[10]=a*s}else if("ZYX"===t.order){var k=a*h,w=a*l,A=o*h,T=o*l;e[0]=s*h,e[4]=A*u-w,e[8]=k*u+T,e[1]=s*l,e[5]=T*u+k,e[9]=w*u-A,e[2]=-u,e[6]=o*s,e[10]=a*s}else if("YZX"===t.order){var z=a*s,E=a*u,S=o*s,P=o*u;e[0]=s*h,e[4]=P-z*l,e[8]=S*l+E,e[1]=l,e[5]=a*h,e[9]=-o*h,e[2]=-u*h,e[6]=E*l+S,e[10]=z-P*l}else if("XZY"===t.order){var I=a*s,C=a*u,O=o*s,R=o*u;e[0]=s*h,e[4]=-l,e[8]=u*h,e[1]=I*l+R,e[5]=a*h,e[9]=C*l-O,e[2]=O*l-C,e[6]=o*h,e[10]=R*l+I}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}},{key:"setRotationFromQauternion",value:function(t){return this.compose(ft,t,mt)}},{key:"setRotationFromAxisAngle",value:function(t,e){}},{key:"setRotationX",value:function(){}},{key:"setRotationY",value:function(){}},{key:"setRotationZ",value:function(){}},{key:"translate",value:function(t,e,r){var n=this.elements;return n[12]+=n[0]*t+n[4]*e+n[8]*r,n[13]+=n[1]*t+n[5]*e+n[9]*r,n[14]+=n[2]*t+n[6]*e+n[10]*r,n[15]+=n[3]*t+n[7]*e+n[11]*r,this}},{key:"setTranslate",value:function(t,e,r){return this.set(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1)}},{key:"scale",value:function(t,e,r){var n=this.elements;return n[0]*=t,n[4]*=e,n[8]*=r,n[1]*=t,n[5]*=e,n[9]*=r,n[2]*=t,n[6]*=e,n[10]*=r,n[3]*=t,n[7]*=e,n[11]*=r,this}},{key:"setScale",value:function(t,e,r){return this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1)}},{key:"lookAt",value:function(t,e,r){var n=this.elements;return lt.setFromVectorsDiff(t,e),0===lt.lengthSquared()&&(lt.z=1),lt.normalize(),ut.setFromVectorsCross(r,lt),0===ut.lengthSquared()&&(1===Math.abs(r.z)?lt.x+=1e-4:lt.z+=1e-4,lt.normalize(),ut.setFromVectorsCross(r,lt)),ut.normalize(),ht.setFromVectorsCross(lt,ut),n[0]=ut.x,n[4]=ht.x,n[8]=lt.x,n[1]=ut.y,n[5]=ht.y,n[9]=lt.y,n[2]=ut.z,n[6]=ht.z,n[10]=lt.z,this}},{key:"setPerspective",value:function(t,e,r,n,i,a){var o=this.elements;return o[0]=2*i/(e-t),o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*i/(r-n),o[6]=0,o[7]=0,o[8]=(e+t)/(e-t),o[9]=(r+n)/(r-n),o[10]=-(a+i)/(a-i),o[11]=-1,o[12]=0,o[13]=0,o[14]=-2*i*a/(a-i),o[15]=0,this}},{key:"setOrthographic",value:function(t,e,r,n,i,a){var o=this.elements;return o[0]=2/(e-t),o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2/(r-n),o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=-2/(a-i),o[11]=0,o[12]=-(e+t)/(e-t),o[13]=-(r+n)/(r-n),o[14]=-(a+i)/(a-i),o[15]=1,this}},{key:"compose",value:function(t,e,r){var n=this.elements,i=e.x,a=e.y,o=e.z,s=e.w,u=r.x,h=r.y,l=r.z;return n[0]=(1-2*a*a-2*o*o)*u,n[1]=(2*i*a+2*o*s)*u,n[2]=(2*i*o-2*a*s)*u,n[3]=0,n[4]=(2*i*a-2*o*s)*h,n[5]=(1-2*i*i-2*o*o)*h,n[6]=(2*a*o+2*i*s)*h,n[7]=0,n[8]=(2*i*o+2*a*s)*l,n[9]=(2*a*o-2*i*s)*l,n[10]=(1-2*i*i-2*a*a)*l,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}},{key:"decompose",value:function(t,e,r){var n=this.elements,i=st.set(n[0],n[1],n[2]).length(),a=st.set(n[4],n[5],n[6]).length(),o=st.set(n[8],n[9],n[10]).length();r.set(i,a,o),t.set(n[12],n[13],n[14]),ct.copy(this);var s=ct.elements;return s[0]/=i,s[1]/=i,s[2]/=i,s[4]/=a,s[5]/=a,s[6]/=a,s[8]/=o,s[9]/=o,s[10]/=o,e.setFromRotationMatrix(ct),this}},{key:"extractRotation",value:function(t){var e=this.elements,r=t.elements,n=st.set(r[0],r[1],r[2]).length(),i=st.set(r[4],r[5],r[6]).length(),a=st.set(r[8],r[9],r[10]).length();return e[0]=r[0]/n,e[4]=r[4]/i,e[8]=r[8]/a,e[12]=0,e[1]=r[1]/n,e[5]=r[5]/i,e[9]=r[9]/a,e[13]=0,e[2]=r[2]/n,e[6]=r[6]/i,e[10]=r[10]/a,e[14]=0,e[3]=0,e[7]=0,e[11]=0,e[15]=1,this}}]),t}(),st=new at,ut=new at,ht=new at,lt=new at,ct=new ot,ft=new at(0,0,0),mt=new at(1,1,1),dt=function(){function t(){o()(this,t),this.elements=[1,0,0,0,1,0,0,0,1]}return u()(t,[{key:"set",value:function(t,e,r,n,i,a,o,s,u){var h=this.elements;return h[0]=t,h[3]=e,h[6]=r,h[1]=n,h[4]=i,h[7]=a,h[2]=o,h[5]=s,h[8]=u,this}},{key:"setFromMatrix4",value:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}},{key:"setInverseOf",value:function(t){var e=t.elements,r=this.elements,n=e[0],i=e[3],a=e[6],o=e[1],s=e[4],u=e[7],h=e[2],l=e[5],c=e[8],f=this.determinant();return r[0]=(s*c-u*l)/f,r[1]=(u*h-o*c)/f,r[2]=(o*l-s*h)/f,r[3]=(a*l-i*c)/f,r[4]=(n*c-a*h)/f,r[5]=(i*h-n*l)/f,r[6]=(i*u-a*s)/f,r[7]=(a*o-n*u)/f,r[8]=(n*s-i*o)/f,this}},{key:"determinant",value:function(){var t=this.elements,e=t[0],r=t[3],n=t[6],i=t[1],a=t[4],o=t[7],s=t[2],u=t[5],h=t[8];return e*a*h-e*o*u-r*i*h+r*o*s+n*i*u-n*a*s}},{key:"transpose",value:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}},{key:"getNormalMatrix",value:function(t){return this.setFromMatrix4(t).setInverseOf(this).transpose()}}]),t}(),vt="XYZ",yt=new ot,pt=new $,gt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vt;o()(this,t),this._x=e,this._y=r,this._z=n,this._order=i}return u()(t,[{key:"set",value:function(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._order=n||this._order,this}},{key:"copy",value:function(t){return this.set(t.x,t.y,t.z,t.order)}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._order)}},{key:"setFromRotationMatrix",value:function(t,e){var r=t.elements,n=r[0],i=r[4],a=r[8],o=r[1],s=r[5],u=r[9],h=r[2],l=r[6],c=r[10];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(O(a,-1,1)),Math.abs(a)<1-Number.EPSILON?(this._x=Math.atan2(-u,c),this._z=Math.atan2(-i,n)):(this._x=Math.atan2(l,s),this._z=0)):"YXZ"===e?(this._x=Math.asin(-O(u,-1,1)),Math.abs(u)<1-Number.EPSILON?(this._y=Math.atan2(a,c),this._z=Math.atan2(o,s)):(this._y=Math.atan2(-h,n),this._z=0)):"ZXY"===e?(this._x=Math.asin(O(l,-1,1)),Math.abs(l)<1-Number.EPSILON?(this._y=Math.atan2(-h,c),this._z=Math.atan2(-i,s)):(this._y=0,this._z=Math.atan2(o,n))):"ZYX"===e?(this._y=Math.asin(-O(h,-1,1)),Math.abs(h)<1-Number.EPSILON?(this._x=Math.atan2(l,c),this._z=Math.atan2(o,n)):(this._x=0,this._z=Math.atan2(-i,s))):"YZX"===e?(this._z=Math.asin(O(o,-1,1)),Math.abs(o)<1-Number.EPSILON?(this._x=Math.atan2(-u,s),this._y=Math.atan2(-h,n)):(this._x=0,this._y=Math.atan2(a,c))):"XZY"===e?(this._z=Math.asin(-O(i,-1,1)),Math.abs(i)<1-Number.EPSILON?(this._x=Math.atan2(l,s),this._y=Math.atan2(a,n)):(this._x=Math.atan2(-u,c),this._y=0)):console.warn("Euler.setFromRotationMatrix：不支持的参数值order=".concat(e,"$")),this._order=e,this}},{key:"setFromQuaternion",value:function(t,e){return yt.setRotationFromQauternion(t),this.setFromRotationMatrix(yt,e)}},{key:"reorder",value:function(t){return pt.setFromEuler(this),this.setFromQuaternion(pt,t)}},{key:"setFromVector3",value:function(t,e){return this.set(t.x,t.y,t.z,e||this.order)}},{key:"x",set:function(t){this._x=t},get:function(){return this._x}},{key:"y",set:function(t){this._y=t},get:function(){return this._y}},{key:"z",set:function(t){this._z=t},get:function(){return this._z}},{key:"order",set:function(t){this._order=t},get:function(){return this._order}}]),t}(),_t=new at,xt=new at,Mt=new $,bt=new ot,kt=!1;try{kt=void 0!==Proxy}catch(t){console.error("浏览器不支持Proxy！")}var wt=function(){function t(){o()(this,t),this.uid=j(),this.children=[],this.parent=null,this.matrix=new ot,this.worldMatrix=new ot,this.modelViewMatrix=new ot,this.normalMatrix=new dt,this.position=new at,this.scale=new at(1,1,1);var e=new gt,r=kt&&new Proxy(e,{set:function(t,e,r){return t[e]=r,n.setFromEuler(t),!0}}),n=new $,i=kt&&new Proxy(n,{set:function(t,r,n){return t[r]=n,e.setFromQuaternion(t),!0}});this.rotation=kt?r:e,this.quaternion=kt?i:n,this.up=new at(0,1,0),this.matrixAutoUpdate=!0,this._worldMatrixNeedsUpdate=!1,this.visible=!0}return u()(t,[{key:"add",value:function(t){null!=t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t)}},{key:"remove",value:function(t){var e=this.children.indexOf(t);e>=0&&(t.parent=null,this.children.splice(e,1))}},{key:"traverse",value:function(t){for(var e=this.children,r=0,n=e.length;r<n;r++){var i=e[r],a=t(i);if(!1===a)return a;if(!1===(a=i.traverse(t)))return a}}},{key:"getChildByUid",value:function(t){var e=null;return this.traverse((function(r){if(r.uid===t)return e=r,!1})),e}},{key:"getChildByName",value:function(t){var e=null;return this.traverse((function(r){if(r.name===t)return e=r,!1})),e}},{key:"update",value:function(){}},{key:"updateMatrix",value:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this._worldMatrixNeedsUpdate=!0}},{key:"updateWorldMatrix",value:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this._worldMatrixNeedsUpdate||t)&&(null===this.parent?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiplyMatrices(this.parent.worldMatrix,this.matrix),this._worldMatrixNeedsUpdate=!1,t=!0);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].updateWorldMatrix(t)}},{key:"updateRelativeWorldMatrix",value:function(t,e){if(!0===t&&null!==this.parent&&this.parent.updateRelativeWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiplyMatrices(this.parent.worldMatrix,this.matrix),!0===e)for(var r=this.children,n=0,i=r.length;n<i;n++)r[n].updateRelativeWorldMatrix(!1,!0)}},{key:"lookAt",value:function(t,e,r){1===arguments.length?_t.copy(t):_t.set(t,e,r),this.updateRelativeWorldMatrix(!0,!1),xt.setFromMatrixPosition(this.worldMatrix),this.isCamera||this.isLight?bt.lookAt(xt,_t,this.up):bt.lookAt(_t,xt,this.up),this.quaternion.setFromRotationMatrix(bt);var n=this.parent;n&&(bt.extractRotation(n.worldMatrix),Mt.setFromRotationMatrix(bt),this.quaternion.premultiply(Mt.inverse()))}},{key:"applyMatrix",value:function(t){this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}},{key:"rotateOnAxis",value:function(t,e){return Mt.setFromAxisAngle(t,e),this.quaternion.multiply(Mt),this}},{key:"rotateOnWorldAxis",value:function(t,e){return Mt.setFromAxisAngle(t,e),this.quaternion.premultiply(Mt),this}},{key:"copy",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.worldMatrix.copy(t.worldMatrix),this._worldMatrixNeedsUpdate=t._worldMatrixNeedsUpdate,!0===e)for(var r=0,n=t.children.length;r<n;r++){var i=t.children[r];this.add(i.clone(e))}return this}},{key:"clone",value:function(t){return(new this.constructor).copy(this,t)}}]),t}(),At=function(t){function e(){var t;return o()(this,e),(t=V()(this,W()(e).call(this))).isCamera=!0,t.projectionMatrix=new ot,t.projectionMatrixInverse=new ot,t.inverseWorldMatrix=new ot,t}return H()(e,t),u()(e,[{key:"updateWorldMatrix",value:function(){it()(W()(e.prototype),"updateWorldMatrix",this).call(this),this.inverseWorldMatrix.setInverseOf(this.worldMatrix)}}]),e}(wt),Tt=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;return o()(this,e),(t=V()(this,W()(e).call(this))).type=_,t.left=r,t.right=n,t.top=i,t.bottom=a,t.near=s,t.far=u,t.zoom=1,t.updateProjectionMatrix(),t}return H()(e,t),u()(e,[{key:"updateProjectionMatrix",value:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2,i=r-t,a=r+t,o=n+e,s=n-e;this.projectionMatrix.setOrthographic(i,a,o,s,this.near,this.far),this.projectionMatrixInverse.setInverseOf(this.projectionMatrix)}}]),e}(At),zt=function(t){function e(t,r,n,i){var a;return o()(this,e),(a=V()(this,W()(e).call(this))).type=g,a.fovy=void 0===t?45*Math.PI/180:t,a.aspect=void 0===r?1:r,a.near=void 0===n?.1:n,a.far=void 0===i?1e3:i,a.updateProjectionMatrix(),a}return H()(e,t),u()(e,[{key:"updateProjectionMatrix",value:function(){var t=this.near,e=t*Math.tan(.5*this.fovy),r=2*e,n=this.aspect*r,i=-.5*n;this.projectionMatrix.setPerspective(i,i+n,e,e-r,t,this.far),this.projectionMatrixInverse.setInverseOf(this.projectionMatrix)}}]),e}(At);var Et=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;o()(this,t),this.radius=e,this._theta=r,this._phi=n}return u()(t,[{key:"set",value:function(t,e,r){return this.radius=t,this.theta=e,this.phi=r,this}},{key:"setFromVector3",value:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}},{key:"setFromCartesianCoords",value:function(t,e,r){var n,i,a;return this.radius=Math.sqrt(t*t+e*e+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.acos((n=e/this.radius,i=-1,a=1,Math.min(a,Math.max(i,n)))),this.phi=Math.atan2(t,r)),this}},{key:"theta",get:function(){return this._theta},set:function(t){this._theta=Math.max(1e-6,Math.min(t,Math.PI-1e-6))}},{key:"phi",get:function(){return this._phi},set:function(t){this._phi=t}}]),t}(),St=new at,Pt=new Et,It=function(){function t(e,r){o()(this,t),this.object=e,this.domElement=r,this.target=new at(0,0,0),this.enablePan=!0,this.panSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.minThetaAngle=0,this.maxThetaAngle=1/0,this.minPhiAngle=-1/0,this.maxPhiAngle=1/0,this.enableZoom=!0,this.zoomSpeed=1,this.minZoom=0,this.maxZoom=1/0,this.minDistance=0,this.maxDistance=1/0,this._panOffset=new at,this._deltaTheta=0,this._deltaPhi=0,this._scale=1,r.addEventListener("mousedown",this,!1),r.addEventListener("mousemove",this,!1),r.addEventListener("mouseup",this,!1),r.addEventListener("mouseout",this,!1),r.addEventListener("wheel",this,!1),document.addEventListener("keydown",this,!1),document.addEventListener("keyup",this,!1)}return u()(t,[{key:"handleEvent",value:function(t){switch(t.type){case"mousedown":this._handleMouseDown(t);break;case"mousemove":this._handleMouseMove(t);break;case"mouseup":case"mouseout":this._handleMouseUp(t);break;case"wheel":this._handleMouseWheel(t);break;case"keydown":this._handleKeyDown(t);break;case"keyup":this._handleKeyUp(t)}}},{key:"getMousePosition",value:function(t){return[t.clientX,t.clientY]}},{key:"update",value:function(){var t=this.object.position;St.copy(t).sub(this.target),Pt.setFromVector3(St),Pt.theta+=this._deltaTheta,Pt.theta=Math.max(this.minThetaAngle,Math.min(this.maxThetaAngle,Pt.theta)),Pt.phi+=this._deltaPhi,Pt.phi=Math.max(this.minPhiAngle,Math.min(this.maxPhiAngle,Pt.phi)),Pt.radius*=this._scale,Pt.radius=Math.max(this.minDistance,Math.min(this.maxDistance,Pt.radius)),this.target.add(this._panOffset),St.setFromSpherical(Pt),t.copy(this.target).add(St),this.object.lookAt(this.target),this.object.updateWorldMatrix()}},{key:"panLeft",value:function(t){var e=this.object.matrix;St.setFromMatrix4Column(e,0).multiplyScalar(-t),this._panOffset.add(St)}},{key:"panUp",value:function(t){var e=this.object.matrix;St.setFromMatrix4Column(e,1).multiplyScalar(t),this._panOffset.add(St)}},{key:"rotateLeft",value:function(t){this._deltaPhi-=t}},{key:"rotateUp",value:function(t){this._deltaTheta-=t}},{key:"_handleMouseDown",value:function(t){this._dragging=!0,this._lastMousePosition=this.getMousePosition(t)}},{key:"_handleMouseMove",value:function(t){if(this._dragging){var e=this.object,r=this.domElement,n=r.clientWidth,i=r.clientHeight,a=this.getMousePosition(t),o=a[0]-this._lastMousePosition[0],s=a[1]-this._lastMousePosition[1];if(this.enablePan&&this._shiftKeyDown)if(o*=this.panSpeed,s*=this.panSpeed,e.type===g){var u,h=e.position;St.copy(h).sub(this.target),u=St.length(),u*=Math.tan(.5*e.fovy),this.panLeft(o*(u/(n/2))),this.panUp(s*(u/(i/2)))}else e.type===_?(this.panLeft(o*((e.right-e.left)/n)),this.panUp(s*((e.top-e.bottom)/i))):(console.warn("object不是camera，不支持pan操作"),this.enablePan=!1);else{var l=this.rotateSpeed,c=2*Math.PI*s/i,f=2*Math.PI*o/n;this.rotateLeft(l*f),this.rotateUp(l*c)}this.update(),this._panOffset.set(0,0,0),this._deltaTheta=0,this._deltaPhi=0,this._lastMousePosition=a}}},{key:"_handleMouseUp",value:function(){this._dragging=!1}},{key:"_handleMouseWheel",value:function(t){if(this.object.type===g){var e=this._scale;t.deltaY>0?e/=Math.pow(.95,this.zoomSpeed):t.deltaY<0&&(e*=Math.pow(.95,this.zoomSpeed)),this._scale=e}else if(this.object.type===_){var r=this.object.zoom;t.deltaY>0?r*=Math.pow(.95,this.zoomSpeed):t.deltaY<0&&(r/=Math.pow(.95,this.zoomSpeed)),this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,r)),this.object.updateProjectionMatrix()}this.update(),this._scale=1}},{key:"_handleKeyDown",value:function(t){t.shiftKey&&!t.ctrlKey&&(this._shiftKeyDown=!0)}},{key:"_handleKeyUp",value:function(){this._shiftKeyDown=!1}},{key:"destroy",value:function(){this.domElement.removeEventListener("mousedown",this),this.domElement.removeEventListener("mousemove",this),this.domElement.removeEventListener("mouseup",this),this.domElement.removeEventListener("mouseout",this),this.domElement.removeEventListener("wheel",this),document.removeEventListener("keydown",this),document.removeEventListener("keyup",this)}}]),t}(),Ct=function(){function t(){o()(this,t),this._max=new at(-1/0,-1/0,-1/0),this._min=new at(1/0,1/0,1/0)}return u()(t,[{key:"setEmpty",value:function(){return this._max.set(-1/0,-1/0,-1/0),this._min.set(1/0,1/0,1/0),this}},{key:"copy",value:function(t){return this._max.copy(t.max),this._min.copy(t.min),this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"setFromObject",value:function(t){return this.setEmpty(),this.expandByObject(t),this}},{key:"expandByObject",value:function(t){t.updateRelativeWorldMatrix(!1,!1);var e=t.geometry;if(e){var r=e.getBoundingBox();Ot.copy(r),Ot.applyMatrix4(t.worldMatrix),this.expandByPoint(Ot.max),this.expandByPoint(Ot.min)}for(var n=t.children,i=0,a=n.length;i<a;i++)this.expandByObject(n[i]);return this}},{key:"setFromPoints",value:function(t){this.setEmpty();for(var e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this}},{key:"expandByPoint",value:function(t){return this._max.max(t),this._min.min(t),this}},{key:"setFromBufferAttribute",value:function(t){for(var e=1/0,r=1/0,n=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,u=t.count;s<u;s++){var h=t.getX(s),l=t.getY(s),c=t.getZ(s);h<e&&(e=h),l<r&&(r=l),c<n&&(n=c),h>i&&(i=h),l>a&&(a=l),c>o&&(o=c)}return this.min.set(e,r,n),this.max.set(i,a,o),this}},{key:"getSize",value:function(){var t=new at;return this.isEmpty()?t.set(0,0,0):t.setFromVectorsDiff(this._max,this._min),t}},{key:"getCenter",value:function(){var t=new at;return this.isEmpty()?t.set(0,0,0):t.setFromVectorsSum(this._min,this._max).multiplyScalar(.5),t}},{key:"applyMatrix4",value:function(t){return this.isEmpty()||(Rt[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Rt[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Rt[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Rt[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Rt[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Rt[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Rt[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Rt[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Rt)),this}},{key:"max",get:function(){return this._max}},{key:"min",get:function(){return this._min}}]),t}(),Ot=new Ct,Rt=[new at,new at,new at,new at,new at,new at,new at,new at],Ft=function(){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5?arguments[5]:void 0,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"STATIC_DRAW";o()(this,t),this.name=void 0,this.array=e,this.target=s,this.itemSize=r,this.count=e.length/r,this.normalized=n,this.usage=u,this.glType=this.getGLType(e),this.bytesPerElement=e.BYTES_PER_ELEMENT,this.offset=a,this.stride=i}return u()(t,[{key:"getGLType",value:function(t){var e;return t instanceof Float32Array?e="FLOAT":t instanceof Float64Array?console.warn("Unsupported data buffer format: Float64Array."):t instanceof Uint16Array?e="UNSIGNED_SHORT":t instanceof Int16Array?e="SHORT":t instanceof Uint32Array?e="UNSIGNED_INT":t instanceof Int32Array?e="INT":t instanceof Int8Array?e="BYTE":t instanceof Uint8Array&&(e="UNSIGNED_BYTE"),e}},{key:"getX",value:function(t){return this.array[this.itemSize*t]}},{key:"getY",value:function(t){return this.array[this.itemSize*t+1]}},{key:"getZ",value:function(t){return this.array[this.itemSize*t+2]}},{key:"getW",value:function(t){return this.array[this.itemSize*t+3]}},{key:"setXYZ",value:function(t,e,r,n){var i=this.itemSize*t;return this.array[i+0]=e,this.array[i+1]=r,this.array[i+2]=n,this}}]),t}(),Lt=function(){function t(){o()(this,t),this.vertices=[],this.normals=[],this.colors=[],this.indices=[],this._attributes={},this._morphAttributes={},this.morphTargetsRelative=!1}return u()(t,[{key:"setIndex",value:function(t){this.setAttribute("index",t),t.isIndex=!0}},{key:"setAttribute",value:function(t,e){this._attributes[t]=e,e.name=t}},{key:"removeAttribue",value:function(t){delete this._attributes[t]}},{key:"getAttribute",value:function(t){return this._attributes[t]}},{key:"getAttributes",value:function(){return this._attributes}},{key:"setMorphAttribute",value:function(t,e){this._morphAttributes[t]=e}},{key:"removeMorphAttribue",value:function(t){delete this._morphAttributes[t]}},{key:"getMorphAttribute",value:function(t){return this._morphAttributes[t]}},{key:"getMorphAttributes",value:function(){return this._morphAttributes}},{key:"getBoundingBox",value:function(){return this._boundingBox||(this._boundingBox=this.computeBoundingBox()),this._boundingBox}},{key:"computeBoundingBox",value:function(){var t=new Ct,e=this.getAttribute("position");return e?t.setFromBufferAttribute(e):t.setEmpty(),t}},{key:"getWireframeAttribute",value:function(){if(!this._wireframeAttribute){var t=[],e=this.getAttribute("index"),r=this.getAttribute("position");if(e)for(var n=e.array,i=0,a=n.length;i<a;i+=3){var o=n[i],s=n[i+1],u=n[i+2];t.push(o,s,s,u,u,o)}else if(r)for(var h=0,l=r.array.length/3;h<l;h+=3){var c=h,f=h+1,m=h+2;t.push(c,f,f,m,m,c)}var d=L(t)>65535?Uint32Array:Uint16Array,v=new Ft(new d(t),1);v.isIndex=!0,v.name="wireframeIndex",this._wireframeAttribute=v}return this._wireframeAttribute}}]),t}(),Nt=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;return o()(this,e),(t=V()(this,W()(e).call(this,r,n,i,a,s,u))).numberOfVertices=0,t._buildPlane("x","y","z",1,1,r,n,i,a,s),t._buildPlane("x","y","z",1,1,r,n,-i,a,s),t._buildPlane("x","z","y",1,-1,r,i,n,a,s),t._buildPlane("x","z","y",1,-1,r,i,-n,a,s),t._buildPlane("z","y","x",1,1,i,n,r,a,s),t._buildPlane("z","y","x",1,1,i,n,-r,a,s),t.setIndex(new Ft(new Uint8Array(t.indices),1)),t.setAttribute("position",new Ft(new Float32Array(t.vertices),3)),t.setAttribute("normal",new Ft(new Float32Array(t.normals),3)),t}return H()(e,t),u()(e,[{key:"_buildPlane",value:function(t,e,r,n,i,a,o,s,u,h){for(var l=a/2,c=o/2,f=s/2,m=a/u,d=o/h,v=u+1,y=h+1,p=0,g=new at,_=0;_<y;_++)for(var x=_*d-c,M=0;M<v;M++){var b=M*m-l;g[t]=b*n,g[e]=x*i,g[r]=f,this.vertices.push(g.x,g.y,g.z),g[t]=0,g[e]=0,g[r]=s>0?1:-1,this.normals.push(g.x,g.y,g.z),p++}for(var k=0;k<h;k++)for(var w=0;w<u;w++){var A=this.numberOfVertices,T=A+w+v*k,z=A+w+v*(k+1),E=A+(w+1)+v*(k+1),S=A+(w+1)+v*k;this.indices.push(T,S,E),this.indices.push(T,E,z)}this.numberOfVertices+=p}}]),e}(Lt),jt=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3];o()(this,e);var i=r/2,a=n/2;return(t=V()(this,W()(e).call(this))).vertices.push(i,a,0,-i,a,0,-i,-a,0,i,-a,0),t.indices.push(0,1,3,1,2,3),t.setIndex(new Ft(new Uint8Array(t.indices),1)),t.setAttribute("position",new Ft(new Float32Array(t.vertices),3)),t}return H()(e,t),e}(Lt),Ut=new at,Bt=function(t){function e(t){var r;o()(this,e),r=V()(this,W()(e).call(this,t));for(var n=t.getAttribute("index"),i=t.getAttribute("position"),a=0,s=n?n.count:i.count;a<s;a+=3)for(var u=0;u<3;u++){var h=void 0,l=void 0;n?(h=n.getX(a+u),l=n.getX(a+(u+1)%3)):(h=a+u,l=a+(u+1)%3),Ut.setFromBufferAttribute(i,h),r.vertices.push(Ut.x,Ut.y,Ut.z),Ut.setFromBufferAttribute(i,l),r.vertices.push(Ut.x,Ut.y,Ut.z)}return r.setAttribute("position",new Ft(new Float32Array(r.vertices),3)),r}return H()(e,t),e}(Lt),Dt=function(t){function e(t,r){var n;return o()(this,e),(n=V()(this,W()(e).call(this))).geometry=t,n.material=r,n.type=M,n.drawMode=c,n}return H()(e,t),e}(wt),Vt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Gt=function(){function t(e,r,n){o()(this,t),1===arguments.length?this.set(e):this.setRGB(e,r,n)}return u()(t,[{key:"set",value:function(e){return e instanceof t?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e?this.setStyle(e):Array.isArray(e)?this.setFromArray(e):console.warn("Color: 错误的参数(".concat(e,")")),this}},{key:"setRGB",value:function(t,e,r){return this.r=t,this.g=e,this.b=r,this}},{key:"setHex",value:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}},{key:"setStyle",value:function(t){var e;if(e=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(t)){var r,n=e[1],i=e[2];"rgb"!==n&&"rgba"!==n||((r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))?(this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,parseFloat(r[5])<1&&console.warn("Alpha component of "+t+" will be ignored.")):(r=/^(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))&&(this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,parseFloat(r[5])<1&&console.warn("Alpha component of "+t+" will be ignored.")))}else if(e=/^#([A-Fa-f0-9]+)$/.exec(t)){var a=e[1],o=a.length;3===o?(this.r=parseInt(a.charAt(0)+a.charAt(0),16)/255,this.g=parseInt(a.charAt(1)+a.charAt(1),16)/255,this.b=parseInt(a.charAt(2)+a.charAt(2),16)/255):6===o&&(this.r=parseInt(a.charAt(0)+a.charAt(1),16)/255,this.g=parseInt(a.charAt(2)+a.charAt(3),16)/255,this.b=parseInt(a.charAt(4)+a.charAt(5),16)/255)}else t&&t.length>0&&this.setColorName(t);return this}},{key:"setColorName",value:function(t){var e=Vt[t];return void 0!==e?this.setHex(e):console.warn("Unknown color "+t),this}},{key:"setFromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}},{key:"copy",value:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}},{key:"clone",value:function(){return new this.constructor(this.r,this.g,this.b)}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e+0]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}}]),t}(),Wt=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t),this.type=T,e.color&&(this.color=new Gt(e.color)),this.vertexColors=!0===e.vertexColors,this.precision=null,this.wireframe=e.wireframe,this.morphTargets=!1,this.morphNormals=!1},Yt=function(t){function e(t){var r;return o()(this,e),(r=V()(this,W()(e).call(this,t))).type=z,r}return H()(e,t),e}(Wt),Ht=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;o()(this,e);var r=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=new Lt;n.setAttribute("position",new Ft(new Float32Array(r),3)),n.setAttribute("color",new Ft(new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]),3));var i=new Yt({vertexColors:!0});return V()(this,W()(e).call(this,n,i))}return H()(e,t),e}(Dt),qt=new At,Xt=new at,Zt=function(t){function e(t){var r;o()(this,e);var n=[],i=[],a={},s=new Gt(16755200),u=new Gt(16711680),h=new Gt(43775),l=new Gt(16777215),c=new Gt(3355443);function f(t,e,r){m(t,r),m(e,r)}function m(t,e){n.push(0,0,0),i.push(e.r,e.g,e.b),void 0===a[t]&&(a[t]=[]),a[t].push(n.length/3-1)}f("p","n1",u),f("p","n2",u),f("p","n3",u),f("p","n4",u),f("n1","n2",s),f("n2","n3",s),f("n3","n4",s),f("n4","n1",s),f("f1","f2",s),f("f2","f3",s),f("f3","f4",s),f("f4","f1",s),f("n1","f1",s),f("n2","f2",s),f("n3","f3",s),f("n4","f4",s),f("u1","u2",h),f("u2","u3",h),f("u3","u1",h),f("p","c",l),f("c","t",l),f("cn1","cn3",c),f("cn2","cn4",c),f("cf1","cf3",c),f("cf2","cf4",c);var d=new Lt;d.setAttribute("position",new Ft(new Float32Array(n),3)),d.setAttribute("color",new Ft(new Float32Array(i),3));var v=new Yt({vertexColors:!0});return(r=V()(this,W()(e).call(this,d,v)))._pointMap=a,r._camera=t,r.matrix=t.worldMatrix,r.matrixAutoUpdate=!1,r.update(),r}return H()(e,t),u()(e,[{key:"update",value:function(){var t=this.geometry.getAttribute("position"),e=this._pointMap;function r(r,n,i,a){Xt.set(n,i,a).unproject(qt);var o=e[r];if(o&&t)for(var s=0,u=o.length;s<u;s++)t.setXYZ(o[s],Xt.x,Xt.y,Xt.z)}this._camera.updateProjectionMatrix(),qt.projectionMatrixInverse.copy(this._camera.projectionMatrixInverse),r("c",0,0,-1),r("t",0,0,1),r("n1",1,1,-1),r("n2",-1,1,-1),r("n3",-1,-1,-1),r("n4",1,-1,-1),r("f1",1,1,1),r("f2",-1,1,1),r("f3",-1,-1,1),r("f4",1,-1,1),r("u1",.7,1.1,-1),r("u2",0,2,-1),r("u3",-.7,1.1,-1),r("cn1",0,1,-1),r("cn2",-1,0,-1),r("cn3",0,-1,-1),r("cn4",1,0,-1),r("cf1",0,1,1),r("cf2",-1,0,1),r("cf3",0,-1,1),r("cf4",1,0,1),t.needsUpdate=!0}}]),e}(Dt),Kt=function(t){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#ccc",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#ff3352",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"#2890ff";o()(this,e);var s=t/2,u=t/r,h=[],l=[],c=r/2;n=new Gt(n),i=new Gt(i),a=new Gt(a);for(var f=0,m=-s;f<=r;f++,m+=u)h.push(-s,0,m,s,0,m),f===c?(i.toArray(l,l.length),i.toArray(l,l.length)):(n.toArray(l,l.length),n.toArray(l,l.length)),h.push(m,0,-s,m,0,s),f===c?(a.toArray(l,l.length),a.toArray(l,l.length)):(n.toArray(l,l.length),n.toArray(l,l.length));var d=new Lt;d.setAttribute("position",new Ft(new Float32Array(h),3)),d.setAttribute("color",new Ft(new Float32Array(l),3));var v=new Yt({vertexColors:!0});return V()(this,W()(e).call(this,d,v))}return H()(e,t),e}(Dt),Qt=function(t){function e(t){var r;return o()(this,e),(r=V()(this,W()(e).call(this,t))).pointSize=t.pointSize,r}return H()(e,t),e}(Wt),Jt=function(t){function e(){var t;return o()(this,e),(t=V()(this,W()(e).call(this))).type=w,t}return H()(e,t),e}(wt),$t=function(t){function e(t,r){var n;return o()(this,e),(n=V()(this,W()(e).call(this))).geometry=t,n.material=r,n.type=x,n}return H()(e,t),u()(e,[{key:"update",value:function(){this.geometry.update(),this.material.update()}}]),e}(wt),te=function(t){function e(t,r){var n;return o()(this,e),(n=V()(this,W()(e).call(this))).geometry=t,n.material=r,n.type=p,n.updateMorphTargetInfluences(),n}return H()(e,t),u()(e,[{key:"clone",value:function(t){return new this.constructor(this.geometry,this.material).copy(this,t)}},{key:"updateMorphTargets",value:function(){for(var t=this.geometry,e=this.material,r=e.morphTargets&&t.getMorphAttribute("position"),n=e.morphNormals&&t.getMorphAttribute("normal"),i=this.morphTargetInfluences,a=0,o=0;o<8;o++){var s=i[o];s&&(r&&t.setAttribute("morphTarget".concat(o),r[o]),n&&t.setAttribute("morphNormal".concat(o),n[o]),a+=s)}this.morphTargetBaseInfluence=t.morphTargetsRelative?1:1-a}},{key:"updateMorphTargetInfluences",value:function(){var t=this.geometry.getMorphAttributes(),e=Object.keys(t);if(e.length>0){var r=t[e[0]];if(void 0!==r){this.morphTargetInfluences=[];for(var n=0,i=r.length;n<i;n++)this.morphTargetInfluences.push(0)}}}}]),e}(wt),ee=function(t){function e(t,r){var n;return o()(this,e),(n=V()(this,W()(e).call(this))).geometry=t,n.material=r,n.type=k,n}return H()(e,t),e}(wt),re=function(t){function e(){var t;return o()(this,e),(t=V()(this,W()(e).call(this))).type=A,t}return H()(e,t),e}(wt),ne=function(){function t(e){o()(this,t),this._gl=e,this._buffers=new WeakMap}return u()(t,[{key:"createBuffer",value:function(t){var e=this._gl,r=t.array,n=t.usage,i=t.target,a=e.createBuffer();return"string"==typeof n&&(t.usage=n=e[n]),"string"==typeof t.glType&&(t.glType=e[t.glType]),void 0===i&&(i=!0===t.isIndex?e.ELEMENT_ARRAY_BUFFER:e.ARRAY_BUFFER,t.target=i),e.bindBuffer(i,a),e.bufferData(i,r,n),a}},{key:"get",value:function(t){var e=this._buffers.get(t);return e||(e=this.createBuffer(t),this._buffers.set(t,e)),e}},{key:"remove",value:function(t){var e=this.get(t);e&&(this._gl.deleteBuffer(e),this._buffers.delete(t))}},{key:"update",value:function(){}},{key:"destroy",value:function(){this._gl=null,this._buffers=null}}]),t}(),ie=function(){function t(e,r){var n=r.precision,i=void 0===n?"highp":n;o()(this,t),this._gl=e;var a="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;this.isWebGL2=a;var s=this.getMaxPrecision(i);s!==i&&(i=s),this.precision=i}return u()(t,[{key:"getMaxPrecision",value:function(t){var e=this._gl;if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}}]),t}(),ae=function(){function t(e,r,n){o()(this,t),this._path=e,this._source=r,this._dependencies=n,this._compiled=!1}return u()(t,[{key:"getDependency",value:function(t){for(var e=0,r=this._dependencies,n=r.length;e<n;e++){var i=r[e];if(i._path===t)return i}}},{key:"compile",value:function(){if(!this._compiled){for(var t,e=/#include\s+['"]([^'"]*)['"]/g,r=this._source,n=[],i=this._source;null!==(t=e.exec(r));){var a=t[1],o=this.getDependency(a);o&&n.push([t[0],o.compile()])}for(var s=0,u=n.length;s<u;s++){var h=n[s];i=i.replace(h[0],h[1])}this._source=i,this._compiled=!0}return this._source}}]),t}(),oe=new ae("./chunks/colorHead.vert","#ifdef USE_COLOR\r\n    varying vec3 vColor;\r\n    attribute vec3 color;\r\n#endif",[]),se=new ae("./chunks/colorMain.vert","#ifdef USE_COLOR\r\n    vColor = color;\r\n#endif",[]),ue=new ae("./base.vert","#include './chunks/colorHead.vert'\r\n\r\n/********************* morphTargets head start *********************/\r\n\r\n#ifdef USE_MORPHTARGETS\r\n\r\n    uniform float morphTargetBaseInfluence;\r\n\r\n    attribute vec3 morphTarget0;\r\n    attribute vec3 morphTarget1;\r\n    attribute vec3 morphTarget2;\r\n    attribute vec3 morphTarget3;\r\n\r\n    #ifdef USE_MORPHNORMALS\r\n\r\n        uniform float morphTargetInfluences[4];\r\n\r\n        attribute vec3 morphNormal0;\r\n        attribute vec3 morphNormal1;\r\n        attribute vec3 morphNormal2;\r\n        attribute vec3 morphNormal3;\r\n\r\n    #else\r\n\r\n        uniform float morphTargetInfluences[8];\r\n\r\n        attribute vec3 morphTarget4;\r\n        attribute vec3 morphTarget5;\r\n        attribute vec3 morphTarget6;\r\n        attribute vec3 morphTarget7;\r\n\r\n    #endif\r\n\r\n#endif\r\n\r\n/********************* morphTargets head start *********************/\r\n\r\nattribute vec3 position;\r\nuniform mat4 modelViewMatrix;\r\nuniform mat4 projectionMatrix;\r\n\r\nattribute vec3 normal;\r\nuniform mat3 normalMatrix;\r\nvarying vec3 vNormal;\r\n\r\nvoid main() {\r\n\r\n    #include './chunks/colorMain.vert'\r\n\r\n    /********************* normal main start *********************/\r\n\r\n    vec3 objectNormal = vec3(normal);\r\n\r\n    #ifdef USE_MORPHNORMALS\r\n\r\n        objectNormal *= morphTargetBaseInfluence;\r\n        objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\r\n        objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\r\n        objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\r\n        objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\r\n\r\n    #endif\r\n\r\n    vec3 transformedNormal = objectNormal;\r\n\r\n    transformedNormal = normalMatrix * transformedNormal;\r\n\r\n    vNormal = normalize(transformedNormal);\r\n\r\n    /********************* normal main end *********************/\r\n\r\n    /********************* position main start *********************/\r\n\r\n    vec3 transformed = vec3(position);\r\n\r\n    /********************* morphTargets main start *********************/\r\n\r\n    #ifdef USE_MORPHTARGETS\r\n\r\n        transformed *= morphTargetBaseInfluence;\r\n        transformed += morphTarget0 * morphTargetInfluences[0];\r\n        transformed += morphTarget1 * morphTargetInfluences[1];\r\n        transformed += morphTarget2 * morphTargetInfluences[2];\r\n        transformed += morphTarget3 * morphTargetInfluences[3];\r\n\r\n        #ifndef USE_MORPHNORMALS\r\n\r\n            transformed += morphTarget4 * morphTargetInfluences[4];\r\n            transformed += morphTarget5 * morphTargetInfluences[5];\r\n            transformed += morphTarget6 * morphTargetInfluences[6];\r\n            transformed += morphTarget7 * morphTargetInfluences[7];\r\n\r\n        #endif\r\n\r\n    #endif\r\n\r\n    /********************* morphTargets end start *********************/\r\n\r\n    vec4 mvPosition = vec4(transformed, 1.0);\r\n\r\n    mvPosition = modelViewMatrix * mvPosition;\r\n\r\n    gl_Position = projectionMatrix * mvPosition;\r\n\r\n    /********************* position main end *********************/\r\n\r\n}",[oe,se]),he=new ae("./chunks/colorHead.frag","#ifdef USE_COLOR\r\n    varying vec3 vColor;\r\n#endif",[]),le=new ae("./chunks/colorMain.frag","#ifdef USE_COLOR\r\n    diffuseColor.rgb *= vColor;\r\n#endif",[]),ce={base:{vertex:ue,fragment:new ae("./base.frag",'#include "./chunks/colorHead.frag"\r\n\r\nuniform vec3 diffuse;\r\nvarying vec3 vNormal;\r\n\r\nvoid main() {\r\n\r\n    vec4 diffuseColor = vec4(diffuse, 1);\r\n\r\n    #include "./chunks/colorMain.frag"\r\n\r\n    vec4 lightColor = vec4(1, 1, 1, 1);\r\n    vec3 lightDirection = normalize(vec3(0.5, 3, 4));\r\n    vec4 ambientColor = vec4(0.2, 0.2, 0.2, 1);\r\n\r\n    vec3 normal = normalize(vNormal);\r\n\r\n    float fDot = max(dot(lightDirection, normal), 0.0);\r\n    vec4 ambient = ambientColor * diffuseColor;\r\n    gl_FragColor = vec4((lightColor * diffuseColor * fDot).xyz + ambient.xyz, diffuseColor.a);\r\n\r\n}',[he,le])},points:{vertex:new ae("./points.vert","attribute vec4 a_Position;\r\nattribute vec4 a_Color;\r\nattribute float a_PointSize;\r\nvarying vec4 v_Color;\r\nuniform mat4 u_MVPMatrix;\r\n\r\nvoid main() {\r\n    gl_Position = u_MVPMatrix * a_Position;\r\n    gl_PointSize = a_PointSize;\r\n    v_Color = a_Color;\r\n}",[]),fragment:new ae("./points.frag","varying vec4 v_Color;\r\n\r\nvoid main() {\r\n    float dist = distance(gl_PointCoord, vec2(0.5, 0.5));\r\n    if (dist < 0.5) {\r\n        gl_FragColor = v_Color;\r\n    } else {\r\n        discard;\r\n    }\r\n}",[])},line:{vertex:new ae("./line.vert","#include './chunks/colorHead.vert'\r\n\r\nattribute vec4 position;\r\n// uniform mat4 modelMatrix;\r\n// uniform mat4 viewMatrix;\r\nuniform mat4 projectionMatrix;\r\nuniform mat4 modelViewMatrix;\r\n\r\nvoid main() {\r\n\r\n    #include './chunks/colorMain.vert'\r\n\r\n    gl_Position = projectionMatrix * modelViewMatrix * position;\r\n\r\n}",[oe,se]),fragment:new ae("./line.frag",'#include "./chunks/colorHead.frag"\r\n\r\nuniform vec3 diffuse;\r\n\r\nvoid main() {\r\n\r\n    vec4 diffuseColor = vec4(diffuse, 1);\r\n\r\n    #include "./chunks/colorMain.frag"\r\n\r\n    gl_FragColor = diffuseColor;\r\n\r\n}',[he,le])}};function fe(t,e){if(t.length!==e.length)return!1;for(var r=0,n=t.length;r<n;r++)if(t[r]!==e[r])return!1;return!0}function me(t,e){for(var r=0,n=e.length;r<n;r++)t[r]=e[r]}function de(t,e){t.uniform1fv(this._addr,e)}function ve(t,e){t.uniform2fv(this._addr,e)}function ye(t,e){t.uniform3fv(this._addr,e)}function pe(t,e){t.uniform4fv(this._addr,e)}function ge(t,e){t.uniformMatrix2fv(this._addr,!1,e)}function _e(t,e){t.uniformMatrix3fv(this._addr,!1,e)}function xe(t,e){t.uniformMatrix4fv(this._addr,!1,e)}function Me(t,e){t.uniform1iv(this._addr,e)}function be(t,e){t.uniform2iv(this._addr,e)}function ke(t,e){t.uniform3iv(this._addr,e)}function we(t,e){t.uniform4iv(this._addr,e)}function Ae(t,e){var r=this._cache;r[0]!==e&&(t.uniform1f(this._addr,e),r[0]=e)}function Te(t,e){var r=this._cache;if(void 0!==e.x&&void 0!==e.y)r[0]===e.x&&r[1]===e.y||(t.uniform2f(this._addr,e.x,e.y),r[0]=e.x,r[1]=e.y);else{if(fe(r,e))return;t.uniform2fv(this._addr,e),me(r,e)}}function ze(t,e){var r=this._cache;if(void 0!==e.x&&void 0!==e.y&&void 0!==e.z)r[0]===e.x&&r[1]===e.y&&r[2]===e.z||(t.uniform3f(this._addr,e.x,e.y,e.z),r[0]=e.x,r[1]=e.y,r[2]=e.z);else if(void 0!==e.r)r[0]===e.r&&r[1]===e.g&&r[2]===e.b||(t.uniform3f(this._addr,e.r,e.g,e.b),r[0]=e.r,r[1]=e.g,r[2]=e.b);else{if(fe(r,e))return;t.uniform3fv(this._addr,e),me(r,e)}}function Ee(t,e){var r=this.cache;if(void 0!==e.x&&void 0!==e.y&&void 0!==e.z&&void 0!==e.w)r[0]===e.x&&r[1]===e.y&&r[2]===e.z&&r[3]===e.w||(t.uniform4f(this._addr,e.x,e.y,e.z,e.w),r[0]=e.x,r[1]=e.y,r[2]=e.z,r[3]=e.w);else{if(fe(r,e))return;t.uniform4fv(this._addr,e),me(r,e)}}function Se(t,e){var r=this._cache;r[0]!==e&&(t.uniform1i(this._addr,e),r[0]=e)}function Pe(t,e){void 0!==e.x?t.uniform2i(this._addr,e.x,e.y):t.uniform2iv(this._addr,e)}function Ie(t,e){void 0!==e.x?t.uniform3i(this._addr,e.x,e.y,e.z):void 0!==e.r?t.uniform3i(this._addr,e.r,e.g,e.b):t.uniform3iv(this._addr,e)}function Ce(t,e){void 0!==e.x?t.uniform4i(this._addr,e.x,e.y,e.z,e.w):t.uniform4iv(this._addr,e)}var Oe=new Float32Array(16),Re=new Float32Array(9),Fe=new Float32Array(4);function Le(t,e){var r=this._cache,n=e.elements;if(void 0===n){if(fe(r,e))return;t.uniformMatrix2fv(this._addr,!1,e),me(r,e)}else{if(fe(r,n))return;Fe.set(n),t.uniformMatrix2fv(this._addr,!1,Fe),me(r,Fe)}}function Ne(t,e){var r=this._cache,n=e.elements;if(void 0===n){if(fe(r,e))return;t.uniformMatrix3fv(this._addr,!1,e),me(r,e)}else{if(fe(r,n))return;Re.set(n),t.uniformMatrix3fv(this._addr,!1,Re),me(r,Re)}}function je(t,e){var r=this._cache,n=e.elements;if(void 0===n){if(fe(r,e))return;t.uniformMatrix4fv(this._addr,!1,e),me(r,e)}else{if(fe(r,n))return;Oe.set(n),t.uniformMatrix4fv(this._addr,!1,Oe),me(r,Oe)}}var Ue=function(){function t(e,r){o()(this,t),this._info=e,this._addr=r,this._cache=[]}return u()(t,[{key:"calculateValue",value:function(){throw"WebGLUnifrom子类没有实现 calculateValue(object, camera) 方法"}},{key:"setValue",value:function(){throw"WebGLUnifrom子类没有实现 setValue(object, camera) 方法"}}]),t}(),Be=function(t){function e(t,r){var n;return o()(this,e),(n=V()(this,W()(e).call(this,t,r))).setValue=function(t){switch(t){case 5126:return Ae;case 35664:return Te;case 35665:return ze;case 35666:return Ee;case 35674:return Le;case 35675:return Ne;case 35676:return je;case 5124:case 35670:return Se;case 35667:case 35671:return Pe;case 35668:case 35672:return Ie;case 35669:case 35673:return Ce}}(t.type),n}return H()(e,t),e}(Ue),De=function(t){function e(t,r){var n;return o()(this,e),(n=V()(this,W()(e).call(this,t,r))).setValue=function(t){switch(t){case 5126:return de;case 35664:return ve;case 35665:return ye;case 35666:return pe;case 35674:return ge;case 35675:return _e;case 35676:return xe;case 5124:case 35670:return Me;case 35667:case 35671:return be;case 35668:case 35672:return ke;case 35669:case 35673:return we}}(t.type),n}return H()(e,t),e}(Ue),Ve=function(t){function e(){return o()(this,e),V()(this,W()(e).apply(this,arguments))}return H()(e,t),u()(e,[{key:"calculateValue",value:function(t){return t.worldMatrix.elements}}]),e}(Be),Ge=function(t){function e(){return o()(this,e),V()(this,W()(e).apply(this,arguments))}return H()(e,t),u()(e,[{key:"calculateValue",value:function(t,e){return e.inverseWorldMatrix.elements}}]),e}(Be),We=function(t){function e(){return o()(this,e),V()(this,W()(e).apply(this,arguments))}return H()(e,t),u()(e,[{key:"calculateValue",value:function(t,e){return e.projectionMatrix.elements}}]),e}(Be),Ye=function(t){function e(){return o()(this,e),V()(this,W()(e).apply(this,arguments))}return H()(e,t),u()(e,[{key:"calculateValue",value:function(t){var e=t.material,r=e.color;return!0===e.wireframe?[0,0,0]:r||[1,1,1]}}]),e}(Be),He=function(t){function e(){return o()(this,e),V()(this,W()(e).apply(this,arguments))}return H()(e,t),u()(e,[{key:"calculateValue",value:function(t){return t.normalMatrix.elements}}]),e}(Be),qe=function(t){function e(){return o()(this,e),V()(this,W()(e).apply(this,arguments))}return H()(e,t),u()(e,[{key:"calculateValue",value:function(t){return t.modelViewMatrix.elements}}]),e}(Be),Xe=function(t){function e(){return o()(this,e),V()(this,W()(e).apply(this,arguments))}return H()(e,t),u()(e,[{key:"calculateValue",value:function(t){return t.updateMorphTargets(),t.morphTargetBaseInfluence}}]),e}(Be),Ze={modelMatrix:Ve,viewMatrix:Ge,projectionMatrix:We,diffuse:Ye,normalMatrix:He,modelViewMatrix:qe,morphTargetInfluences:function(t){function e(){return o()(this,e),V()(this,W()(e).apply(this,arguments))}return H()(e,t),u()(e,[{key:"calculateValue",value:function(t){for(var e=t.morphTargetInfluences,r=void 0===e?0:e.length,n=new Float32Array(8),i=0;i<r;i++){var a=e[i];n[i]=a||0}return n}}]),e}(De),morphTargetBaseInfluence:Xe},Ke=function(){function t(e,r){o()(this,t),this._uniformMap={};for(var n=e.getProgramParameter(r,e.ACTIVE_UNIFORMS),i=0;i<n;i++){var a=e.getActiveUniform(r,i),s=e.getUniformLocation(r,a.name);this.parseUniform(a,s)}}return u()(t,[{key:"parseUniform",value:function(t,e){var r=/([0-9A-Z_a-z]+)/g.exec(t.name)[1],n=new(0,Ze[r])(t,e);this.addUniform(r,n)}},{key:"addUniform",value:function(t,e){this._uniformMap[t]=e}},{key:"getUniform",value:function(t){return this._uniformMap[t]}},{key:"eachUniform",value:function(t){var e=this._uniformMap;for(var r in e){t(e[r])}}}]),t}();function Qe(t){var e,r=t.precision;return"highp"===r?e="#define HIGH_PRECISION":"mediump"===r?e="#define MEDIUM_PRECISION":"lowp"===r&&(e="#define LOW_PRECISION"),"\n        precision ".concat(r," float;\n        precision ").concat(r," int;\n        ").concat(e,"\n    ")}function Je(t){return""!==t}var $e,tr=function(){function t(e,r){var n,i;o()(this,t),this._gl=e,this._attributes=null,this._uniforms=null,this.debug=!0,r.isRawShaderMaterial||(n=[Qe(r),r.vertexColors?"#define USE_COLOR":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals?"#define USE_MORPHNORMALS":"","\n"].filter(Je).join("\n"),i=[Qe(r),r.vertexColors?"#define USE_COLOR":"","\n"].filter(Je).join("\n"));var a=ce[r.shaderType],s=n+a.vertex.compile(),u=i+a.fragment.compile(),h=this.createShader(e.VERTEX_SHADER,s),l=this.createShader(e.FRAGMENT_SHADER,u),c=this.createProgram(h,l);this._program=c,this._vertexShader=h,this._fragmentShader=l,this.usedTimes=0,e.deleteShader(h),e.deleteShader(l)}return u()(t,[{key:"createShader",value:function(t,e){var r=this._gl,n=r.createShader(t);if((r.shaderSource(n,e),r.compileShader(n),!0===this.debug)&&!r.getShaderParameter(n,r.COMPILE_STATUS)){var i=r.getShaderInfoLog(n),a=r.getShaderSource(n);console.error("创建Shader失败！错误信息：".concat(i,"\n").concat(function(t){for(var e=t.split("\n"),r=0,n=e.length;r<n;r++)e[r]=r+1+": "+e[r];return e.join("\n")}(a)))}return n}},{key:"createProgram",value:function(t,e){var r=this._gl,n=r.createProgram();if((r.attachShader(n,t),r.attachShader(n,e),r.linkProgram(n),!0===this.debug)&&!r.getProgramParameter(n,r.LINK_STATUS)){var i=r.getProgramInfoLog(n);console.error("创建program失败！错误信息：".concat(i))}return n}},{key:"getProgram",value:function(){return this._program}},{key:"getAttributes",value:function(){if(this._attributes)return this._attributes;for(var t=this._attributes={},e=this._gl,r=this._program,n=e.getProgramParameter(r,e.ACTIVE_ATTRIBUTES),i=0;i<n;i++){var a=e.getActiveAttrib(r,i).name,o=e.getAttribLocation(r,a);t[a]=o}return t}},{key:"getUniforms",value:function(){if(this._uniforms)return this._uniforms;var t=new Ke(this._gl,this._program);return this._uniforms=t,this._uniforms}},{key:"destroy",value:function(){this._gl.deleteProgram(this._program),this._program=null,this._gl=null}}]),t}(),er=r(5),rr=r.n(er),nr=($e={},rr()($e,T,"base"),rr()($e,z,"line"),$e),ir=function(){function t(e,r){o()(this,t),this._gl=e,this._capabilities=r,this._programs={}}return u()(t,[{key:"getParameters",value:function(t){var e=this._capabilities,r=t.material,n=r.type,i=nr[n],a=e.precision,o=e.isWebGL2;if(null!==r.precision){var s=e.getMaxPrecision(r.precision);s!==r.precision&&console.warn("不支持material.precision = ".concat(r.precision,"，将使用").concat(s))}return{isWebGL2:o,materialType:n,shaderType:i,vertexColors:r.vertexColors,morphTargets:r.morphTargets,morphNormals:r.morphNormals,precision:a}}},{key:"getProgramKey",value:function(t){return[t.shaderType,t.vertexColors,t.morphTargets,t.morphNormals].join()}},{key:"getProgram",value:function(t,e){var r=this._gl,n=this._programs[t];return n||(this._programs[t]=n=new tr(r,e)),n}},{key:"releaseProgram",value:function(t){var e=this._programs[t];e&&(e.destroy(),this._programs.delete(t))}},{key:"destroy",value:function(){for(var t in this._gl=null,this._programs)this.releaseProgram(t);this._programs=null}}]),t}(),ar=r(7),or=r.n(ar),sr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.canvas,n=void 0===r?document.createElement("canvas"):r,i=e.autoClear,a=void 0===i||i,s=e.autoClearColor,u=void 0===s||s,h=e.autoClearDepth,l=void 0===h||h,c=e.autoClearStencil,f=void 0===c||c,m=e.precision;o()(this,t),this.domElement=n,this.autoClear=a,this.autoClearColor=u,this.autoClearDepth=l,this.autoClearStencil=f,this._pixelRatio=window.devicePixelRatio,this._clearColor=new Gt("black");var d=this.getContext(this.domElement),v=new ie(d,{precision:m});this._capabilities=v,this._programManager=new ir(d,v),this._bufferManager=new ne(d)}return u()(t,[{key:"getContext",value:function(){if(void 0===this._gl){for(var t=["webgl","experimental-webgl","webkit-3d","moz-webgl"],e=this.domElement,r=null,n=0;n<t.length;n++){try{r=e.getContext(t[n])}catch(t){}if(r)break}r||console.error("WebGLRenderer：读取context失败！"),this._gl=r}return this._gl}},{key:"setSize",value:function(t,e,r){this._width=t,this._height=e,this.domElement.width=Math.floor(t*this._pixelRatio),this.domElement.height=Math.floor(e*this._pixelRatio),!1!==r&&(this.domElement.style.width=t+"px",this.domElement.style.height=e+"px"),this.setViewport(0,0,t,e)}},{key:"setViewport",value:function(t,e,r,n){this._gl.viewport(t,e,r,n)}},{key:"setAttributes",value:function(t,e){var r=this._gl,n=t.getAttributes(),i=e.geometry.getAttributes();for(var a in n){var o=n[a];if(o>=0){var s=i[a];if(s){var u=this._bufferManager.get(s),h=s.itemSize,l=s.glType,c=s.target,f=s.normalized,m=s.stride,d=s.offset;r.enableVertexAttribArray(o),r.bindBuffer(c,u),r.vertexAttribPointer(o,h,l,f,m,d)}}}}},{key:"setUniforms",value:function(t,e,r){var n=this._gl;t.getUniforms().eachUniform((function(t){var i=t.calculateValue(e,r);t.setValue(n,i)}))}},{key:"render",value:function(t,e){var r=this._gl,n=this._programManager;t.updateWorldMatrix(),r.enable(r.DEPTH_TEST),r.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,1),this.autoClear&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);for(var i=this.getRenderList(t),a=0;a<i.length;a++){var o=i[a],s=o.geometry,u=o.material,h=s.getAttribute("index"),l=s.getAttribute("position");if(h){if(0===h.count)return}else if(!l||0===l.count)return;var c=n.getParameters(o),f=n.getProgramKey(c),m=n.getProgram(f,c),d=m.getProgram();this._currentProgram!==d&&(this._currentProgram=d,r.useProgram(d)),o.modelViewMatrix.multiplyMatrices(e.inverseWorldMatrix,o.worldMatrix),o.normalMatrix.getNormalMatrix(o.modelViewMatrix),this.setUniforms(m,o,e),this.setAttributes(m,o),!0===u.wireframe&&(h=s.getWireframeAttribute());var v=this.getDrawMode(o);if(h){var y=this._bufferManager.get(h);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,y),r.drawElements(v,h.count,h.glType,0)}else{var p=o.geometry.getAttribute("position").count;r.drawArrays(v,0,p)}}}},{key:"getDrawMode",value:function(t){var e=this._gl,r=t.type,n=t.drawMode;return void 0===n&&(r===p?n=e.TRIANGLES:r===x?n=e.LINE_STRIP:r===M?n=e.LINES:r===b?n=e.LINE_LOOP:r===k&&(n=e.POINTS)),t.material.wireframe&&(n=e.LINES),n}},{key:"setClearColor",value:function(t){this._clearColor=t}},{key:"getRenderList",value:function(t){var e=[];if(!0===t.visible){t.geometry&&t.material&&e.push(t);for(var r=t.children,n=0,i=r.length;n<i;n++)e.push.apply(e,or()(this.getRenderList(r[n])))}return e}},{key:"clear",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=0,i=this._gl;t&&(n|=i.COLOR_BUFFER_BIT),e&&(n|=i.DEPTH_BUFFER_BIT),r&&(n|=i.STENCIL_BUFFER_BIT),i.clear(n)}},{key:"destroy",value:function(){this.domElement=null,this._gl=null,this._programManager.destroy(),this._bufferManager.destroy()}}]),t}();r.d(e,"Clock",(function(){return h})),r.d(e,"constants",(function(){return n})),r.d(e,"AnimationClip",(function(){return U})),r.d(e,"AnimationMixer",(function(){return B})),r.d(e,"KeyFrameTrack",(function(){return Q})),r.d(e,"NumberKeyFrameTrack",(function(){return J})),r.d(e,"QuaternionKeyFrameTrack",(function(){return et})),r.d(e,"VectorKeyFrameTrack",(function(){return rt})),r.d(e,"Camera",(function(){return At})),r.d(e,"OrthographicCamera",(function(){return Tt})),r.d(e,"PerspectiveCamera",(function(){return zt})),r.d(e,"OrbitController",(function(){return It})),r.d(e,"BoxGeometry",(function(){return Nt})),r.d(e,"Geometry",(function(){return Lt})),r.d(e,"PlaneGeometry",(function(){return jt})),r.d(e,"WireframeGeometry",(function(){return Bt})),r.d(e,"AxesHelper",(function(){return Ht})),r.d(e,"CameraHelper",(function(){return Zt})),r.d(e,"GridHelper",(function(){return Kt})),r.d(e,"LineBasicMaterial",(function(){return Yt})),r.d(e,"Material",(function(){return Wt})),r.d(e,"PointsMaterial",(function(){return Qt})),r.d(e,"Box3",(function(){return Ct})),r.d(e,"Color",(function(){return Gt})),r.d(e,"Euler",(function(){return gt})),r.d(e,"Mat3",(function(){return dt})),r.d(e,"Mat4",(function(){return ot})),r.d(e,"Quaternion",(function(){return $})),r.d(e,"Spherical",(function(){return Et})),r.d(e,"mathUtils",(function(){return i})),r.d(e,"Vec3",(function(){return at})),r.d(e,"CubicSplineInterpolant",(function(){return K})),r.d(e,"Interpolant",(function(){return q})),r.d(e,"LinearInterpolant",(function(){return X})),r.d(e,"QuaternionLinearInterpolant",(function(){return tt})),r.d(e,"StepInterpolant",(function(){return Z})),r.d(e,"GraphObject",(function(){return wt})),r.d(e,"Group",(function(){return Jt})),r.d(e,"Line",(function(){return $t})),r.d(e,"LineSegments",(function(){return Dt})),r.d(e,"Mesh",(function(){return te})),r.d(e,"Points",(function(){return ee})),r.d(e,"Scene",(function(){return re})),r.d(e,"BufferAttribute",(function(){return Ft})),r.d(e,"WebGLBufferManager",(function(){return ne})),r.d(e,"WebGLCapabilities",(function(){return ie})),r.d(e,"WebGLProgram",(function(){return tr})),r.d(e,"WebGLProgramManager",(function(){return ir})),r.d(e,"WebGLRenderer",(function(){return sr})),r.d(e,"WebGLUniforms",(function(){return Ke})),r.d(e,"shaders",(function(){return ce})),r.d(e,"ShaderCode",(function(){return ae})),r.d(e,"DiffuseUniform",(function(){return Ye})),r.d(e,"uniforms",(function(){return Ze})),r.d(e,"ModelMatrixUniform",(function(){return Ve})),r.d(e,"NormalMatrixUniform",(function(){return He})),r.d(e,"ProjectionMatrixUniform",(function(){return We})),r.d(e,"ViewMatrixUniform",(function(){return Ge})),r.d(e,"WebGLUniform",(function(){return Ue}))}])}));