!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.webglRenderEngine=e():t.webglRenderEngine=e()}(window,(function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=15)}([function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}},function(t,e){function r(e){return t.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},r(e)}t.exports=r},function(t,e,r){var n=r(8),i=r(9);t.exports=function(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?i(t):e}},function(t,e,r){var n=r(10);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}},function(t,e){t.exports=function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}},function(t,e,r){var n=r(11);function i(e,r,a){return"undefined"!=typeof Reflect&&Reflect.get?t.exports=i=Reflect.get:t.exports=i=function(t,e,r){var i=n(t,e);if(i){var a=Object.getOwnPropertyDescriptor(i,e);return a.get?a.get.call(r):a.value}},i(e,r,a||e)}t.exports=i},function(t,e,r){var n=r(12),i=r(13),a=r(14);t.exports=function(t){return n(t)||i(t)||a()}},function(t,e){function r(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=r=function(t){return typeof t}:t.exports=r=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(e)}t.exports=r},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e){function r(e,n){return t.exports=r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},r(e,n)}t.exports=r},function(t,e,r){var n=r(2);t.exports=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=n(t)););return t}},function(t,e){t.exports=function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}},function(t,e){t.exports=function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(t,e,r){"use strict";r.r(e);var n={};r.r(n),r.d(n,"GL_DRAW_MODE_POINTS",(function(){return l})),r.d(n,"GL_DRAW_MODE_LINES",(function(){return c})),r.d(n,"GL_DRAW_MODE_LINE_STRIP",(function(){return f})),r.d(n,"GL_DRAW_MODE_LINE_LOOP",(function(){return d})),r.d(n,"GL_DRAW_MODE_TRIANGLES",(function(){return m})),r.d(n,"GL_DRAW_MODE_TRIANGLE_STRIP",(function(){return v})),r.d(n,"GL_DRAW_MODE_TRIANGLE_FAN",(function(){return y})),r.d(n,"OBJECT_TYPE_MESH",(function(){return p})),r.d(n,"OBJECT_TYPE_PERSPECTIVE_CAMERA",(function(){return _})),r.d(n,"OBJECT_TYPE_ORTHOGRAPHIC_CAMERA",(function(){return g})),r.d(n,"OBJECT_TYPE_LINE",(function(){return x})),r.d(n,"OBJECT_TYPE_LINE_SEGMENTS",(function(){return M})),r.d(n,"OBJECT_TYPE_LINE_LOOP",(function(){return E})),r.d(n,"OBJECT_TYPE_POINTS",(function(){return b})),r.d(n,"OBJECT_TYPE_GROUP",(function(){return k})),r.d(n,"OBJECT_TYPE_SCENE",(function(){return T})),r.d(n,"OBJECT_TYPE_BONE",(function(){return w})),r.d(n,"OBJECT_TYPE_SKELETON",(function(){return A})),r.d(n,"OBJECT_TYPE_SKINNED_MESH",(function(){return I})),r.d(n,"MATERIAL_TYPE_BASIC",(function(){return P})),r.d(n,"MATERIAL_TYPE_LINE_BASIC",(function(){return S})),r.d(n,"LINEAR_INTERPOLATION",(function(){return R})),r.d(n,"STEP_INTERPOLATION",(function(){return z})),r.d(n,"CUBIC_SPLINE_INTERPOLATION",(function(){return N})),r.d(n,"DATA_TEXTURE",(function(){return O})),r.d(n,"REPEAT_WRAPPING",(function(){return L})),r.d(n,"CLAMP_TO_EDGE_WRAPPING",(function(){return F})),r.d(n,"MIRRORED_REPEAT_WRAPPING",(function(){return C})),r.d(n,"NEAREST_FILTER",(function(){return B})),r.d(n,"NEAREST_MIPMAP_NEAREST_FILTER",(function(){return U})),r.d(n,"NEAREST_MIPMAP_LINEAR_FILTER",(function(){return D})),r.d(n,"LINEAR_FILTER",(function(){return W})),r.d(n,"LINEAR_MIPMAP_NEAREST_FILTER",(function(){return G})),r.d(n,"LINEAR_MIPMAP_LINEAR_FILTER",(function(){return j})),r.d(n,"RGBA_FORMAT",(function(){return V})),r.d(n,"UNSIGNED_BYTE_TYPE",(function(){return Y})),r.d(n,"FLOAT_TYPE",(function(){return X}));var i={};r.r(i),r.d(i,"clamp",(function(){return q})),r.d(i,"degToRad",(function(){return K})),r.d(i,"radToDeg",(function(){return J})),r.d(i,"arrayMax",(function(){return Q})),r.d(i,"generateUid",(function(){return tt}));var a=r(0),s=r.n(a),o=r(1),u=r.n(o),h=function(){function t(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];s()(this,t),this._autoStart=e,this._startTime=0,this._prevTime=0,this._elapsedTime=0}return u()(t,[{key:"now",value:function(){return(performance||Date).now()}},{key:"start",value:function(){this._startTime=this.now(),this._prevTime=this._startTime,this._elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getDeltaTime(),this.running=!1}},{key:"getDeltaTime",value:function(){var t=0;if(!this.running&&this._autoStart)return this.start(),t;if(this.running){var e=this.now();t=(e-this._prevTime)/1e3,this._prevTime=e,this._elapsedTime+=t}return t}},{key:"getElapsedTime",value:function(){return this.getDeltaTime(),this._elapsedTime}}]),t}(),l=0,c=1,f=2,d=3,m=4,v=5,y=6,p=0,_=1,g=2,x=3,M=4,E=5,b=7,k=8,T=9,w=10,A=11,I=12,P="BasicMaterial",S="LineBasicMaterial",R=2020,z=2021,N=2022,O="DATA_TEXTRUE",L="REPEAT_WRAPPING",F="CLAMP_TO_EDGE_WRAPPING",C="MIRRORED_REPEAT_WRAPPING",B="NEAREST_FILTER",U="NEAREST_MIPMAP_NEAREST_FILTER",D="NEAREST_MIPMAP_LINEAR_FILTER",W="LINEAR_FILTER",G="LINEAR_MIPMAP_NEAREST_FILTER",j="LINEAR_MIPMAP_LINEAR_FILTER",V="RGBA_FORMAT",Y="UNSIGNED_BYTE_TYPE",X="FLOAT_TYPE",H=Math.PI/180,Z=180/Math.PI;function q(t,e,r){return Math.min(r,Math.max(e,t))}function K(t){return t*H}function J(t){return t*Z}function Q(t){if(0===t.length)return-1/0;for(var e=t[0],r=1,n=t.length;r<n;r++)t[r]>e&&(e=t[r]);return e}var $=0;function tt(){return $++}var et=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2?arguments[2]:void 0;s()(this,t),this.name=e,this.duration=r,this.tracks=n,this.uid=tt(),this.duration<0&&this.setDurationFromTracks()}return u()(t,[{key:"setDurationFromTracks",value:function(){for(var t=this.tracks,e=0,r=0,n=t.length;r<n;r++){var i=t[r];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this}}]),t}(),rt=function(){function t(e){s()(this,t),this._clips=e,this._time=0,this.timeScale=1}return u()(t,[{key:"update",value:function(t){t*=this.timeScale,this._time+=t;for(var e=this._time,r=this._clips,n=0,i=r.length;n<i;n++){var a=r[n],s=a.tracks;e%=a.duration;for(var o=0,u=s.length;o<u;o++){var h=s[o],l=h.node,c=h.property,f=h.interpolant.evaluate(e);f&&("morphTargetInfluences"===c?l[c]=f:l[c].setFromArray(f))}}}},{key:"destroy",value:function(){}}]),t}(),nt=r(3),it=r.n(nt),at=r(2),st=r.n(at),ot=r(4),ut=r.n(ot),ht=function(){function t(e,r,n){s()(this,t),this.xArray=e,this.yArray=r,this.ySize=n}return u()(t,[{key:"evaluate",value:function(t){for(var e,r,n,i=this.xArray,a=0,s=i.length;a<s;a++){if(t===i[a]){0===a?(e=a+1,r=i[a],n=i[e]):(e=a,r=i[a-1],n=i[e]);break}if(t>i[a]&&t<i[a+1]){e=a+1,r=i[a],n=i[e];break}}return void 0!==e&&void 0!==r&&void 0!==n?this._interpolate(e,r,t,n):null}}]),t}(),lt=function(t){function e(){return s()(this,e),it()(this,st()(e).apply(this,arguments))}return ut()(e,t),u()(e,[{key:"_interpolate",value:function(t,e,r,n){for(var i=this.yArray,a=this.ySize,s=new i.constructor(a),o=t*a,u=o-a,h=(r-e)/(n-e),l=1-h,c=0,f=s.length;c<f;c++)s[c]=i[u+c]*l+i[o+c]*h;return s}}]),e}(ht),ct=function(t){function e(){return s()(this,e),it()(this,st()(e).apply(this,arguments))}return ut()(e,t),u()(e,[{key:"_interpolate",value:function(t){for(var e=this.yArray,r=this.ySize,n=new e.constructor(r),i=t*r,a=0,s=n.length;a<s;a++)n[a]=e[i+a];return n}}]),e}(ht),ft=function(t){function e(){return s()(this,e),it()(this,st()(e).apply(this,arguments))}return ut()(e,t),u()(e,[{key:"_interpolate",value:function(t,e,r,n){var i=this.xArray,a=this.yArray,s=this.ySize,o=new a.constructor(s),u=t-2,h=t+1,l=i[u],c=i[h];void 0===l&&(u=t,l=n),void 0===c&&(h=t-1,c=e);for(var f=(r-e)/(n-e),d=f*f,m=d*f,v=(e-n)/(e-l)*.5,y=(e-n)/(c-n)*.5,p=-(m-2*d+f)*v,_=(1+v)*m+(-1.5-2*v)*d+(-.5+v)*f+1,g=(-1-y)*m+(1.5+y)*d+.5*f,x=y*m-y*d,M=u*s,E=t*s,b=E-s,k=h*s,T=0;T<s;T++)o[T]=p*a[M+T]+_*a[b+T]+g*a[E+T]+x*a[k+T];return o}}]),e}(ht),dt=function(){function t(e,r,n,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:R;s()(this,t),this.node=e,this.property=r,this.name=e.name+"."+r,this.times=n,this.values=i,this.setInterpolant(a)}return u()(t,[{key:"getValueSize",value:function(){return this.values.length/this.times.length}},{key:"createLinearInterpolant",value:function(){return new lt(this.times,this.values,this.getValueSize())}},{key:"createStepInterpolant",value:function(){return new ct(this.times,this.values,this.getValueSize())}},{key:"createCubicSplineInterpolant",value:function(){return new ft(this.times,this.values,this.getValueSize())}},{key:"setInterpolant",value:function(t){var e;void 0===this.createInterpolant&&(t===R?e=this.createLinearInterpolant:t===z?e=this.createStepInterpolant:t===N&&(e=this.createCubicSplineInterpolant),this.createInterpolant=e);this.interpolant=this.createInterpolant()}}]),t}(),mt=function(t){function e(){return s()(this,e),it()(this,st()(e).apply(this,arguments))}return ut()(e,t),e}(dt),vt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;s()(this,t),this._x=e,this._y=r,this._z=n,this._w=i}return u()(t,[{key:"set",value:function(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._w=n,this}},{key:"copy",value:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this}},{key:"setFromArray",value:function(t){this._x=t[0],this._y=t[1],this._z=t[2],this._w=t[3]}},{key:"setFromEuler",value:function(t){var e=t.x,r=t.y,n=t.z,i=t.order,a=Math.cos(e/2),s=Math.cos(r/2),o=Math.cos(n/2),u=Math.sin(e/2),h=Math.sin(r/2),l=Math.sin(n/2);return"XYZ"===i?(this._x=u*s*o+a*h*l,this._y=a*h*o-u*s*l,this._z=a*s*l+u*h*o,this._w=a*s*o-u*h*l):"YXZ"===i?(this._x=u*s*o+a*h*l,this._y=a*h*o-u*s*l,this._z=a*s*l-u*h*o,this._w=a*s*o+u*h*l):"ZXY"===i?(this._x=u*s*o-a*h*l,this._y=a*h*o+u*s*l,this._z=a*s*l+u*h*o,this._w=a*s*o-u*h*l):"ZYX"===i?(this._x=u*s*o-a*h*l,this._y=a*h*o+u*s*l,this._z=a*s*l-u*h*o,this._w=a*s*o+u*h*l):"YZX"===i?(this._x=u*s*o+a*h*l,this._y=a*h*o+u*s*l,this._z=a*s*l-u*h*o,this._w=a*s*o-u*h*l):"XZY"===i&&(this._x=u*s*o-a*h*l,this._y=a*h*o-u*s*l,this._z=a*s*l+u*h*o,this._w=a*s*o+u*h*l),this}},{key:"setFromAxisAngle",value:function(t,e){var r=e/2,n=Math.sin(r),i=Math.cos(r);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=i,this}},{key:"setFromRotationMatrix",value:function(t){var e,r=t.elements,n=r[0],i=r[4],a=r[8],s=r[1],o=r[5],u=r[9],h=r[2],l=r[6],c=r[10],f=n+o+c;return f>0?(e=.5/Math.sqrt(f+1),this._w=.25/e,this._x=(l-u)*e,this._y=(a-h)*e,this._z=(s-i)*e):n>o&&n>c?(e=2*Math.sqrt(1+n-o-c),this._w=(l-u)/e,this._x=.25*e,this._y=(i+s)/e,this._z=(a+h)/e):o>c?(e=2*Math.sqrt(1+o-n-c),this._w=(a-h)/e,this._x=(i+s)/e,this._y=.25*e,this._z=(u+l)/e):(e=2*Math.sqrt(1+c-n-o),this._w=(s-i)/e,this._x=(a+h)/e,this._y=(u+l)/e,this._z=.25*e),this}},{key:"setFromQuaternionsProduct",value:function(t,e){var r=t.x,n=t.y,i=t.z,a=t.w,s=e.x,o=e.y,u=e.z,h=e.w;return this._x=r*h+a*s+n*u-i*o,this._y=n*h+a*o+i*s-r*u,this._z=i*h+a*u+r*o-n*s,this._w=a*h-r*s-n*o-i*u,this}},{key:"conjugate",value:function(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this}},{key:"multiply",value:function(t){return this.setFromQuaternionsProduct(this,t)}},{key:"premultiply",value:function(t){return this.setFromQuaternionsProduct(t,this)}},{key:"inverse",value:function(){return this.conjugate()}},{key:"dot",value:function(t){return this._x*t.x+this._y*t.y+this._z*t.z+this._w*t.w}},{key:"lengthSquared",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"normalize",value:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(this._x/=t,this._y/=t,this._z/=t,this._w/=t),this}},{key:"slerp",value:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var r=this._x,n=this._y,i=this._z,a=this._w,s=a*t.w+r*t.x+n*t.y+i*t.z;if(s>=1)return this;s<0?(this._x=-t.x,this._y=-t.y,this._z=-t.z,this._w=-t.w,s=-s):this.copy(t);var o=Math.sqrt(1-s*s);if(o<=Number.EPSILON){var u=1-e;return this._w=u*a+e*this._w,this._x=u*r+e*this._x,this._y=u*n+e*this._y,this._z=u*i+e*this._z,this.normalize()}var h=Math.atan2(o,s),l=Math.sin((1-e)*h)/o,c=Math.sin(e*h)/o;return this._w=l*a+c*this._w,this._x=l*r+c*this._x,this._y=l*n+c*this._y,this._z=l*i+c*this._z,this}},{key:"x",get:function(){return this._x},set:function(t){this._x=t}},{key:"y",get:function(){return this._y},set:function(t){this._y=t}},{key:"z",get:function(){return this._z},set:function(t){this._z=t}},{key:"w",get:function(){return this._w},set:function(t){this._w=t}}],[{key:"slerp",value:function(t,e,r,n){return r.copy(t).slerp(e,n)}},{key:"slerpFlat",value:function(t,e,r,n,i,a,s){var o=r[n+0],u=r[n+1],h=r[n+2],l=r[n+3],c=i[a+0],f=i[a+1],d=i[a+2],m=i[a+3];if(l!==m||o!==c||u!==f||h!==d){var v=1-s,y=o*c+u*f+h*d+l*m,p=y>=0?1:-1,_=1-y*y;if(_>Number.EPSILON){var g=Math.sqrt(_),x=Math.atan2(g,y*p);v=Math.sin(v*x)/g,s=Math.sin(s*x)/g}var M=s*p;if(o=o*v+c*M,u=u*v+f*M,h=h*v+d*M,l=l*v+m*M,v===1-s){var E=1/Math.sqrt(o*o+u*u+h*h+l*l);o*=E,u*=E,h*=E,l*=E}}t[e+0]=o,t[e+1]=u,t[e+2]=h,t[e+3]=l}}]),t}(),yt=function(t){function e(){return s()(this,e),it()(this,st()(e).apply(this,arguments))}return ut()(e,t),u()(e,[{key:"_interpolate",value:function(t,e,r,n){var i=this.yArray,a=this.ySize,s=t*a,o=(r-e)/(n-e),u=new i.constructor(a);return vt.slerpFlat(u,0,i,s-a,i,s,o),u}}]),e}(ht),pt=function(t){function e(){return s()(this,e),it()(this,st()(e).apply(this,arguments))}return ut()(e,t),u()(e,[{key:"createLinearInterpolant",value:function(){return new yt(this.times,this.values,this.getValueSize())}}]),e}(dt),_t=function(t){function e(){return s()(this,e),it()(this,st()(e).apply(this,arguments))}return ut()(e,t),e}(dt),gt=r(6),xt=r.n(gt),Mt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;s()(this,t),this.x=e,this.y=r,this.z=n}return u()(t,[{key:"set",value:function(t,e,r){return this.x=t,this.y=e,this.z=r,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"setFromScalar",value:function(t){return this.x=t,this.y=t,this.z=t,this}},{key:"setFromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}},{key:"setFromVectorsSum",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}},{key:"setFromVectorsDiff",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}},{key:"setFromMatrixPosition",value:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}},{key:"setFromMatrix4Column",value:function(t,e){return this.setFromArray(t.elements,4*e)}},{key:"setFromMatrix3Column",value:function(t,e){return this.setFromArray(t.elements,3*e)}},{key:"getComponent",value:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("Vec3: 索引".concat(t,"超过边界"))}}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"subScalar",value:function(t){return this.addScalar(-t)}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"applyMatrix4",value:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements,a=1/(i[3]*e+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*e+i[4]*r+i[8]*n+i[12])*a,this.y=(i[1]*e+i[5]*r+i[9]*n+i[13])*a,this.z=(i[2]*e+i[6]*r+i[10]*n+i[14])*a,this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"cross",value:function(t){return this.setFromVectorsCross(this,t)}},{key:"setFromVectorsCross",value:function(t,e){var r=t.x,n=t.y,i=t.z,a=e.x,s=e.y,o=e.z;return this.x=n*o-i*s,this.y=i*a-r*o,this.z=r*s-n*a,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"setFromSphericalCoords",value:function(t,e,r){var n=Math.sin(e);return this.x=n*Math.sin(r)*t,this.y=Math.cos(e)*t,this.z=n*Math.cos(r)*t,this}},{key:"setFromSpherical",value:function(t){return this.setFromSphericalCoords(t.radius,t.theta,t.phi)}},{key:"setFromBufferAttribute",value:function(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}},{key:"project",value:function(t){return this.applyMatrix4(t.worldMatrixInverse).applyMatrix4(t.projectionMatrix)}},{key:"unproject",value:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.worldMatrix)}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}}]),t}(),Et=function(){function t(e){if(s()(this,t),e){for(var r=new Array(16),n=0;n<16;n++)r[n]=e[n];this.elements=r}else this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}return u()(t,[{key:"copy",value:function(t){var e=t.elements,r=this.elements;if(e!==r){for(var n=0;n<16;++n)r[n]=e[n];return this}}},{key:"set",value:function(t,e,r,n,i,a,s,o,u,h,l,c,f,d,m,v){var y=this.elements;return y[0]=t,y[4]=e,y[8]=r,y[12]=n,y[1]=i,y[5]=a,y[9]=s,y[13]=o,y[2]=u,y[6]=h,y[10]=l,y[14]=c,y[3]=f,y[7]=d,y[11]=m,y[15]=v,this}},{key:"setFromArray",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this.elements,n=0;n<16;++n)r[n]=t[e+n];return this}},{key:"toArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15],t}},{key:"multiply",value:function(t){return this.multiplyMatrices(this,t)}},{key:"premultiply",value:function(t){return this.multiplyMatrices(t,this)}},{key:"multiplyMatrices",value:function(t,e){var r=t.elements,n=e.elements,i=this.elements,a=r[0],s=r[4],o=r[8],u=r[12],h=r[1],l=r[5],c=r[9],f=r[13],d=r[2],m=r[6],v=r[10],y=r[14],p=r[3],_=r[7],g=r[11],x=r[15],M=n[0],E=n[4],b=n[8],k=n[12],T=n[1],w=n[5],A=n[9],I=n[13],P=n[2],S=n[6],R=n[10],z=n[14],N=n[3],O=n[7],L=n[11],F=n[15];return i[0]=a*M+s*T+o*P+u*N,i[4]=a*E+s*w+o*S+u*O,i[8]=a*b+s*A+o*R+u*L,i[12]=a*k+s*I+o*z+u*F,i[1]=h*M+l*T+c*P+f*N,i[5]=h*E+l*w+c*S+f*O,i[9]=h*b+l*A+c*R+f*L,i[13]=h*k+l*I+c*z+f*F,i[2]=d*M+m*T+v*P+y*N,i[6]=d*E+m*w+v*S+y*O,i[10]=d*b+m*A+v*R+y*L,i[14]=d*k+m*I+v*z+y*F,i[3]=p*M+_*T+g*P+x*N,i[7]=p*E+_*w+g*S+x*O,i[11]=p*b+_*A+g*R+x*L,i[15]=p*k+_*I+g*z+x*F,this}},{key:"determinant",value:function(){var t=this.elements,e=t[0],r=t[4],n=t[8],i=t[12],a=t[1],s=t[5],o=t[9],u=t[13],h=t[2],l=t[6],c=t[10],f=t[14],d=t[3],m=t[7],v=t[11],y=t[15];return i*o*l*d-n*u*l*d-i*s*c*d+r*u*c*d+n*s*f*d-r*o*f*d-i*o*h*m+n*u*h*m+i*a*c*m-e*u*c*m-n*a*f*m+e*o*f*m+i*s*h*v-r*u*h*v-i*a*l*v+e*u*l*v+r*a*f*v-e*s*f*v-n*s*h*y+r*o*h*y+n*a*l*y-e*o*l*y-r*a*c*y+e*s*c*y}},{key:"setInverseOf",value:function(t){var e=this.elements,r=t.elements,n=r[0],i=r[4],a=r[8],s=r[12],o=r[1],u=r[5],h=r[9],l=r[13],c=r[2],f=r[6],d=r[10],m=r[14],v=r[3],y=r[7],p=r[11],_=r[15],g=t.determinant();return e[0]=(h*m*y-l*d*y+l*f*p-u*m*p-h*f*_+u*d*_)/g,e[4]=(s*d*y-a*m*y-s*f*p+i*m*p+a*f*_-i*d*_)/g,e[8]=(a*l*y-s*h*y+s*u*p-i*l*p-a*u*_+i*h*_)/g,e[12]=(s*h*f-a*l*f-s*u*d+i*l*d+a*u*m-i*h*m)/g,e[1]=(l*d*v-h*m*v-l*c*p+o*m*p+h*c*_-o*d*_)/g,e[5]=(a*m*v-s*d*v+s*c*p-n*m*p-a*c*_+n*d*_)/g,e[9]=(s*h*v-a*l*v-s*o*p+n*l*p+a*o*_-n*h*_)/g,e[13]=(a*l*c-s*h*c+s*o*d-n*l*d-a*o*m+n*h*m)/g,e[2]=(u*m*v-l*f*v+l*c*y-o*m*y-u*c*_+o*f*_)/g,e[6]=(s*f*v-i*m*v-s*c*y+n*m*y+i*c*_-n*f*_)/g,e[10]=(i*l*v-s*u*v+s*o*y-n*l*y-i*o*_+n*u*_)/g,e[14]=(s*u*c-i*l*c-s*o*f+n*l*f+i*o*m-n*u*m)/g,e[3]=(h*f*v-u*d*v-h*c*y+o*d*y+u*c*p-o*f*p)/g,e[7]=(i*d*v-a*f*v+a*c*y-n*d*y-i*c*p+n*f*p)/g,e[11]=(a*u*v-i*h*v-a*o*y+n*h*y+i*o*p-n*u*p)/g,e[15]=(i*h*c-a*u*c+a*o*f-n*h*f-i*o*d+n*u*d)/g,this}},{key:"transpose",value:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}},{key:"setBasis",value:function(){}},{key:"setRotationFromEuler",value:function(t){var e=this.elements,r=t.x,n=t.y,i=t.z,a=Math.cos(r),s=Math.sin(r),o=Math.cos(n),u=Math.sin(n),h=Math.cos(i),l=Math.sin(i);if("XYZ"===t.order){var c=a*h,f=a*l,d=s*h,m=s*l;e[0]=o*h,e[4]=-o*l,e[8]=u,e[1]=f+d*u,e[5]=c-m*u,e[9]=-s*o,e[2]=m-c*u,e[6]=d+f*u,e[10]=a*o}else if("YXZ"===t.order){var v=o*h,y=o*l,p=u*h,_=u*l;e[0]=v+_*s,e[4]=p*s-y,e[8]=a*u,e[1]=a*l,e[5]=a*h,e[9]=-s,e[2]=y*s-p,e[6]=_+v*s,e[10]=a*o}else if("ZXY"===t.order){var g=o*h,x=o*l,M=u*h,E=u*l;e[0]=g-E*s,e[4]=-a*l,e[8]=M+x*s,e[1]=x+M*s,e[5]=a*h,e[9]=E-g*s,e[2]=-a*u,e[6]=s,e[10]=a*o}else if("ZYX"===t.order){var b=a*h,k=a*l,T=s*h,w=s*l;e[0]=o*h,e[4]=T*u-k,e[8]=b*u+w,e[1]=o*l,e[5]=w*u+b,e[9]=k*u-T,e[2]=-u,e[6]=s*o,e[10]=a*o}else if("YZX"===t.order){var A=a*o,I=a*u,P=s*o,S=s*u;e[0]=o*h,e[4]=S-A*l,e[8]=P*l+I,e[1]=l,e[5]=a*h,e[9]=-s*h,e[2]=-u*h,e[6]=I*l+P,e[10]=A-S*l}else if("XZY"===t.order){var R=a*o,z=a*u,N=s*o,O=s*u;e[0]=o*h,e[4]=-l,e[8]=u*h,e[1]=R*l+O,e[5]=a*h,e[9]=z*l-N,e[2]=N*l-z,e[6]=s*h,e[10]=O*l+R}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}},{key:"setRotationFromQauternion",value:function(t){return this.compose(It,t,Pt)}},{key:"setRotationFromAxisAngle",value:function(t,e){}},{key:"setRotationX",value:function(){}},{key:"setRotationY",value:function(){}},{key:"setRotationZ",value:function(){}},{key:"translate",value:function(t,e,r){var n=this.elements;return n[12]+=n[0]*t+n[4]*e+n[8]*r,n[13]+=n[1]*t+n[5]*e+n[9]*r,n[14]+=n[2]*t+n[6]*e+n[10]*r,n[15]+=n[3]*t+n[7]*e+n[11]*r,this}},{key:"setTranslate",value:function(t,e,r){return this.set(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1)}},{key:"scale",value:function(t,e,r){var n=this.elements;return n[0]*=t,n[4]*=e,n[8]*=r,n[1]*=t,n[5]*=e,n[9]*=r,n[2]*=t,n[6]*=e,n[10]*=r,n[3]*=t,n[7]*=e,n[11]*=r,this}},{key:"setScale",value:function(t,e,r){return this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1)}},{key:"lookAt",value:function(t,e,r){var n=this.elements;return wt.setFromVectorsDiff(t,e),0===wt.lengthSquared()&&(wt.z=1),wt.normalize(),kt.setFromVectorsCross(r,wt),0===kt.lengthSquared()&&(1===Math.abs(r.z)?wt.x+=1e-4:wt.z+=1e-4,wt.normalize(),kt.setFromVectorsCross(r,wt)),kt.normalize(),Tt.setFromVectorsCross(wt,kt),n[0]=kt.x,n[4]=Tt.x,n[8]=wt.x,n[1]=kt.y,n[5]=Tt.y,n[9]=wt.y,n[2]=kt.z,n[6]=Tt.z,n[10]=wt.z,this}},{key:"setPerspective",value:function(t,e,r,n,i,a){var s=this.elements;return s[0]=2*i/(e-t),s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2*i/(r-n),s[6]=0,s[7]=0,s[8]=(e+t)/(e-t),s[9]=(r+n)/(r-n),s[10]=-(a+i)/(a-i),s[11]=-1,s[12]=0,s[13]=0,s[14]=-2*i*a/(a-i),s[15]=0,this}},{key:"setOrthographic",value:function(t,e,r,n,i,a){var s=this.elements;return s[0]=2/(e-t),s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2/(r-n),s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=-2/(a-i),s[11]=0,s[12]=-(e+t)/(e-t),s[13]=-(r+n)/(r-n),s[14]=-(a+i)/(a-i),s[15]=1,this}},{key:"compose",value:function(t,e,r){var n=this.elements,i=e.x,a=e.y,s=e.z,o=e.w,u=r.x,h=r.y,l=r.z;return n[0]=(1-2*a*a-2*s*s)*u,n[1]=(2*i*a+2*s*o)*u,n[2]=(2*i*s-2*a*o)*u,n[3]=0,n[4]=(2*i*a-2*s*o)*h,n[5]=(1-2*i*i-2*s*s)*h,n[6]=(2*a*s+2*i*o)*h,n[7]=0,n[8]=(2*i*s+2*a*o)*l,n[9]=(2*a*s-2*i*o)*l,n[10]=(1-2*i*i-2*a*a)*l,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}},{key:"decompose",value:function(t,e,r){var n=this.elements,i=bt.set(n[0],n[1],n[2]).length(),a=bt.set(n[4],n[5],n[6]).length(),s=bt.set(n[8],n[9],n[10]).length();r.set(i,a,s),t.set(n[12],n[13],n[14]),At.copy(this);var o=At.elements;return o[0]/=i,o[1]/=i,o[2]/=i,o[4]/=a,o[5]/=a,o[6]/=a,o[8]/=s,o[9]/=s,o[10]/=s,e.setFromRotationMatrix(At),this}},{key:"extractRotation",value:function(t){var e=this.elements,r=t.elements,n=bt.set(r[0],r[1],r[2]).length(),i=bt.set(r[4],r[5],r[6]).length(),a=bt.set(r[8],r[9],r[10]).length();return e[0]=r[0]/n,e[4]=r[4]/i,e[8]=r[8]/a,e[12]=0,e[1]=r[1]/n,e[5]=r[5]/i,e[9]=r[9]/a,e[13]=0,e[2]=r[2]/n,e[6]=r[6]/i,e[10]=r[10]/a,e[14]=0,e[3]=0,e[7]=0,e[11]=0,e[15]=1,this}}]),t}(),bt=new Mt,kt=new Mt,Tt=new Mt,wt=new Mt,At=new Et,It=new Mt(0,0,0),Pt=new Mt(1,1,1),St=function(){function t(){s()(this,t),this.elements=[1,0,0,0,1,0,0,0,1]}return u()(t,[{key:"set",value:function(t,e,r,n,i,a,s,o,u){var h=this.elements;return h[0]=t,h[3]=e,h[6]=r,h[1]=n,h[4]=i,h[7]=a,h[2]=s,h[5]=o,h[8]=u,this}},{key:"setFromMatrix4",value:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}},{key:"setInverseOf",value:function(t){var e=t.elements,r=this.elements,n=e[0],i=e[3],a=e[6],s=e[1],o=e[4],u=e[7],h=e[2],l=e[5],c=e[8],f=this.determinant();return r[0]=(o*c-u*l)/f,r[1]=(u*h-s*c)/f,r[2]=(s*l-o*h)/f,r[3]=(a*l-i*c)/f,r[4]=(n*c-a*h)/f,r[5]=(i*h-n*l)/f,r[6]=(i*u-a*o)/f,r[7]=(a*s-n*u)/f,r[8]=(n*o-i*s)/f,this}},{key:"determinant",value:function(){var t=this.elements,e=t[0],r=t[3],n=t[6],i=t[1],a=t[4],s=t[7],o=t[2],u=t[5],h=t[8];return e*a*h-e*s*u-r*i*h+r*s*o+n*i*u-n*a*o}},{key:"transpose",value:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}},{key:"getNormalMatrix",value:function(t){return this.setFromMatrix4(t).setInverseOf(this).transpose()}}]),t}(),Rt="XYZ",zt=new Et,Nt=new vt,Ot=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Rt;s()(this,t),this._x=e,this._y=r,this._z=n,this._order=i}return u()(t,[{key:"set",value:function(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._order=n||this._order,this}},{key:"copy",value:function(t){return this.set(t.x,t.y,t.z,t.order)}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._order)}},{key:"setFromRotationMatrix",value:function(t,e){var r=t.elements,n=r[0],i=r[4],a=r[8],s=r[1],o=r[5],u=r[9],h=r[2],l=r[6],c=r[10];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(q(a,-1,1)),Math.abs(a)<1-Number.EPSILON?(this._x=Math.atan2(-u,c),this._z=Math.atan2(-i,n)):(this._x=Math.atan2(l,o),this._z=0)):"YXZ"===e?(this._x=Math.asin(-q(u,-1,1)),Math.abs(u)<1-Number.EPSILON?(this._y=Math.atan2(a,c),this._z=Math.atan2(s,o)):(this._y=Math.atan2(-h,n),this._z=0)):"ZXY"===e?(this._x=Math.asin(q(l,-1,1)),Math.abs(l)<1-Number.EPSILON?(this._y=Math.atan2(-h,c),this._z=Math.atan2(-i,o)):(this._y=0,this._z=Math.atan2(s,n))):"ZYX"===e?(this._y=Math.asin(-q(h,-1,1)),Math.abs(h)<1-Number.EPSILON?(this._x=Math.atan2(l,c),this._z=Math.atan2(s,n)):(this._x=0,this._z=Math.atan2(-i,o))):"YZX"===e?(this._z=Math.asin(q(s,-1,1)),Math.abs(s)<1-Number.EPSILON?(this._x=Math.atan2(-u,o),this._y=Math.atan2(-h,n)):(this._x=0,this._y=Math.atan2(a,c))):"XZY"===e?(this._z=Math.asin(-q(i,-1,1)),Math.abs(i)<1-Number.EPSILON?(this._x=Math.atan2(l,o),this._y=Math.atan2(a,n)):(this._x=Math.atan2(-u,c),this._y=0)):console.warn("Euler.setFromRotationMatrix：不支持的参数值order=".concat(e,"$")),this._order=e,this}},{key:"setFromQuaternion",value:function(t,e){return zt.setRotationFromQauternion(t),this.setFromRotationMatrix(zt,e)}},{key:"reorder",value:function(t){return Nt.setFromEuler(this),this.setFromQuaternion(Nt,t)}},{key:"setFromVector3",value:function(t,e){return this.set(t.x,t.y,t.z,e||this.order)}},{key:"x",set:function(t){this._x=t},get:function(){return this._x}},{key:"y",set:function(t){this._y=t},get:function(){return this._y}},{key:"z",set:function(t){this._z=t},get:function(){return this._z}},{key:"order",set:function(t){this._order=t},get:function(){return this._order}}]),t}(),Lt=new Mt,Ft=new Mt,Ct=new vt,Bt=new Et,Ut=!1;try{Ut=void 0!==Proxy}catch(t){console.error("浏览器不支持Proxy！")}var Dt=function(){function t(){s()(this,t),this.uid=tt(),this.children=[],this.parent=null,this.matrix=new Et,this.worldMatrix=new Et,this.modelViewMatrix=new Et,this.normalMatrix=new St,this.position=new Mt,this.scale=new Mt(1,1,1);var e=new Ot,r=Ut&&new Proxy(e,{set:function(t,e,r){return t[e]=r,n.setFromEuler(t),!0}}),n=new vt,i=Ut&&new Proxy(n,{set:function(t,r,n){return t[r]=n,e.setFromQuaternion(t),!0}});this.rotation=Ut?r:e,this.quaternion=Ut?i:n,this.up=new Mt(0,1,0),this.matrixAutoUpdate=!0,this._worldMatrixNeedsUpdate=!1,this.visible=!0}return u()(t,[{key:"add",value:function(t){null!=t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t)}},{key:"remove",value:function(t){var e=this.children.indexOf(t);e>=0&&(t.parent=null,this.children.splice(e,1))}},{key:"traverse",value:function(t){t(this);for(var e=this.children,r=0,n=e.length;r<n;r++){var i=e[r],a=t(i);if(!1===a)return a;if(!1===(a=i.traverse(t)))return a}}},{key:"getChildByUid",value:function(t){var e;return this.traverse((function(r){if(r.uid===t)return e=r,!1})),e}},{key:"updateMatrix",value:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this._worldMatrixNeedsUpdate=!0}},{key:"updateWorldMatrix",value:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this._worldMatrixNeedsUpdate||t)&&(null===this.parent?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiplyMatrices(this.parent.worldMatrix,this.matrix),this._worldMatrixNeedsUpdate=!1,t=!0);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].updateWorldMatrix(t)}},{key:"updateRelativeWorldMatrix",value:function(t,e){if(!0===t&&null!==this.parent&&this.parent.updateRelativeWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiplyMatrices(this.parent.worldMatrix,this.matrix),!0===e)for(var r=this.children,n=0,i=r.length;n<i;n++)r[n].updateRelativeWorldMatrix(!1,!0)}},{key:"lookAt",value:function(t,e,r){1===arguments.length?Lt.copy(t):Lt.set(t,e,r),this.updateRelativeWorldMatrix(!0,!1),Ft.setFromMatrixPosition(this.worldMatrix),this.isCamera||this.isLight?Bt.lookAt(Ft,Lt,this.up):Bt.lookAt(Lt,Ft,this.up),this.quaternion.setFromRotationMatrix(Bt);var n=this.parent;n&&(Bt.extractRotation(n.worldMatrix),Ct.setFromRotationMatrix(Bt),this.quaternion.premultiply(Ct.inverse()))}},{key:"applyMatrix",value:function(t){this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}},{key:"rotateOnAxis",value:function(t,e){return Ct.setFromAxisAngle(t,e),this.quaternion.multiply(Ct),this}},{key:"rotateOnWorldAxis",value:function(t,e){return Ct.setFromAxisAngle(t,e),this.quaternion.premultiply(Ct),this}},{key:"copy",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.worldMatrix.copy(t.worldMatrix),this._worldMatrixNeedsUpdate=t._worldMatrixNeedsUpdate,!0===e)for(var r=0,n=t.children.length;r<n;r++){var i=t.children[r];this.add(i.clone(e))}return this}},{key:"clone",value:function(t){return(new this.constructor).copy(this,t)}}]),t}(),Wt=function(t){function e(){var t;return s()(this,e),(t=it()(this,st()(e).call(this))).isCamera=!0,t.projectionMatrix=new Et,t.projectionMatrixInverse=new Et,t.inverseWorldMatrix=new Et,t}return ut()(e,t),u()(e,[{key:"updateWorldMatrix",value:function(){xt()(st()(e.prototype),"updateWorldMatrix",this).call(this),this.inverseWorldMatrix.setInverseOf(this.worldMatrix)}}]),e}(Dt),Gt=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;return s()(this,e),(t=it()(this,st()(e).call(this))).type=g,t.left=r,t.right=n,t.top=i,t.bottom=a,t.near=o,t.far=u,t.zoom=1,t.updateProjectionMatrix(),t}return ut()(e,t),u()(e,[{key:"updateProjectionMatrix",value:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2,i=r-t,a=r+t,s=n+e,o=n-e;this.projectionMatrix.setOrthographic(i,a,s,o,this.near,this.far),this.projectionMatrixInverse.setInverseOf(this.projectionMatrix)}}]),e}(Wt),jt=function(t){function e(t,r,n,i){var a;return s()(this,e),(a=it()(this,st()(e).call(this))).type=_,a.fovy=void 0===t?45*Math.PI/180:t,a.aspect=void 0===r?1:r,a.near=void 0===n?.1:n,a.far=void 0===i?1e3:i,a.updateProjectionMatrix(),a}return ut()(e,t),u()(e,[{key:"updateProjectionMatrix",value:function(){var t=this.near,e=t*Math.tan(.5*this.fovy),r=2*e,n=this.aspect*r,i=-.5*n;this.projectionMatrix.setPerspective(i,i+n,e,e-r,t,this.far),this.projectionMatrixInverse.setInverseOf(this.projectionMatrix)}}]),e}(Wt);var Vt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;s()(this,t),this.radius=e,this._theta=r,this._phi=n}return u()(t,[{key:"set",value:function(t,e,r){return this.radius=t,this.theta=e,this.phi=r,this}},{key:"setFromVector3",value:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}},{key:"setFromCartesianCoords",value:function(t,e,r){var n,i,a;return this.radius=Math.sqrt(t*t+e*e+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.acos((n=e/this.radius,i=-1,a=1,Math.min(a,Math.max(i,n)))),this.phi=Math.atan2(t,r)),this}},{key:"theta",get:function(){return this._theta},set:function(t){this._theta=Math.max(1e-6,Math.min(t,Math.PI-1e-6))}},{key:"phi",get:function(){return this._phi},set:function(t){this._phi=t}}]),t}(),Yt=new Mt,Xt=new Vt,Ht=function(){function t(e,r){s()(this,t),this.object=e,this.domElement=r,this.target=new Mt(0,0,0),this.enablePan=!0,this.panSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.minThetaAngle=0,this.maxThetaAngle=1/0,this.minPhiAngle=-1/0,this.maxPhiAngle=1/0,this.enableZoom=!0,this.zoomSpeed=1,this.minZoom=0,this.maxZoom=1/0,this.minDistance=0,this.maxDistance=1/0,this._panOffset=new Mt,this._deltaTheta=0,this._deltaPhi=0,this._scale=1,r.addEventListener("mousedown",this,!1),r.addEventListener("mousemove",this,!1),r.addEventListener("mouseup",this,!1),r.addEventListener("mouseout",this,!1),r.addEventListener("wheel",this,!1),document.addEventListener("keydown",this,!1),document.addEventListener("keyup",this,!1)}return u()(t,[{key:"handleEvent",value:function(t){switch(t.type){case"mousedown":this._handleMouseDown(t);break;case"mousemove":this._handleMouseMove(t);break;case"mouseup":case"mouseout":this._handleMouseUp(t);break;case"wheel":this._handleMouseWheel(t);break;case"keydown":this._handleKeyDown(t);break;case"keyup":this._handleKeyUp(t)}}},{key:"getMousePosition",value:function(t){return[t.clientX,t.clientY]}},{key:"update",value:function(){var t=this.object.position;Yt.copy(t).sub(this.target),Xt.setFromVector3(Yt),Xt.theta+=this._deltaTheta,Xt.theta=Math.max(this.minThetaAngle,Math.min(this.maxThetaAngle,Xt.theta)),Xt.phi+=this._deltaPhi,Xt.phi=Math.max(this.minPhiAngle,Math.min(this.maxPhiAngle,Xt.phi)),Xt.radius*=this._scale,Xt.radius=Math.max(this.minDistance,Math.min(this.maxDistance,Xt.radius)),this.target.add(this._panOffset),Yt.setFromSpherical(Xt),t.copy(this.target).add(Yt),this.object.lookAt(this.target),this.object.updateWorldMatrix()}},{key:"panLeft",value:function(t){var e=this.object.matrix;Yt.setFromMatrix4Column(e,0).multiplyScalar(-t),this._panOffset.add(Yt)}},{key:"panUp",value:function(t){var e=this.object.matrix;Yt.setFromMatrix4Column(e,1).multiplyScalar(t),this._panOffset.add(Yt)}},{key:"rotateLeft",value:function(t){this._deltaPhi-=t}},{key:"rotateUp",value:function(t){this._deltaTheta-=t}},{key:"_handleMouseDown",value:function(t){this._dragging=!0,this._lastMousePosition=this.getMousePosition(t)}},{key:"_handleMouseMove",value:function(t){if(this._dragging){var e=this.object,r=this.domElement,n=r.clientWidth,i=r.clientHeight,a=this.getMousePosition(t),s=a[0]-this._lastMousePosition[0],o=a[1]-this._lastMousePosition[1];if(this.enablePan&&this._shiftKeyDown)if(s*=this.panSpeed,o*=this.panSpeed,e.type===_){var u,h=e.position;Yt.copy(h).sub(this.target),u=Yt.length(),u*=Math.tan(.5*e.fovy),this.panLeft(s*(u/(n/2))),this.panUp(o*(u/(i/2)))}else e.type===g?(this.panLeft(s*((e.right-e.left)/n)),this.panUp(o*((e.top-e.bottom)/i))):(console.warn("object不是camera，不支持pan操作"),this.enablePan=!1);else{var l=this.rotateSpeed,c=2*Math.PI*o/i,f=2*Math.PI*s/n;this.rotateLeft(l*f),this.rotateUp(l*c)}this.update(),this._panOffset.set(0,0,0),this._deltaTheta=0,this._deltaPhi=0,this._lastMousePosition=a}}},{key:"_handleMouseUp",value:function(){this._dragging=!1}},{key:"_handleMouseWheel",value:function(t){if(this.object.type===_){var e=this._scale;t.deltaY>0?e/=Math.pow(.95,this.zoomSpeed):t.deltaY<0&&(e*=Math.pow(.95,this.zoomSpeed)),this._scale=e}else if(this.object.type===g){var r=this.object.zoom;t.deltaY>0?r*=Math.pow(.95,this.zoomSpeed):t.deltaY<0&&(r/=Math.pow(.95,this.zoomSpeed)),this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,r)),this.object.updateProjectionMatrix()}this.update(),this._scale=1}},{key:"_handleKeyDown",value:function(t){t.shiftKey&&!t.ctrlKey&&(this._shiftKeyDown=!0)}},{key:"_handleKeyUp",value:function(){this._shiftKeyDown=!1}},{key:"destroy",value:function(){this.domElement.removeEventListener("mousedown",this),this.domElement.removeEventListener("mousemove",this),this.domElement.removeEventListener("mouseup",this),this.domElement.removeEventListener("mouseout",this),this.domElement.removeEventListener("wheel",this),document.removeEventListener("keydown",this),document.removeEventListener("keyup",this)}}]),t}(),Zt=function(){function t(){s()(this,t),this._max=new Mt(-1/0,-1/0,-1/0),this._min=new Mt(1/0,1/0,1/0)}return u()(t,[{key:"setEmpty",value:function(){return this._max.set(-1/0,-1/0,-1/0),this._min.set(1/0,1/0,1/0),this}},{key:"copy",value:function(t){return this._max.copy(t.max),this._min.copy(t.min),this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"setFromObject",value:function(t){return this.setEmpty(),this.expandByObject(t),this}},{key:"expandByObject",value:function(t){t.updateRelativeWorldMatrix(!1,!1);var e=t.geometry;if(e){var r=e.getBoundingBox();qt.copy(r),qt.applyMatrix4(t.worldMatrix),this.expandByPoint(qt.max),this.expandByPoint(qt.min)}for(var n=t.children,i=0,a=n.length;i<a;i++)this.expandByObject(n[i]);return this}},{key:"setFromPoints",value:function(t){this.setEmpty();for(var e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this}},{key:"expandByPoint",value:function(t){return this._max.max(t),this._min.min(t),this}},{key:"setFromBufferAttribute",value:function(t){for(var e=1/0,r=1/0,n=1/0,i=-1/0,a=-1/0,s=-1/0,o=0,u=t.count;o<u;o++){var h=t.getX(o),l=t.getY(o),c=t.getZ(o);h<e&&(e=h),l<r&&(r=l),c<n&&(n=c),h>i&&(i=h),l>a&&(a=l),c>s&&(s=c)}return this.min.set(e,r,n),this.max.set(i,a,s),this}},{key:"getSize",value:function(){var t=new Mt;return this.isEmpty()?t.set(0,0,0):t.setFromVectorsDiff(this._max,this._min),t}},{key:"getCenter",value:function(){var t=new Mt;return this.isEmpty()?t.set(0,0,0):t.setFromVectorsSum(this._min,this._max).multiplyScalar(.5),t}},{key:"applyMatrix4",value:function(t){return this.isEmpty()||(Kt[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Kt[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Kt[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Kt[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Kt[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Kt[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Kt[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Kt[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Kt)),this}},{key:"max",get:function(){return this._max}},{key:"min",get:function(){return this._min}}]),t}(),qt=new Zt,Kt=[new Mt,new Mt,new Mt,new Mt,new Mt,new Mt,new Mt,new Mt],Jt=function(){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5?arguments[5]:void 0,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"STATIC_DRAW";s()(this,t),this.name=void 0,this.array=e,this.target=o,this.itemSize=r,this.count=e.length/r,this.normalized=n,this.usage=u,this.glType=this.getGLType(e),this.bytesPerElement=e.BYTES_PER_ELEMENT,this.offset=a,this.stride=i}return u()(t,[{key:"getGLType",value:function(t){var e;return t instanceof Float32Array?e="FLOAT":t instanceof Float64Array?console.warn("Unsupported data buffer format: Float64Array."):t instanceof Uint16Array?e="UNSIGNED_SHORT":t instanceof Int16Array?e="SHORT":t instanceof Uint32Array?e="UNSIGNED_INT":t instanceof Int32Array?e="INT":t instanceof Int8Array?e="BYTE":t instanceof Uint8Array&&(e="UNSIGNED_BYTE"),e}},{key:"getX",value:function(t){return this.array[this.itemSize*t]}},{key:"getY",value:function(t){return this.array[this.itemSize*t+1]}},{key:"getZ",value:function(t){return this.array[this.itemSize*t+2]}},{key:"getW",value:function(t){return this.array[this.itemSize*t+3]}},{key:"setXYZ",value:function(t,e,r,n){var i=this.itemSize*t;return this.array[i+0]=e,this.array[i+1]=r,this.array[i+2]=n,this}},{key:"setXYZW",value:function(t,e,r,n,i){var a=this.itemSize*t;return this.array[a+0]=e,this.array[a+1]=r,this.array[a+2]=n,this.array[a+3]=i,this}}]),t}(),Qt=new Zt,$t=new Mt,te=function(){function t(){s()(this,t),this.uid=tt(),this.vertices=[],this.normals=[],this.colors=[],this.indices=[],this._attributes={},this._morphAttributes={},this.morphTargetsRelative=!1}return u()(t,[{key:"setIndex",value:function(t){this.setAttribute("index",t),t.isIndex=!0}},{key:"setAttribute",value:function(t,e){this._attributes[t]=e,e.name=t}},{key:"removeAttribue",value:function(t){delete this._attributes[t]}},{key:"getAttribute",value:function(t){return this._attributes[t]}},{key:"getAttributes",value:function(){return this._attributes}},{key:"setMorphAttribute",value:function(t,e){this._morphAttributes[t]=e}},{key:"removeMorphAttribue",value:function(t){delete this._morphAttributes[t]}},{key:"getMorphAttribute",value:function(t){return this._morphAttributes[t]}},{key:"getMorphAttributes",value:function(){return this._morphAttributes}},{key:"getBoundingBox",value:function(){return this._boundingBox||(this._boundingBox=this.computeBoundingBox()),this._boundingBox}},{key:"computeBoundingBox",value:function(){var t=new Zt,e=this.getAttribute("position"),r=this.getMorphAttribute("position");if(e){if(t.setFromBufferAttribute(e),r)for(var n=0,i=r.length;n<i;n++)Qt.setFromBufferAttribute(r[n]),this.morphTargetsRelative?($t.setFromVectorsSum(t.max,Qt.max),t.expandByPoint($t),$t.setFromVectorsSum(t.min,Qt.min),t.expandByPoint($t)):(t.expandByPoint(Qt.max),t.expandByPoint(Qt.min))}else t.setEmpty();return t}},{key:"getWireframeAttribute",value:function(){if(!this._wireframeAttribute){var t=[],e=this.getAttribute("index"),r=this.getAttribute("position");if(e)for(var n=e.array,i=0,a=n.length;i<a;i+=3){var s=n[i],o=n[i+1],u=n[i+2];t.push(s,o,o,u,u,s)}else if(r)for(var h=0,l=r.array.length/3;h<l;h+=3){var c=h,f=h+1,d=h+2;t.push(c,f,f,d,d,c)}var m=Q(t)>65535?Uint32Array:Uint16Array,v=new Jt(new m(t),1);v.isIndex=!0,v.name="wireframeIndex",this._wireframeAttribute=v}return this._wireframeAttribute}}]),t}(),ee=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;return s()(this,e),(t=it()(this,st()(e).call(this,r,n,i,a,o,u))).numberOfVertices=0,t._buildPlane("x","y","z",1,1,r,n,i,a,o),t._buildPlane("x","y","z",1,1,r,n,-i,a,o),t._buildPlane("x","z","y",1,-1,r,i,n,a,o),t._buildPlane("x","z","y",1,-1,r,i,-n,a,o),t._buildPlane("z","y","x",1,1,i,n,r,a,o),t._buildPlane("z","y","x",1,1,i,n,-r,a,o),t.setIndex(new Jt(new Uint8Array(t.indices),1)),t.setAttribute("position",new Jt(new Float32Array(t.vertices),3)),t.setAttribute("normal",new Jt(new Float32Array(t.normals),3)),t}return ut()(e,t),u()(e,[{key:"_buildPlane",value:function(t,e,r,n,i,a,s,o,u,h){for(var l=a/2,c=s/2,f=o/2,d=a/u,m=s/h,v=u+1,y=h+1,p=0,_=new Mt,g=0;g<y;g++)for(var x=g*m-c,M=0;M<v;M++){var E=M*d-l;_[t]=E*n,_[e]=x*i,_[r]=f,this.vertices.push(_.x,_.y,_.z),_[t]=0,_[e]=0,_[r]=o>0?1:-1,this.normals.push(_.x,_.y,_.z),p++}for(var b=0;b<h;b++)for(var k=0;k<u;k++){var T=this.numberOfVertices,w=T+k+v*b,A=T+k+v*(b+1),I=T+(k+1)+v*(b+1),P=T+(k+1)+v*b;this.indices.push(w,P,I),this.indices.push(w,I,A)}this.numberOfVertices+=p}}]),e}(te),re=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3];s()(this,e);var i=r/2,a=n/2;return(t=it()(this,st()(e).call(this))).vertices.push(i,a,0,-i,a,0,-i,-a,0,i,-a,0),t.indices.push(0,1,3,1,2,3),t.setIndex(new Jt(new Uint8Array(t.indices),1)),t.setAttribute("position",new Jt(new Float32Array(t.vertices),3)),t}return ut()(e,t),e}(te),ne=new Mt,ie=function(t){function e(t){var r;s()(this,e),r=it()(this,st()(e).call(this,t));for(var n=t.getAttribute("index"),i=t.getAttribute("position"),a=0,o=n?n.count:i.count;a<o;a+=3)for(var u=0;u<3;u++){var h=void 0,l=void 0;n?(h=n.getX(a+u),l=n.getX(a+(u+1)%3)):(h=a+u,l=a+(u+1)%3),ne.setFromBufferAttribute(i,h),r.vertices.push(ne.x,ne.y,ne.z),ne.setFromBufferAttribute(i,l),r.vertices.push(ne.x,ne.y,ne.z)}return r.setAttribute("position",new Jt(new Float32Array(r.vertices),3)),r}return ut()(e,t),e}(te),ae=function(t){function e(t,r){var n;return s()(this,e),(n=it()(this,st()(e).call(this))).geometry=t,n.material=r,n.type=M,n.drawMode=c,n}return ut()(e,t),e}(Dt),se={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},oe=function(){function t(e,r,n){s()(this,t),1===arguments.length?this.set(e):this.setRGB(e,r,n)}return u()(t,[{key:"set",value:function(e){return e instanceof t?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e?this.setStyle(e):Array.isArray(e)?this.setFromArray(e):console.warn("Color: 错误的参数(".concat(e,")")),this}},{key:"setRGB",value:function(t,e,r){return this.r=t,this.g=e,this.b=r,this}},{key:"setHex",value:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}},{key:"setStyle",value:function(t){var e;if(e=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(t)){var r,n=e[1],i=e[2];"rgb"!==n&&"rgba"!==n||((r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))?(this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,parseFloat(r[5])<1&&console.warn("Alpha component of "+t+" will be ignored.")):(r=/^(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))&&(this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,parseFloat(r[5])<1&&console.warn("Alpha component of "+t+" will be ignored.")))}else if(e=/^#([A-Fa-f0-9]+)$/.exec(t)){var a=e[1],s=a.length;3===s?(this.r=parseInt(a.charAt(0)+a.charAt(0),16)/255,this.g=parseInt(a.charAt(1)+a.charAt(1),16)/255,this.b=parseInt(a.charAt(2)+a.charAt(2),16)/255):6===s&&(this.r=parseInt(a.charAt(0)+a.charAt(1),16)/255,this.g=parseInt(a.charAt(2)+a.charAt(3),16)/255,this.b=parseInt(a.charAt(4)+a.charAt(5),16)/255)}else t&&t.length>0&&this.setColorName(t);return this}},{key:"setColorName",value:function(t){var e=se[t];return void 0!==e?this.setHex(e):console.warn("Unknown color "+t),this}},{key:"setFromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}},{key:"copy",value:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}},{key:"clone",value:function(){return new this.constructor(this.r,this.g,this.b)}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e+0]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}}]),t}(),ue=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s()(this,t),this.uid=tt(),this.type=P,e.color&&(this.color=new oe(e.color)),this.vertexColors=!0===e.vertexColors,this.precision=null,this.wireframe=e.wireframe,this.morphTargets=!1,this.morphNormals=!1,this.skinning=!1},he=function(t){function e(t){var r;return s()(this,e),(r=it()(this,st()(e).call(this,t))).type=S,r}return ut()(e,t),e}(ue),le=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;s()(this,e);var r=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=new te;n.setAttribute("position",new Jt(new Float32Array(r),3)),n.setAttribute("color",new Jt(new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]),3));var i=new he({vertexColors:!0});return it()(this,st()(e).call(this,n,i))}return ut()(e,t),e}(ae),ce=new Wt,fe=new Mt,de=function(t){function e(t){var r;s()(this,e);var n=[],i=[],a={},o=new oe(16755200),u=new oe(16711680),h=new oe(43775),l=new oe(16777215),c=new oe(3355443);function f(t,e,r){d(t,r),d(e,r)}function d(t,e){n.push(0,0,0),i.push(e.r,e.g,e.b),void 0===a[t]&&(a[t]=[]),a[t].push(n.length/3-1)}f("p","n1",u),f("p","n2",u),f("p","n3",u),f("p","n4",u),f("n1","n2",o),f("n2","n3",o),f("n3","n4",o),f("n4","n1",o),f("f1","f2",o),f("f2","f3",o),f("f3","f4",o),f("f4","f1",o),f("n1","f1",o),f("n2","f2",o),f("n3","f3",o),f("n4","f4",o),f("u1","u2",h),f("u2","u3",h),f("u3","u1",h),f("p","c",l),f("c","t",l),f("cn1","cn3",c),f("cn2","cn4",c),f("cf1","cf3",c),f("cf2","cf4",c);var m=new te;m.setAttribute("position",new Jt(new Float32Array(n),3)),m.setAttribute("color",new Jt(new Float32Array(i),3));var v=new he({vertexColors:!0});return(r=it()(this,st()(e).call(this,m,v)))._pointMap=a,r._camera=t,r.matrix=t.worldMatrix,r.matrixAutoUpdate=!1,r.update(),r}return ut()(e,t),u()(e,[{key:"update",value:function(){var t=this.geometry.getAttribute("position"),e=this._pointMap;function r(r,n,i,a){fe.set(n,i,a).unproject(ce);var s=e[r];if(s&&t)for(var o=0,u=s.length;o<u;o++)t.setXYZ(s[o],fe.x,fe.y,fe.z)}this._camera.updateProjectionMatrix(),ce.projectionMatrixInverse.copy(this._camera.projectionMatrixInverse),r("c",0,0,-1),r("t",0,0,1),r("n1",1,1,-1),r("n2",-1,1,-1),r("n3",-1,-1,-1),r("n4",1,-1,-1),r("f1",1,1,1),r("f2",-1,1,1),r("f3",-1,-1,1),r("f4",1,-1,1),r("u1",.7,1.1,-1),r("u2",0,2,-1),r("u3",-.7,1.1,-1),r("cn1",0,1,-1),r("cn2",-1,0,-1),r("cn3",0,-1,-1),r("cn4",1,0,-1),r("cf1",0,1,1),r("cf2",-1,0,1),r("cf3",0,-1,1),r("cf4",1,0,1),t.needsUpdate=!0}}]),e}(ae),me=function(t){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#ccc",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#ff3352",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"#2890ff";s()(this,e);var o=t/2,u=t/r,h=[],l=[],c=r/2;n=new oe(n),i=new oe(i),a=new oe(a);for(var f=0,d=-o;f<=r;f++,d+=u)h.push(-o,0,d,o,0,d),f===c?(i.toArray(l,l.length),i.toArray(l,l.length)):(n.toArray(l,l.length),n.toArray(l,l.length)),h.push(d,0,-o,d,0,o),f===c?(a.toArray(l,l.length),a.toArray(l,l.length)):(n.toArray(l,l.length),n.toArray(l,l.length));var m=new te;m.setAttribute("position",new Jt(new Float32Array(h),3)),m.setAttribute("color",new Jt(new Float32Array(l),3));var v=new he({vertexColors:!0});return it()(this,st()(e).call(this,m,v))}return ut()(e,t),e}(ae),ve=function(t){function e(t){var r;return s()(this,e),(r=it()(this,st()(e).call(this,t))).pointSize=t.pointSize,r}return ut()(e,t),e}(ue),ye=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;s()(this,t),this.x=e,this.y=r,this.z=n,this.w=i}return u()(t,[{key:"set",value:function(t,e,r,n){return this.x=t,this.y=e,this.z=r,this.w=n,this}},{key:"setFromBufferAttribute",value:function(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}}]),t}(),pe=function(t){function e(){var t;return s()(this,e),(t=it()(this,st()(e).call(this))).type=w,t}return ut()(e,t),e}(Dt),_e=function(t){function e(){var t;return s()(this,e),(t=it()(this,st()(e).call(this))).type=k,t}return ut()(e,t),e}(Dt),ge=function(t){function e(t,r){var n;return s()(this,e),(n=it()(this,st()(e).call(this))).geometry=t,n.material=r,n.type=x,n}return ut()(e,t),u()(e,[{key:"update",value:function(){this.geometry.update(),this.material.update()}}]),e}(Dt),xe=function(t){function e(t,r){var n;return s()(this,e),(n=it()(this,st()(e).call(this))).geometry=t,n.material=r,n.type=p,n.morphTargetBaseInfluence=null,n.morphTargetInfluences=null,n.updateMorphTargetInfluences(),n}return ut()(e,t),u()(e,[{key:"copy",value:function(t,r){return xt()(st()(e.prototype),"copy",this).call(this,t,r),this.updateMorphTargetInfluences(),this}},{key:"clone",value:function(t){return new this.constructor(this.geometry,this.material).copy(this,t)}},{key:"updateMorphTargets",value:function(){for(var t=this.geometry,e=this.material,r=e.morphTargets&&t.getMorphAttribute("position"),n=e.morphNormals&&t.getMorphAttribute("normal"),i=this.morphTargetInfluences,a=0,s=0;s<8;s++){var o=i[s];o&&(r&&t.setAttribute("morphTarget".concat(s),r[s]),n&&t.setAttribute("morphNormal".concat(s),n[s]),a+=o)}this.morphTargetBaseInfluence=t.morphTargetsRelative?1:1-a}},{key:"updateMorphTargetInfluences",value:function(){var t=this.geometry.getMorphAttributes(),e=Object.keys(t);if(e.length>0){var r=t[e[0]];if(void 0!==r){this.morphTargetInfluences=[];for(var n=0,i=r.length;n<i;n++)this.morphTargetInfluences.push(0)}}}}]),e}(Dt),Me=function(t){function e(t,r){var n;return s()(this,e),(n=it()(this,st()(e).call(this))).geometry=t,n.material=r,n.type=b,n}return ut()(e,t),e}(Dt),Ee=function(t){function e(){var t;return s()(this,e),(t=it()(this,st()(e).call(this))).type=T,t}return ut()(e,t),e}(Dt),be=r(7),ke=r.n(be),Te=new Et,we=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1?arguments[1]:void 0;s()(this,t),this.type=A,this.bones=ke()(e),this.boneMatrices=new Float32Array(16*e.length),void 0===r?this.calculateInverseBones():this.inverseBones=ke()(r),this.boneTexture=null}return u()(t,[{key:"calculateInverseBones",value:function(){this.inverseBones=[];for(var t=0,e=this.bones.length;t<e;t++){var r=this.bones[t],n=new Et;n.setInverseOf(r.worldMatrix),this.inverseBones.push(n)}}},{key:"update",value:function(){for(var t=this.bones,e=this.inverseBones,r=this.boneMatrices,n=(this.boneTexture,0),i=t.length;n<i;n++){var a=t[n].worldMatrix;Te.multiplyMatrices(a,e[n]),Te.toArray(r,16*n)}}}]),t}(),Ae=new ye,Ie=function(t){function e(t,r){var n;return s()(this,e),(n=it()(this,st()(e).call(this,t,r))).type=I,n.bindMode=e.ATTACHED_MODE,n.bindMatrix=new Et,n.inverseBindMatrix=new Et,n}return ut()(e,t),u()(e,[{key:"updateWorldMatrix",value:function(t){xt()(st()(e.prototype),"updateWorldMatrix",this).call(this,t),this.bindMode===e.ATTACHED_MODE?this.inverseBindMatrix.setInverseOf(this.worldMatrix):this.bindMode===e.DETACHED_MODE&&this.inverseBindMatrix.setInverseOf(this.bindMatrix)}},{key:"bind",value:function(t,e){this.skeleton=t,this.material.skinning=!0,void 0===e&&(this.updateWorldMatrix(!0),e=this.worldMatrix),this.bindMatrix.copy(e),this.inverseBindMatrix.setInverseOf(e)}},{key:"normalizeSkinWeights",value:function(){for(var t=this.geometry.getAttribute("skinWeight"),e=0,r=t.count;e<r;e++){Ae.setFromBufferAttribute(t,e);var n=1/Ae.manhattanLength();n!==1/0?Ae.multiplyScalar(n):(console.warn("SkinnedMesh.normalizeSkinWeights: scale === Infinity"),Ae.set(1,0,0,0)),t.setXYZW(e,Ae.x,Ae.y,Ae.z,Ae.w)}}}]),e}(xe);Ie.ATTACHED_MODE=0,Ie.DETACHED_MODE=1;var Pe=function(){function t(e){s()(this,t),this._gl=e,this._buffers=new WeakMap}return u()(t,[{key:"createBuffer",value:function(t){var e=this._gl,r=t.array,n=t.usage,i=t.target,a=e.createBuffer();return"string"==typeof n&&(t.usage=n=e[n]),"string"==typeof t.glType&&(t.glType=e[t.glType]),void 0===i&&(i=!0===t.isIndex?e.ELEMENT_ARRAY_BUFFER:e.ARRAY_BUFFER,t.target=i),e.bindBuffer(i,a),e.bufferData(i,r,n),a}},{key:"get",value:function(t){var e=this._buffers.get(t);return e||(e=this.createBuffer(t),this._buffers.set(t,e)),e}},{key:"remove",value:function(t){var e=this.get(t);e&&(this._gl.deleteBuffer(e),this._buffers.delete(t))}},{key:"update",value:function(){}},{key:"destroy",value:function(){this._gl=null,this._buffers=null}}]),t}(),Se=function(){function t(e,r,n){var i=n.precision,a=void 0===i?"highp":i;s()(this,t),this._gl=e;var o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;this.isWebGL2=o;var u=this.getMaxPrecision(a);u!==a&&(a=u),this.precision=a;var h=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;this.vertexTextures=h;var l=o||!!r.getExtension("OES_texture_float");this.floatFragmentTextures=l,this.floatVertexTextures=h&&l,this.maxVertexUniforms=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),this.maxTextureUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return u()(t,[{key:"getMaxPrecision",value:function(t){var e=this._gl;if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}}]),t}(),Re=function(){function t(e){s()(this,t),this._gl=e,this._extensions={}}return u()(t,[{key:"getExtension",value:function(t){var e=this._gl,r=this._extensions,n=r[t];if(n)return n;switch(t){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(t)}return null===n&&console.warn("不支持WebGL拓展类型：".concat(t)),r[t]=n,n}}]),t}(),ze=function(){function t(e,r,n){s()(this,t),this._path=e,this._source=r,this._dependencies=n,this._compiled=!1}return u()(t,[{key:"getDependency",value:function(t){for(var e=0,r=this._dependencies,n=r.length;e<n;e++){var i=r[e];if(i._path===t)return i}}},{key:"compile",value:function(){if(!this._compiled){for(var t,e=/#include\s+['"]([^'"]*)['"]/g,r=this._source,n=[],i=this._source;null!==(t=e.exec(r));){var a=t[1],s=this.getDependency(a);s&&n.push([t[0],s.compile()])}for(var o=0,u=n.length;o<u;o++){var h=n[o];i=i.replace(h[0],h[1])}this._source=i,this._compiled=!0}return this._source}}]),t}(),Ne=new ze("./chunks/colorHead.vert","#ifdef USE_COLOR\r\n    varying vec3 vColor;\r\n    attribute vec3 color;\r\n#endif",[]),Oe=new ze("./chunks/colorMain.vert","#ifdef USE_COLOR\r\n    vColor = color;\r\n#endif",[]),Le=new ze("./base.vert","#include './chunks/colorHead.vert'\r\n\r\n/********************* morphTargets head start *********************/\r\n\r\n#ifdef USE_MORPHTARGETS\r\n\r\n    uniform float morphTargetBaseInfluence;\r\n\r\n    attribute vec3 morphTarget0;\r\n    attribute vec3 morphTarget1;\r\n    attribute vec3 morphTarget2;\r\n    attribute vec3 morphTarget3;\r\n\r\n    #ifdef USE_MORPHNORMALS\r\n\r\n        uniform float morphTargetInfluences[4];\r\n\r\n        attribute vec3 morphNormal0;\r\n        attribute vec3 morphNormal1;\r\n        attribute vec3 morphNormal2;\r\n        attribute vec3 morphNormal3;\r\n\r\n    #else\r\n\r\n        uniform float morphTargetInfluences[8];\r\n\r\n        attribute vec3 morphTarget4;\r\n        attribute vec3 morphTarget5;\r\n        attribute vec3 morphTarget6;\r\n        attribute vec3 morphTarget7;\r\n\r\n    #endif\r\n\r\n#endif\r\n\r\n/********************* morphTargets head end *********************/\r\n\r\n/********************* skin head start *********************/\r\n\r\n#ifdef USE_SKINNING\r\n\r\n    attribute vec4 skinIndex;\r\n    attribute vec4 skinWeight;\r\n\r\n    uniform mat4 bindMatrix;\r\n    uniform mat4 inverseBindMatrix;\r\n\r\n    #ifdef BONE_TEXTURE\r\n\r\n        uniform sampler2D boneTexture;\r\n        uniform float boneNum;\r\n\r\n        #define BONE_TEXTURE_COL0 ((0.5 + 0.0) / 4.)\r\n        #define BONE_TEXTURE_COL1 ((0.5 + 1.0) / 4.)\r\n        #define BONE_TEXTURE_COL2 ((0.5 + 2.0) / 4.)\r\n        #define BONE_TEXTURE_COL3 ((0.5 + 3.0) / 4.)\r\n\r\n        mat4 getBoneMatrix(const in float i) {\r\n\r\n            float y = (i + 0.5) / boneNum;\r\n\r\n            vec4 v1 = texture2D(boneTexture, vec2(BONE_TEXTURE_COL0, y));\r\n            vec4 v2 = texture2D(boneTexture, vec2(BONE_TEXTURE_COL1, y));\r\n            vec4 v3 = texture2D(boneTexture, vec2(BONE_TEXTURE_COL2, y));\r\n            vec4 v4 = texture2D(boneTexture, vec2(BONE_TEXTURE_COL3, y));\r\n\r\n            mat4 bone = mat4(v1, v2, v3, v4);\r\n\r\n            return bone;\r\n\r\n        }\r\n\r\n    #else\r\n\r\n        uniform mat4 boneMatrices[MAX_BONES];\r\n\r\n        // 参数格式： 存储限定符 参数限定符 类型 参数名\r\n        mat4 getBoneMatrix(const in float i) {\r\n            mat4 bone = boneMatrices[int(i)];\r\n            return bone;\r\n        }\r\n\r\n    #endif\r\n\r\n#endif\r\n\r\n/********************* skin head end *********************/\r\n\r\nattribute vec3 position;\r\nuniform mat4 modelViewMatrix;\r\nuniform mat4 projectionMatrix;\r\n\r\nattribute vec3 normal;\r\nuniform mat3 normalMatrix;\r\nvarying vec3 vNormal;\r\n\r\nvoid main() {\r\n\r\n    #include './chunks/colorMain.vert'\r\n\r\n    /********************* position main start *********************/\r\n\r\n    vec3 transformed = vec3(position);\r\n\r\n    /********************* morphTargets main start *********************/\r\n\r\n    #ifdef USE_MORPHTARGETS\r\n\r\n        transformed *= morphTargetBaseInfluence;\r\n        transformed += morphTarget0 * morphTargetInfluences[0];\r\n        transformed += morphTarget1 * morphTargetInfluences[1];\r\n        transformed += morphTarget2 * morphTargetInfluences[2];\r\n        transformed += morphTarget3 * morphTargetInfluences[3];\r\n\r\n        #ifndef USE_MORPHNORMALS\r\n\r\n            transformed += morphTarget4 * morphTargetInfluences[4];\r\n            transformed += morphTarget5 * morphTargetInfluences[5];\r\n            transformed += morphTarget6 * morphTargetInfluences[6];\r\n            transformed += morphTarget7 * morphTargetInfluences[7];\r\n\r\n        #endif\r\n\r\n    #endif\r\n\r\n    /********************* morphTargets end start *********************/\r\n\r\n    /********************* skin main start *********************/\r\n\r\n    #ifdef USE_SKINNING\r\n\r\n        mat4 boneMatX = getBoneMatrix(skinIndex.x);\r\n        mat4 boneMatY = getBoneMatrix(skinIndex.y);\r\n        mat4 boneMatZ = getBoneMatrix(skinIndex.z);\r\n        mat4 boneMatW = getBoneMatrix(skinIndex.w);\r\n\r\n        mat4 skinMatrix = mat4(0.0);\r\n        skinMatrix += skinWeight.x * boneMatX;\r\n        skinMatrix += skinWeight.y * boneMatY;\r\n        skinMatrix += skinWeight.z * boneMatZ;\r\n        skinMatrix += skinWeight.w * boneMatW;\r\n        skinMatrix = inverseBindMatrix * skinMatrix * bindMatrix;\r\n\r\n        transformed = (skinMatrix * vec4(transformed, 1.0)).xyz;\r\n\r\n    #endif\r\n\r\n    /********************* skin main end *********************/\r\n\r\n    vec4 mvPosition = vec4(transformed, 1.0);\r\n\r\n    mvPosition = modelViewMatrix * mvPosition;\r\n\r\n    gl_Position = projectionMatrix * mvPosition;\r\n\r\n    /********************* position main end *********************/\r\n\r\n    /********************* normal main start *********************/\r\n\r\n    vec3 objectNormal = vec3(normal);\r\n\r\n    #ifdef USE_MORPHNORMALS\r\n\r\n        objectNormal *= morphTargetBaseInfluence;\r\n        objectNormal += morphNormal0 * morphTargetInfluences[0];\r\n        objectNormal += morphNormal1 * morphTargetInfluences[1];\r\n        objectNormal += morphNormal2 * morphTargetInfluences[2];\r\n        objectNormal += morphNormal3 * morphTargetInfluences[3];\r\n\r\n    #endif\r\n\r\n    #ifdef USE_SKINNING\r\n\r\n        objectNormal = vec4(skinMatrix * vec4(objectNormal, 0.0)).xyz;\r\n\r\n    #endif\r\n\r\n    vec3 transformedNormal = objectNormal;\r\n\r\n    transformedNormal = normalMatrix * transformedNormal;\r\n\r\n    vNormal = normalize(transformedNormal);\r\n\r\n    /********************* normal main end *********************/\r\n\r\n}",[Ne,Oe]),Fe=new ze("./chunks/colorHead.frag","#ifdef USE_COLOR\r\n    varying vec3 vColor;\r\n#endif",[]),Ce=new ze("./chunks/colorMain.frag","#ifdef USE_COLOR\r\n    diffuseColor.rgb *= vColor;\r\n#endif",[]),Be={base:{vertex:Le,fragment:new ze("./base.frag",'#include "./chunks/colorHead.frag"\r\n\r\nuniform vec3 diffuse;\r\nvarying vec3 vNormal;\r\n\r\nvoid main() {\r\n\r\n    vec4 diffuseColor = vec4(diffuse, 1);\r\n\r\n    #include "./chunks/colorMain.frag"\r\n\r\n    vec4 lightColor = vec4(1, 1, 1, 1);\r\n    vec3 lightDirection = normalize(vec3(0.5, 3, 4));\r\n    vec4 ambientColor = vec4(0.2, 0.2, 0.2, 1);\r\n\r\n    vec3 normal = normalize(vNormal);\r\n\r\n    float fDot = max(dot(lightDirection, normal), 0.0);\r\n    vec4 ambient = ambientColor * diffuseColor;\r\n    gl_FragColor = vec4((lightColor * diffuseColor * fDot).xyz + ambient.xyz, diffuseColor.a);\r\n\r\n}',[Fe,Ce])},points:{vertex:new ze("./points.vert","attribute vec4 a_Position;\r\nattribute vec4 a_Color;\r\nattribute float a_PointSize;\r\nvarying vec4 v_Color;\r\nuniform mat4 u_MVPMatrix;\r\n\r\nvoid main() {\r\n    gl_Position = u_MVPMatrix * a_Position;\r\n    gl_PointSize = a_PointSize;\r\n    v_Color = a_Color;\r\n}",[]),fragment:new ze("./points.frag","varying vec4 v_Color;\r\n\r\nvoid main() {\r\n    float dist = distance(gl_PointCoord, vec2(0.5, 0.5));\r\n    if (dist < 0.5) {\r\n        gl_FragColor = v_Color;\r\n    } else {\r\n        discard;\r\n    }\r\n}",[])},line:{vertex:new ze("./line.vert","#include './chunks/colorHead.vert'\r\n\r\nattribute vec4 position;\r\n// uniform mat4 modelMatrix;\r\n// uniform mat4 viewMatrix;\r\nuniform mat4 projectionMatrix;\r\nuniform mat4 modelViewMatrix;\r\n\r\nvoid main() {\r\n\r\n    #include './chunks/colorMain.vert'\r\n\r\n    gl_Position = projectionMatrix * modelViewMatrix * position;\r\n\r\n}",[Ne,Oe]),fragment:new ze("./line.frag",'#include "./chunks/colorHead.frag"\r\n\r\nuniform vec3 diffuse;\r\n\r\nvoid main() {\r\n\r\n    vec4 diffuseColor = vec4(diffuse, 1);\r\n\r\n    #include "./chunks/colorMain.frag"\r\n\r\n    gl_FragColor = diffuseColor;\r\n\r\n}',[Fe,Ce])}};function Ue(t,e){if(t.length!==e.length)return!1;for(var r=0,n=t.length;r<n;r++)if(t[r]!==e[r])return!1;return!0}function De(t,e){for(var r=0,n=e.length;r<n;r++)t[r]=e[r]}function We(t,e){t.uniform1fv(this._addr,e)}function Ge(t,e){t.uniform2fv(this._addr,e)}function je(t,e){t.uniform3fv(this._addr,e)}function Ve(t,e){t.uniform4fv(this._addr,e)}function Ye(t,e){t.uniformMatrix2fv(this._addr,!1,e)}function Xe(t,e){t.uniformMatrix3fv(this._addr,!1,e)}function He(t,e){t.uniformMatrix4fv(this._addr,!1,e)}function Ze(t,e){t.uniform1iv(this._addr,e)}function qe(t,e){t.uniform2iv(this._addr,e)}function Ke(t,e){t.uniform3iv(this._addr,e)}function Je(t,e){t.uniform4iv(this._addr,e)}function Qe(t,e){var r=this._cache;r[0]!==e&&(t.uniform1f(this._addr,e),r[0]=e)}function $e(t,e){var r=this._cache;if(void 0!==e.x&&void 0!==e.y)r[0]===e.x&&r[1]===e.y||(t.uniform2f(this._addr,e.x,e.y),r[0]=e.x,r[1]=e.y);else{if(Ue(r,e))return;t.uniform2fv(this._addr,e),De(r,e)}}function tr(t,e){var r=this._cache;if(void 0!==e.x&&void 0!==e.y&&void 0!==e.z)r[0]===e.x&&r[1]===e.y&&r[2]===e.z||(t.uniform3f(this._addr,e.x,e.y,e.z),r[0]=e.x,r[1]=e.y,r[2]=e.z);else if(void 0!==e.r)r[0]===e.r&&r[1]===e.g&&r[2]===e.b||(t.uniform3f(this._addr,e.r,e.g,e.b),r[0]=e.r,r[1]=e.g,r[2]=e.b);else{if(Ue(r,e))return;t.uniform3fv(this._addr,e),De(r,e)}}function er(t,e){var r=this.cache;if(void 0!==e.x&&void 0!==e.y&&void 0!==e.z&&void 0!==e.w)r[0]===e.x&&r[1]===e.y&&r[2]===e.z&&r[3]===e.w||(t.uniform4f(this._addr,e.x,e.y,e.z,e.w),r[0]=e.x,r[1]=e.y,r[2]=e.z,r[3]=e.w);else{if(Ue(r,e))return;t.uniform4fv(this._addr,e),De(r,e)}}function rr(t,e){var r=this._cache;r[0]!==e&&(t.uniform1i(this._addr,e),r[0]=e)}function nr(t,e){void 0!==e.x?t.uniform2i(this._addr,e.x,e.y):t.uniform2iv(this._addr,e)}function ir(t,e){void 0!==e.x?t.uniform3i(this._addr,e.x,e.y,e.z):void 0!==e.r?t.uniform3i(this._addr,e.r,e.g,e.b):t.uniform3iv(this._addr,e)}function ar(t,e){void 0!==e.x?t.uniform4i(this._addr,e.x,e.y,e.z,e.w):t.uniform4iv(this._addr,e)}var sr=new Float32Array(16),or=new Float32Array(9),ur=new Float32Array(4);function hr(t,e){var r=this._cache,n=e.elements;if(void 0===n){if(Ue(r,e))return;t.uniformMatrix2fv(this._addr,!1,e),De(r,e)}else{if(Ue(r,n))return;ur.set(n),t.uniformMatrix2fv(this._addr,!1,ur),De(r,ur)}}function lr(t,e){var r=this._cache,n=e.elements;if(void 0===n){if(Ue(r,e))return;t.uniformMatrix3fv(this._addr,!1,e),De(r,e)}else{if(Ue(r,n))return;or.set(n),t.uniformMatrix3fv(this._addr,!1,or),De(r,or)}}function cr(t,e){var r=this._cache,n=e.elements;if(void 0===n){if(Ue(r,e))return;t.uniformMatrix4fv(this._addr,!1,e),De(r,e)}else{if(Ue(r,n))return;sr.set(n),t.uniformMatrix4fv(this._addr,!1,sr),De(r,sr)}}function fr(t,e,r){var n=this._cache,i=r.allocateTextrueUnit();n[0]!==i&&(t.uniform1i(this._addr,i),n[0]=i),r.setTexture2D(e,i)}var dr=function(){function t(e,r){s()(this,t),this._info=e,this._addr=r}return u()(t,[{key:"calculateValue",value:function(){throw"WebGLUnifrom子类没有实现 calculateValue(object, camera) 方法"}},{key:"setValue",value:function(){throw"WebGLUnifrom子类没有实现 setValue(object, camera) 方法"}}]),t}(),mr=function(t){function e(t,r){var n;return s()(this,e),(n=it()(this,st()(e).call(this,t,r)))._cache=[],n.setValue=function(t){switch(t){case 5126:return Qe;case 35664:return $e;case 35665:return tr;case 35666:return er;case 35674:return hr;case 35675:return lr;case 35676:return cr;case 5124:case 35670:return rr;case 35667:case 35671:return nr;case 35668:case 35672:return ir;case 35669:case 35673:return ar;case 35678:case 36198:return fr}}(t.type),n}return ut()(e,t),e}(dr),vr=function(t){function e(t,r){var n;return s()(this,e),(n=it()(this,st()(e).call(this,t,r))).setValue=function(t){switch(t){case 5126:return We;case 35664:return Ge;case 35665:return je;case 35666:return Ve;case 35674:return Ye;case 35675:return Xe;case 35676:return He;case 5124:case 35670:return Ze;case 35667:case 35671:return qe;case 35668:case 35672:return Ke;case 35669:case 35673:return Je}}(t.type),n}return ut()(e,t),e}(dr),yr=function(t){function e(){return s()(this,e),it()(this,st()(e).apply(this,arguments))}return ut()(e,t),u()(e,[{key:"calculateValue",value:function(t){return t.worldMatrix.elements}}]),e}(mr),pr=function(t){function e(){return s()(this,e),it()(this,st()(e).apply(this,arguments))}return ut()(e,t),u()(e,[{key:"calculateValue",value:function(t,e){return e.inverseWorldMatrix.elements}}]),e}(mr),_r=function(t){function e(){return s()(this,e),it()(this,st()(e).apply(this,arguments))}return ut()(e,t),u()(e,[{key:"calculateValue",value:function(t,e){return e.projectionMatrix.elements}}]),e}(mr),gr=function(t){function e(){return s()(this,e),it()(this,st()(e).apply(this,arguments))}return ut()(e,t),u()(e,[{key:"calculateValue",value:function(t){var e=t.material,r=e.color;return!0===e.wireframe?[0,0,0]:r||[1,1,1]}}]),e}(mr),xr=function(t){function e(){return s()(this,e),it()(this,st()(e).apply(this,arguments))}return ut()(e,t),u()(e,[{key:"calculateValue",value:function(t){return t.normalMatrix.elements}}]),e}(mr),Mr=function(t){function e(){return s()(this,e),it()(this,st()(e).apply(this,arguments))}return ut()(e,t),u()(e,[{key:"calculateValue",value:function(t){return t.modelViewMatrix.elements}}]),e}(mr),Er=function(t){function e(){return s()(this,e),it()(this,st()(e).apply(this,arguments))}return ut()(e,t),u()(e,[{key:"calculateValue",value:function(t){return t.updateMorphTargets(),t.morphTargetBaseInfluence}}]),e}(mr),br=function(t){function e(){return s()(this,e),it()(this,st()(e).apply(this,arguments))}return ut()(e,t),u()(e,[{key:"calculateValue",value:function(t){for(var e=t.morphTargetInfluences,r=void 0===e?0:e.length,n=new Float32Array(8),i=0;i<r;i++){var a=e[i];n[i]=a||0}return n}}]),e}(vr),kr=function(t){function e(){return s()(this,e),it()(this,st()(e).apply(this,arguments))}return ut()(e,t),u()(e,[{key:"calculateValue",value:function(t){return t.skeleton.boneMatrices}}]),e}(mr),Tr=function(t){function e(){return s()(this,e),it()(this,st()(e).apply(this,arguments))}return ut()(e,t),u()(e,[{key:"calculateValue",value:function(t){return t.inverseBindMatrix}}]),e}(mr),wr=function(t){function e(){return s()(this,e),it()(this,st()(e).apply(this,arguments))}return ut()(e,t),u()(e,[{key:"calculateValue",value:function(t){return t.bindMatrix}}]),e}(mr),Ar=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s()(this,e),t=it()(this,st()(e).call(this,r));var n=r.data,i=r.magFilter,a=void 0===i?B:i,o=r.minFilter,u=void 0===o?B:o,h=r.width,l=r.height;return t.type=O,t.image={data:n,width:h,height:l},t.magFilter=a,t.minFilter=u,t.generateMipmaps=!1,t.flipY=!1,t}return ut()(e,t),e}((function t(e){var r=e.image,n=e.format,i=void 0===n?V:n,a=e.texelType,o=void 0===a?Y:a,u=e.magFilter,h=void 0===u?W:u,l=e.minFilter,c=void 0===l?j:l,f=e.wrapS,d=void 0===f?F:f,m=e.wrapT,v=void 0===m?F:m;s()(this,t),this.uid=tt(),this.image=r,this.magFilter=h,this.minFilter=c,this.wrapT=v,this.wrapS=d,this.format=i,this.internalFormat=null,this.texelType=o})),Ir={modelMatrix:yr,viewMatrix:pr,projectionMatrix:_r,diffuse:gr,normalMatrix:xr,modelViewMatrix:Mr,morphTargetInfluences:br,morphTargetBaseInfluence:Er,boneMatrices:kr,inverseBindMatrix:Tr,bindMatrix:wr,boneTexture:function(t){function e(){return s()(this,e),it()(this,st()(e).apply(this,arguments))}return ut()(e,t),u()(e,[{key:"calculateValue",value:function(t){var e=t.skeleton;return e.boneTexture||(e.boneTexture=new Ar({data:e.boneMatrices,width:4,height:e.bones.length,texelType:X})),e.boneTexture}}]),e}(mr),boneNum:function(t){function e(){return s()(this,e),it()(this,st()(e).apply(this,arguments))}return ut()(e,t),u()(e,[{key:"calculateValue",value:function(t){return t.skeleton.bones.length}}]),e}(mr)},Pr=function(){function t(e,r){s()(this,t),this._uniformMap={};for(var n=e.getProgramParameter(r,e.ACTIVE_UNIFORMS),i=0;i<n;i++){var a=e.getActiveUniform(r,i),o=e.getUniformLocation(r,a.name);this.parseUniform(a,o)}}return u()(t,[{key:"parseUniform",value:function(t,e){var r=/([0-9A-Z_a-z]+)/g.exec(t.name)[1],n=new(0,Ir[r])(t,e);this.addUniform(r,n)}},{key:"addUniform",value:function(t,e){this._uniformMap[t]=e}},{key:"getUniform",value:function(t){return this._uniformMap[t]}},{key:"eachUniform",value:function(t){var e=this._uniformMap;for(var r in e){t(e[r])}}}]),t}();function Sr(t){var e,r=t.precision;return"highp"===r?e="#define HIGH_PRECISION":"mediump"===r?e="#define MEDIUM_PRECISION":"lowp"===r&&(e="#define LOW_PRECISION"),"\n        precision ".concat(r," float;\n        precision ").concat(r," int;\n        ").concat(e,"\n    ")}function Rr(t){return""!==t}var zr,Nr,Or,Lr=function(){function t(e,r){var n,i;s()(this,t),this._gl=e,this._attributes=null,this._uniforms=null,this.debug=!0,r.isRawShaderMaterial||(n=[Sr(r),"#define MAX_BONES "+r.maxBones,r.vertexColors?"#define USE_COLOR":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals?"#define USE_MORPHNORMALS":"",r.skinning?"#define USE_SKINNING":"",r.useBoneTexture?"#define BONE_TEXTURE":"","\n"].filter(Rr).join("\n"),i=[Sr(r),r.vertexColors?"#define USE_COLOR":"","\n"].filter(Rr).join("\n"));var a=Be[r.shaderType],o=n+a.vertex.compile(),u=i+a.fragment.compile(),h=this.createShader(e.VERTEX_SHADER,o),l=this.createShader(e.FRAGMENT_SHADER,u),c=this.createProgram(h,l);this._program=c,this._vertexShader=h,this._fragmentShader=l,this.usedTimes=0,e.deleteShader(h),e.deleteShader(l)}return u()(t,[{key:"createShader",value:function(t,e){var r=this._gl,n=r.createShader(t);if((r.shaderSource(n,e),r.compileShader(n),!0===this.debug)&&!r.getShaderParameter(n,r.COMPILE_STATUS)){var i=r.getShaderInfoLog(n),a=r.getShaderSource(n);console.error("创建Shader失败！错误信息：".concat(i,"\n").concat(function(t){for(var e=t.split("\n"),r=0,n=e.length;r<n;r++)e[r]=r+1+": "+e[r];return e.join("\n")}(a)))}return n}},{key:"createProgram",value:function(t,e){var r=this._gl,n=r.createProgram();if((r.attachShader(n,t),r.attachShader(n,e),r.linkProgram(n),!0===this.debug)&&!r.getProgramParameter(n,r.LINK_STATUS)){var i=r.getProgramInfoLog(n);console.error("创建program失败！错误信息：".concat(i))}return n}},{key:"getProgram",value:function(){return this._program}},{key:"getAttributes",value:function(){if(this._attributes)return this._attributes;for(var t=this._attributes={},e=this._gl,r=this._program,n=e.getProgramParameter(r,e.ACTIVE_ATTRIBUTES),i=0;i<n;i++){var a=e.getActiveAttrib(r,i).name,s=e.getAttribLocation(r,a);t[a]=s}return t}},{key:"getUniforms",value:function(){if(this._uniforms)return this._uniforms;var t=new Pr(this._gl,this._program);return this._uniforms=t,this._uniforms}},{key:"destroy",value:function(){this._gl.deleteProgram(this._program),this._program=null,this._gl=null}}]),t}(),Fr=r(5),Cr=r.n(Fr),Br=(zr={},Cr()(zr,P,"base"),Cr()(zr,S,"line"),zr),Ur=function(){function t(e,r){s()(this,t),this._gl=e,this._capabilities=r,this._programs={}}return u()(t,[{key:"getMaxBones",value:function(t){var e=this._capabilities;if(e.floatVertexTextures)return 1024;var r=t.skeleton.bones,n=e.maxVertexUniforms,i=Math.floor((n-20)/4);return(i=Math.min(i,r.length))<r.length?(console.warn("对象包含".concat(r.length,"个骨骼，但是此浏览器仅支持使用最多").concat(i,"个骨骼。")),0):i}},{key:"getParameters",value:function(t){var e=this._capabilities,r=t.material,n=r.type,i=Br[n],a=e.precision,s=e.floatVertexTextures,o=t.type===I?this.getMaxBones(t):0;if(null!==r.precision){var u=e.getMaxPrecision(r.precision);u!==r.precision&&console.warn("不支持material.precision = ".concat(r.precision,"，将使用").concat(u))}return{shaderType:i,vertexColors:r.vertexColors,morphTargets:r.morphTargets,morphNormals:r.morphNormals,skinning:r.skinning&&o>0,precision:a,maxBones:o,useBoneTexture:s}}},{key:"getProgramKey",value:function(t){return Object.values(t).map((function(t){return t})).join()}},{key:"getProgram",value:function(t,e){var r=this._gl,n=this._programs[t];return n||(this._programs[t]=n=new Lr(r,e)),n}},{key:"releaseProgram",value:function(t){var e=this._programs[t];e&&(e.destroy(),this._programs.delete(t))}},{key:"destroy",value:function(){for(var t in this._gl=null,this._programs)this.releaseProgram(t);this._programs=null}}]),t}();function Dr(t,e){return t===Y?e.UNSIGNED_BYTE:t===X?e.FLOAT:t===V?e.RGBA:void 0}Nr={},Cr()(Nr,L,"REPEAT"),Cr()(Nr,F,"CLAMP_TO_EDGE"),Cr()(Nr,C,"MIRRORED_REPEAT"),Or={},Cr()(Or,B,"NEAREST"),Cr()(Or,U,"NEAREST_MIPMAP_NEAREST"),Cr()(Or,D,"NEAREST_MIPMAP_LINEAR"),Cr()(Or,W,"LINEAR"),Cr()(Or,G,"LINEAR_MIPMAP_NEAREST"),Cr()(Or,j,"LINEAR_MIPMAP_LINEAR");var Wr=-1;function Gr(t){return t===B||t===U||t===D?"NEAREST":"LINEAR"}var jr=function(){function t(e,r,n){s()(this,t),this._gl=e,this._extensions=r,this._capabilities=n,this._textures=new WeakMap}return u()(t,[{key:"allocateTextrueUnit",value:function(){var t=this._capabilities.maxTextureUnits,e=++Wr;return e>=t&&console.warn("尝试使用".concat(e,"个纹理，但是浏览器仅支持").concat(t,"个！")),e}},{key:"resetTextrueUnits",value:function(){Wr=-1}},{key:"getWebGLTexture",value:function(t){var e=this._textures.get(t);void 0===e&&(e=this._gl.createTexture(),this._textures.set(t,e));return e}},{key:"setTexture2D",value:function(t,e){var r,n=this._gl;t.type,r=n.TEXTURE_2D;var i=this.getWebGLTexture(t);n.activeTexture(n.TEXTURE0+e),n.bindTexture(r,i),t.wrapS===F&&t.wrapT===F||console.warn("纹理不是2的幂。texture.wrapS和texture应该设置为CLAMP_TO_EDGE_WRAPPING"),n.texParameteri(r,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(r,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),t.minFilter!==B&&t.minFilter!==W&&console.warn("纹理不是2的幂。Texture.minFilter应该设置为NEAREST或LINEAR"),n.texParameteri(r,n.TEXTURE_MAG_FILTER,n[Gr(t.magFilter)]),n.texParameteri(r,n.TEXTURE_MIN_FILTER,n[Gr(t.minFilter)]);var a=t.image,s=Dr(t.format,n),o=Dr(t.texelType,n),u=this.getInternalFormat(t.internalFormat,s,o);t.type===O&&n.texImage2D(r,0,u,a.width,a.height,0,s,o,a.data)}},{key:"getInternalFormat",value:function(t,e,r){if(!1===this._capabilities.isWebGL2)return e}},{key:"resizeImage",value:function(){}}]),t}(),Vr=function(){function t(){s()(this,t),this._entries={}}return u()(t,[{key:"getEntry",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.MAP_ENTRY,n=this._entries[e];return n||(r===t.MAP_ENTRY?n=new Map:r===t.WEAK_MAP_ENTRY&&(n=new WeakMap),this._entries[e]=n),n}},{key:"removeEntry",value:function(t){delete this._entries[t]}}]),t}();Vr.MAP_ENTRY=0,Vr.WEAK_MAP_ENTRY=1;var Yr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.canvas,n=void 0===r?document.createElement("canvas"):r,i=e.autoClear,a=void 0===i||i,o=e.autoClearColor,u=void 0===o||o,h=e.autoClearDepth,l=void 0===h||h,c=e.autoClearStencil,f=void 0===c||c,d=e.precision;s()(this,t),this.domElement=n,this.stats=new Vr,this.autoClear=a,this.autoClearColor=u,this.autoClearDepth=l,this.autoClearStencil=f,this._pixelRatio=window.devicePixelRatio,this._clearColor=new oe("black");var m=this.getContext(this.domElement);this._extensionManager=new Re(m),this._capabilities=new Se(m,this._extensionManager,{precision:d}),this._programManager=new Ur(m,this._capabilities),this._bufferManager=new Pe(m),this._textureManager=new jr(m,this._extensionManager,this._capabilities),!1===this._capabilities.isWebGL2&&(this._extensionManager.getExtension("OES_element_index_uint"),this._extensionManager.getExtension("OES_texture_float"))}return u()(t,[{key:"getContext",value:function(){if(void 0===this._gl){for(var t=["webgl","experimental-webgl","webkit-3d","moz-webgl"],e=this.domElement,r=null,n=0;n<t.length;n++){try{r=e.getContext(t[n])}catch(t){}if(r)break}r||console.error("WebGLRenderer：读取context失败！"),this._gl=r}return this._gl}},{key:"setSize",value:function(t,e,r){this._width=t,this._height=e,this.domElement.width=Math.floor(t*this._pixelRatio),this.domElement.height=Math.floor(e*this._pixelRatio),!1!==r&&(this.domElement.style.width=t+"px",this.domElement.style.height=e+"px"),this.setViewport(0,0,t,e)}},{key:"setViewport",value:function(t,e,r,n){this._gl.viewport(t,e,r,n)}},{key:"setAttributes",value:function(t,e){var r=this._gl,n=t.getAttributes(),i=e.geometry.getAttributes();for(var a in n){var s=n[a];if(s>=0){var o=i[a];if(o){var u=this._bufferManager.get(o),h=o.itemSize,l=o.glType,c=o.target,f=o.normalized,d=o.stride,m=o.offset;r.enableVertexAttribArray(s),r.bindBuffer(c,u),r.vertexAttribPointer(s,h,l,f,d,m)}}}}},{key:"setUniforms",value:function(t,e,r){var n=this._gl,i=this._textureManager;t.getUniforms().eachUniform((function(t){var a=t.calculateValue(e,r);t.setValue(n,a,i)}))}},{key:"render",value:function(t,e){var r=this._gl,n=this._textureManager,i=this._programManager;t.updateWorldMatrix(),r.enable(r.DEPTH_TEST),r.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,1),this.autoClear&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);for(var a=this.getRenderList(t),s=0;s<a.length;s++){var o=a[s],u=o.geometry,h=o.material,l=u.getAttribute("index"),c=u.getAttribute("position");if(l){if(0===l.count)return}else if(!c||0===c.count)return;var f=i.getParameters(o),d=i.getProgramKey(f),m=i.getProgram(d,f),v=m.getProgram();this._currentProgram!==v&&(this._currentProgram=v,r.useProgram(v)),n.resetTextrueUnits(),o.modelViewMatrix.multiplyMatrices(e.inverseWorldMatrix,o.worldMatrix),o.normalMatrix.getNormalMatrix(o.modelViewMatrix),o.type===I&&o.skeleton.update(),this.setUniforms(m,o,e),this.setAttributes(m,o),!0===h.wireframe&&(l=u.getWireframeAttribute());var y=this.getDrawMode(o);if(l){var p=this._bufferManager.get(l);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,p),r.drawElements(y,l.count,l.glType,0)}else{var _=o.geometry.getAttribute("position").count;r.drawArrays(y,0,_)}}}},{key:"getDrawMode",value:function(t){var e=this._gl,r=t.type,n=t.drawMode;return void 0===n&&(r===p||I?n=e.TRIANGLES:r===x?n=e.LINE_STRIP:r===M?n=e.LINES:r===E?n=e.LINE_LOOP:r===b&&(n=e.POINTS)),t.material.wireframe&&(n=e.LINES),n}},{key:"setClearColor",value:function(t){this._clearColor=t}},{key:"getRenderList",value:function(t){var e=[];if(!0===t.visible){t.geometry&&t.material&&e.push(t);for(var r=t.children,n=0,i=r.length;n<i;n++)e.push.apply(e,ke()(this.getRenderList(r[n])))}return e}},{key:"clear",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=0,i=this._gl;t&&(n|=i.COLOR_BUFFER_BIT),e&&(n|=i.DEPTH_BUFFER_BIT),r&&(n|=i.STENCIL_BUFFER_BIT),i.clear(n)}},{key:"destroy",value:function(){this.domElement=null,this._gl=null,this._programManager.destroy(),this._bufferManager.destroy()}}]),t}();r.d(e,"Clock",(function(){return h})),r.d(e,"constants",(function(){return n})),r.d(e,"AnimationClip",(function(){return et})),r.d(e,"AnimationMixer",(function(){return rt})),r.d(e,"KeyFrameTrack",(function(){return dt})),r.d(e,"NumberKeyFrameTrack",(function(){return mt})),r.d(e,"QuaternionKeyFrameTrack",(function(){return pt})),r.d(e,"VectorKeyFrameTrack",(function(){return _t})),r.d(e,"Camera",(function(){return Wt})),r.d(e,"OrthographicCamera",(function(){return Gt})),r.d(e,"PerspectiveCamera",(function(){return jt})),r.d(e,"OrbitController",(function(){return Ht})),r.d(e,"BoxGeometry",(function(){return ee})),r.d(e,"Geometry",(function(){return te})),r.d(e,"PlaneGeometry",(function(){return re})),r.d(e,"WireframeGeometry",(function(){return ie})),r.d(e,"AxesHelper",(function(){return le})),r.d(e,"CameraHelper",(function(){return de})),r.d(e,"GridHelper",(function(){return me})),r.d(e,"LineBasicMaterial",(function(){return he})),r.d(e,"Material",(function(){return ue})),r.d(e,"PointsMaterial",(function(){return ve})),r.d(e,"Box3",(function(){return Zt})),r.d(e,"Color",(function(){return oe})),r.d(e,"Euler",(function(){return Ot})),r.d(e,"Mat3",(function(){return St})),r.d(e,"Mat4",(function(){return Et})),r.d(e,"Quaternion",(function(){return vt})),r.d(e,"Spherical",(function(){return Vt})),r.d(e,"mathUtils",(function(){return i})),r.d(e,"Vec3",(function(){return Mt})),r.d(e,"Vec4",(function(){return ye})),r.d(e,"CubicSplineInterpolant",(function(){return ft})),r.d(e,"Interpolant",(function(){return ht})),r.d(e,"LinearInterpolant",(function(){return lt})),r.d(e,"QuaternionLinearInterpolant",(function(){return yt})),r.d(e,"StepInterpolant",(function(){return ct})),r.d(e,"Bone",(function(){return pe})),r.d(e,"GraphObject",(function(){return Dt})),r.d(e,"Group",(function(){return _e})),r.d(e,"Line",(function(){return ge})),r.d(e,"LineSegments",(function(){return ae})),r.d(e,"Mesh",(function(){return xe})),r.d(e,"Points",(function(){return Me})),r.d(e,"Scene",(function(){return Ee})),r.d(e,"Skeleton",(function(){return we})),r.d(e,"SkinnedMesh",(function(){return Ie})),r.d(e,"BufferAttribute",(function(){return Jt})),r.d(e,"WebGLBufferManager",(function(){return Pe})),r.d(e,"WebGLCapabilities",(function(){return Se})),r.d(e,"WebGLExtensionManager",(function(){return Re})),r.d(e,"WebGLProgram",(function(){return Lr})),r.d(e,"WebGLProgramManager",(function(){return Ur})),r.d(e,"WebGLRenderer",(function(){return Yr})),r.d(e,"WebGLUniforms",(function(){return Pr})),r.d(e,"shaders",(function(){return Be})),r.d(e,"ShaderCode",(function(){return ze})),r.d(e,"BindMatrixUniform",(function(){return wr})),r.d(e,"BoneMatricesUniform",(function(){return kr})),r.d(e,"DiffuseUniform",(function(){return gr})),r.d(e,"uniforms",(function(){return Ir})),r.d(e,"InverseBindMatrixUniform",(function(){return Tr})),r.d(e,"ModelMatrixUniform",(function(){return yr})),r.d(e,"ModelViewMatrixUniform",(function(){return Mr})),r.d(e,"MorphTargetBaseInfluenceUniform",(function(){return Er})),r.d(e,"MorphTargetInfluencesUniform",(function(){return br})),r.d(e,"NormalMatrixUniform",(function(){return xr})),r.d(e,"ProjectionMatrixUniform",(function(){return _r})),r.d(e,"ViewMatrixUniform",(function(){return pr})),r.d(e,"WebGLUniform",(function(){return dr}))}])}));