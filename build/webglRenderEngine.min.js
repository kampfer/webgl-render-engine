!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.webglRenderEngine=e():t.webglRenderEngine=e()}(window,(function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=15)}([function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function i(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}},function(t,e){function i(e){return t.exports=i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},i(e)}t.exports=i},function(t,e,i){var n=i(8),r=i(9);t.exports=function(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?r(t):e}},function(t,e,i){var n=i(10);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}},function(t,e){t.exports=function(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}},function(t,e,i){var n=i(12),r=i(13),s=i(14);t.exports=function(t){return n(t)||r(t)||s()}},function(t,e,i){var n=i(11);function r(e,i,s){return"undefined"!=typeof Reflect&&Reflect.get?t.exports=r=Reflect.get:t.exports=r=function(t,e,i){var r=n(t,e);if(r){var s=Object.getOwnPropertyDescriptor(r,e);return s.get?s.get.call(i):s.value}},r(e,i,s||e)}t.exports=r},function(t,e){function i(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=i=function(t){return typeof t}:t.exports=i=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(e)}t.exports=i},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e){function i(e,n){return t.exports=i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},i(e,n)}t.exports=i},function(t,e,i){var n=i(2);t.exports=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=n(t)););return t}},function(t,e){t.exports=function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}},function(t,e){t.exports=function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(t,e,i){"use strict";i.r(e);var n={};i.r(n),i.d(n,"GL_DRAW_MODE_POINTS",(function(){return l})),i.d(n,"GL_DRAW_MODE_LINES",(function(){return c})),i.d(n,"GL_DRAW_MODE_LINE_STRIP",(function(){return f})),i.d(n,"GL_DRAW_MODE_LINE_LOOP",(function(){return d})),i.d(n,"GL_DRAW_MODE_TRIANGLES",(function(){return v})),i.d(n,"GL_DRAW_MODE_TRIANGLE_STRIP",(function(){return y})),i.d(n,"GL_DRAW_MODE_TRIANGLE_FAN",(function(){return m})),i.d(n,"OBJECT_TYPE_MESH",(function(){return p})),i.d(n,"OBJECT_TYPE_PERSPECTIVE_CAMERA",(function(){return _})),i.d(n,"OBJECT_TYPE_ORTHOGRAPHIC_CAMERA",(function(){return g})),i.d(n,"OBJECT_TYPE_LINE",(function(){return x})),i.d(n,"OBJECT_TYPE_LINE_SEGMENTS",(function(){return M})),i.d(n,"OBJECT_TYPE_LINE_LOOP",(function(){return k})),i.d(n,"OBJECT_TYPE_PLANE",(function(){return w})),i.d(n,"OBJECT_TYPE_POINTS",(function(){return b})),i.d(n,"MATERIAL_TYPE_BASIC",(function(){return E})),i.d(n,"MATERIAL_TYPE_LINE_BASIC",(function(){return A})),i.d(n,"LINEAR_INTERPOLATION",(function(){return z})),i.d(n,"STEP_INTERPOLATION",(function(){return S})),i.d(n,"CUBIC_SPLINE_INTERPOLATION",(function(){return P}));var r={};i.r(r),i.d(r,"clamp",(function(){return ht})),i.d(r,"degToRad",(function(){return lt})),i.d(r,"radToDeg",(function(){return ct}));var s=i(0),a=i.n(s),o=i(1),u=i.n(o),h=function(){function t(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];a()(this,t),this._autoStart=e,this._startTime=0,this._prevTime=0,this._elapsedTime=0}return u()(t,[{key:"now",value:function(){return(performance||Date).now()}},{key:"start",value:function(){this._startTime=this.now(),this._prevTime=this._startTime,this._elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getDeltaTime(),this.running=!1}},{key:"getDeltaTime",value:function(){var t=0;if(!this.running&&this._autoStart)return this.start(),t;if(this.running){var e=this.now();t=(e-this._prevTime)/1e3,this._prevTime=e,this._elapsedTime+=t}return t}},{key:"getElapsedTime",value:function(){return this.getDeltaTime(),this._elapsedTime}}]),t}(),l=0,c=1,f=2,d=3,v=4,y=5,m=6,p=0,_=1,g=2,x=3,M=4,k=5,w=6,b=7,E="BasicMaterial",A="LineBasicMaterial",z=2020,S=2021,P=2022,C=0,I=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2?arguments[2]:void 0;a()(this,t),this.name=e,this.duration=i,this.tracks=n,this.uuid=++C,this.duration<0&&this.setDurationFromTracks()}return u()(t,[{key:"setDurationFromTracks",value:function(){for(var t=this.tracks,e=0,i=0,n=t.length;i<n;i++){var r=t[i];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this}}]),t}(),T=function(){function t(e){a()(this,t),this._time=0,this._clips=e,this.timeScale=1}return u()(t,[{key:"update",value:function(t){t*=this.timeScale,this._time+=t;for(var e=this._time,i=this._clips,n=0,r=i.length;n<r;n++)for(var s=i[n],a=s.tracks,o=0,u=a.length;o<u;o++){var h=a[o],l=h.node,c=h.property,f=h.interpolant;e%=s.duration;var d=f.evaluate(e);l[c].setFromArray(d)}}},{key:"destroy",value:function(){}}]),t}(),F=i(3),L=i.n(F),O=i(2),R=i.n(O),N=i(4),B=i.n(N),U=function(){function t(e,i,n){a()(this,t),this.xArray=e,this.yArray=i,this.ySize=n}return u()(t,[{key:"evaluate",value:function(t){for(var e,i,n,r=this.xArray,s=0,a=r.length;s<a;s++){if(t===r[s]){0===s?(e=s+1,i=r[s],n=r[e]):(e=s,i=r[s-1],n=r[e]);break}if(t>r[s]&&t<r[s+1]){e=s+1,i=r[s],n=r[e];break}}return this._interpolate(e,i,t,n)}}]),t}(),j=function(t){function e(){return a()(this,e),L()(this,R()(e).apply(this,arguments))}return B()(e,t),u()(e,[{key:"_interpolate",value:function(t,e,i,n){for(var r=this.yArray,s=this.ySize,a=new r.constructor(s),o=t*s,u=o-s,h=(i-e)/(n-e),l=1-h,c=0,f=a.length;c<f;c++)a[c]=r[u+c]*l+r[o+c]*h;return a}}]),e}(U),D=function(t){function e(){return a()(this,e),L()(this,R()(e).apply(this,arguments))}return B()(e,t),u()(e,[{key:"_interpolate",value:function(t){for(var e=this.yArray,i=this.ySize,n=new e.constructor(i),r=t-1,s=0,a=n.length;s<a;s++)n[s]=e[r+s];return n}}]),e}(U),G=function(t){function e(){return a()(this,e),L()(this,R()(e).apply(this,arguments))}return B()(e,t),e}(U),V=function(){function t(e,i,n,r){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:z;a()(this,t),this.node=e,this.property=i,this.name=e.name+"."+i,this.times=n,this.values=r,this.setInterpolant(s)}return u()(t,[{key:"getValueSize",value:function(){return this.values.length/this.times.length}},{key:"createLinearInterpolant",value:function(){return new j(this.times,this.values,this.getValueSize())}},{key:"createStepInterpolant",value:function(){return new D(this.times,this.values,this.getValueSize())}},{key:"createCubicSplineInterpolant",value:function(){return new G(this.times,this.values,this.getValueSize())}},{key:"setInterpolant",value:function(t){var e;void 0===this.createInterpolant&&(t===z?e=this.createLinearInterpolant:t===S?e=this.createStepInterpolant:t===P&&(e=this.createCubicSplineInterpolant),this.createInterpolant=e);this.interpolant=this.createInterpolant()}}]),t}(),W=function(t){function e(){return a()(this,e),L()(this,R()(e).apply(this,arguments))}return B()(e,t),e}(V),Y=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;a()(this,t),this._x=e,this._y=i,this._z=n,this._w=r}return u()(t,[{key:"set",value:function(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this}},{key:"copy",value:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this}},{key:"setFromArray",value:function(t){this._x=t[0],this._y=t[1],this._z=t[2],this._w=t[3]}},{key:"setFromEuler",value:function(t){var e=t.x,i=t.y,n=t.z,r=t.order,s=Math.cos(e/2),a=Math.cos(i/2),o=Math.cos(n/2),u=Math.sin(e/2),h=Math.sin(i/2),l=Math.sin(n/2);return"XYZ"===r?(this._x=u*a*o+s*h*l,this._y=s*h*o-u*a*l,this._z=s*a*l+u*h*o,this._w=s*a*o-u*h*l):"YXZ"===r?(this._x=u*a*o+s*h*l,this._y=s*h*o-u*a*l,this._z=s*a*l-u*h*o,this._w=s*a*o+u*h*l):"ZXY"===r?(this._x=u*a*o-s*h*l,this._y=s*h*o+u*a*l,this._z=s*a*l+u*h*o,this._w=s*a*o-u*h*l):"ZYX"===r?(this._x=u*a*o-s*h*l,this._y=s*h*o+u*a*l,this._z=s*a*l-u*h*o,this._w=s*a*o+u*h*l):"YZX"===r?(this._x=u*a*o+s*h*l,this._y=s*h*o+u*a*l,this._z=s*a*l-u*h*o,this._w=s*a*o-u*h*l):"XZY"===r&&(this._x=u*a*o-s*h*l,this._y=s*h*o-u*a*l,this._z=s*a*l+u*h*o,this._w=s*a*o+u*h*l),this}},{key:"setFromAxisAngle",value:function(t,e){var i=e/2,n=Math.sin(i),r=Math.cos(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=r,this}},{key:"setFromRotationMatrix",value:function(t){var e,i=t.elements,n=i[0],r=i[4],s=i[8],a=i[1],o=i[5],u=i[9],h=i[2],l=i[6],c=i[10],f=n+o+c;return f>0?(e=.5/Math.sqrt(f+1),this._w=.25/e,this._x=(l-u)*e,this._y=(s-h)*e,this._z=(a-r)*e):n>o&&n>c?(e=2*Math.sqrt(1+n-o-c),this._w=(l-u)/e,this._x=.25*e,this._y=(r+a)/e,this._z=(s+h)/e):o>c?(e=2*Math.sqrt(1+o-n-c),this._w=(s-h)/e,this._x=(r+a)/e,this._y=.25*e,this._z=(u+l)/e):(e=2*Math.sqrt(1+c-n-o),this._w=(a-r)/e,this._x=(s+h)/e,this._y=(u+l)/e,this._z=.25*e),this}},{key:"setFromQuaternionsProduct",value:function(t,e){var i=t.x,n=t.y,r=t.z,s=t.w,a=e.x,o=e.y,u=e.z,h=e.w;return this._x=i*h+s*a+n*u-r*o,this._y=n*h+s*o+r*a-i*u,this._z=r*h+s*u+i*o-n*a,this._w=s*h-i*a-n*o-r*u,this}},{key:"conjugate",value:function(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this}},{key:"multiply",value:function(t){return this.setFromQuaternionsProduct(this,t)}},{key:"premultiply",value:function(t){return this.setFromQuaternionsProduct(t,this)}},{key:"inverse",value:function(){return this.conjugate()}},{key:"dot",value:function(t){return this._x*t.x+this._y*t.y+this._z*t.z+this._w*t.w}},{key:"lengthSquared",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"normalize",value:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(this._x/=t,this._y/=t,this._z/=t,this._w/=t),this}},{key:"slerp",value:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var i=this._x,n=this._y,r=this._z,s=this._w,a=s*t.w+i*t.x+n*t.y+r*t.z;if(a>=1)return this;a<0?(this._x=-t.x,this._y=-t.y,this._z=-t.z,this._w=-t.w,a=-a):this.copy(t);var o=Math.sqrt(1-a*a);if(o<=Number.EPSILON){var u=1-e;return this._w=u*s+e*this._w,this._x=u*i+e*this._x,this._y=u*n+e*this._y,this._z=u*r+e*this._z,this.normalize()}var h=Math.atan2(o,a),l=Math.sin((1-e)*h)/o,c=Math.sin(e*h)/o;return this._w=l*s+c*this._w,this._x=l*i+c*this._x,this._y=l*n+c*this._y,this._z=l*r+c*this._z,this}},{key:"x",get:function(){return this._x},set:function(t){this._x=t}},{key:"y",get:function(){return this._y},set:function(t){this._y=t}},{key:"z",get:function(){return this._z},set:function(t){this._z=t}},{key:"w",get:function(){return this._w},set:function(t){this._w=t}}],[{key:"slerp",value:function(t,e,i,n){return i.copy(t).slerp(e,n)}},{key:"slerpFlat",value:function(t,e,i,n,r,s,a){var o=i[n+0],u=i[n+1],h=i[n+2],l=i[n+3],c=r[s+0],f=r[s+1],d=r[s+2],v=r[s+3];if(l!==v||o!==c||u!==f||h!==d){var y=1-a,m=o*c+u*f+h*d+l*v,p=m>=0?1:-1,_=1-m*m;if(_>Number.EPSILON){var g=Math.sqrt(_),x=Math.atan2(g,m*p);y=Math.sin(y*x)/g,a=Math.sin(a*x)/g}var M=a*p;if(o=o*y+c*M,u=u*y+f*M,h=h*y+d*M,l=l*y+v*M,y===1-a){var k=1/Math.sqrt(o*o+u*u+h*h+l*l);o*=k,u*=k,h*=k,l*=k}}t[e+0]=o,t[e+1]=u,t[e+2]=h,t[e+3]=l}}]),t}(),q=function(t){function e(){return a()(this,e),L()(this,R()(e).apply(this,arguments))}return B()(e,t),u()(e,[{key:"_interpolate",value:function(t,e,i,n){var r=this.yArray,s=this.ySize,a=t*s,o=(i-e)/(n-e),u=new r.constructor(s);return Y.slerpFlat(u,0,r,a-s,r,a,o),u}}]),e}(U),H=function(t){function e(){var t,i;a()(this,e);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=L()(this,(t=R()(e)).call.apply(t,[this].concat(r)))).createStepInterpolant=null,i.createCubicSplineInterpolant=null,i}return B()(e,t),u()(e,[{key:"createLinearInterpolant",value:function(){return new q(this.times,this.values,this.getValueSize())}}]),e}(V),X=function(t){function e(){return a()(this,e),L()(this,R()(e).apply(this,arguments))}return B()(e,t),e}(V),Z=i(7),K=i.n(Z),Q=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;a()(this,t),this.x=e,this.y=i,this.z=n}return u()(t,[{key:"set",value:function(t,e,i){return this.x=t,this.y=e,this.z=i,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"setFromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}},{key:"setFromVectorsSum",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}},{key:"setFromVectorsDiff",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}},{key:"setFromMatrixPosition",value:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}},{key:"getComponent",value:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("Vec3: 索引".concat(t,"超过边界"))}}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"subScalar",value:function(t){return this.addScalar(-t)}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"applyMatrix4",value:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements,s=1/(r[3]*e+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*n+r[12])*s,this.y=(r[1]*e+r[5]*i+r[9]*n+r[13])*s,this.z=(r[2]*e+r[6]*i+r[10]*n+r[14])*s,this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"cross",value:function(t){return this.setFromVectorsCross(this,t)}},{key:"setFromVectorsCross",value:function(t,e){var i=t.x,n=t.y,r=t.z,s=e.x,a=e.y,o=e.z;return this.x=n*o-r*a,this.y=r*s-i*o,this.z=i*a-n*s,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"setFromSphericalCoords",value:function(t,e,i){var n=Math.sin(e);return this.x=n*Math.sin(i)*t,this.y=Math.cos(e)*t,this.z=n*Math.cos(i)*t,this}},{key:"setFromSpherical",value:function(t){return this.setFromSphericalCoords(t.radius,t.theta,t.phi)}},{key:"setFromBufferAttribute",value:function(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}},{key:"project",value:function(t){return this.applyMatrix4(t.worldMatrixInverse).applyMatrix4(t.projectionMatrix)}},{key:"unproject",value:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.worldMatrix)}}]),t}(),J=function(){function t(e){if(a()(this,t),e){for(var i=[],n=0;n<16;n++)i[n]=e[n];this.elements=i}else this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}return u()(t,[{key:"copy",value:function(t){var e=t.elements,i=this.elements;if(e!==i){for(var n=0;n<16;++n)i[n]=e[n];return this}}},{key:"set",value:function(t,e,i,n,r,s,a,o,u,h,l,c,f,d,v,y){var m=this.elements;return m[0]=t,m[4]=e,m[8]=i,m[12]=n,m[1]=r,m[5]=s,m[9]=a,m[13]=o,m[2]=u,m[6]=h,m[10]=l,m[14]=c,m[3]=f,m[7]=d,m[11]=v,m[15]=y,this}},{key:"setFromArray",value:function(t){for(var e=this.elements,i=0;i<16;++i)e[i]=t[i];return this}},{key:"multiply",value:function(t){return this.multiplyMatrices(this,t)}},{key:"premultiply",value:function(t){return this.multiplyMatrices(t,this)}},{key:"multiplyMatrices",value:function(t,e){var i=t.elements,n=e.elements,r=this.elements,s=i[0],a=i[4],o=i[8],u=i[12],h=i[1],l=i[5],c=i[9],f=i[13],d=i[2],v=i[6],y=i[10],m=i[14],p=i[3],_=i[7],g=i[11],x=i[15],M=n[0],k=n[4],w=n[8],b=n[12],E=n[1],A=n[5],z=n[9],S=n[13],P=n[2],C=n[6],I=n[10],T=n[14],F=n[3],L=n[7],O=n[11],R=n[15];return r[0]=s*M+a*E+o*P+u*F,r[4]=s*k+a*A+o*C+u*L,r[8]=s*w+a*z+o*I+u*O,r[12]=s*b+a*S+o*T+u*R,r[1]=h*M+l*E+c*P+f*F,r[5]=h*k+l*A+c*C+f*L,r[9]=h*w+l*z+c*I+f*O,r[13]=h*b+l*S+c*T+f*R,r[2]=d*M+v*E+y*P+m*F,r[6]=d*k+v*A+y*C+m*L,r[10]=d*w+v*z+y*I+m*O,r[14]=d*b+v*S+y*T+m*R,r[3]=p*M+_*E+g*P+x*F,r[7]=p*k+_*A+g*C+x*L,r[11]=p*w+_*z+g*I+x*O,r[15]=p*b+_*S+g*T+x*R,this}},{key:"determinant",value:function(){var t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],s=t[1],a=t[5],o=t[9],u=t[13],h=t[2],l=t[6],c=t[10],f=t[14],d=t[3],v=t[7],y=t[11],m=t[15];return r*o*l*d-n*u*l*d-r*a*c*d+i*u*c*d+n*a*f*d-i*o*f*d-r*o*h*v+n*u*h*v+r*s*c*v-e*u*c*v-n*s*f*v+e*o*f*v+r*a*h*y-i*u*h*y-r*s*l*y+e*u*l*y+i*s*f*y-e*a*f*y-n*a*h*m+i*o*h*m+n*s*l*m-e*o*l*m-i*s*c*m+e*a*c*m}},{key:"setInverseOf",value:function(t){var e=this.elements,i=t.elements,n=i[0],r=i[4],s=i[8],a=i[12],o=i[1],u=i[5],h=i[9],l=i[13],c=i[2],f=i[6],d=i[10],v=i[14],y=i[3],m=i[7],p=i[11],_=i[15],g=t.determinant();return e[0]=(h*v*m-l*d*m+l*f*p-u*v*p-h*f*_+u*d*_)/g,e[4]=(a*d*m-s*v*m-a*f*p+r*v*p+s*f*_-r*d*_)/g,e[8]=(s*l*m-a*h*m+a*u*p-r*l*p-s*u*_+r*h*_)/g,e[12]=(a*h*f-s*l*f-a*u*d+r*l*d+s*u*v-r*h*v)/g,e[1]=(l*d*y-h*v*y-l*c*p+o*v*p+h*c*_-o*d*_)/g,e[5]=(s*v*y-a*d*y+a*c*p-n*v*p-s*c*_+n*d*_)/g,e[9]=(a*h*y-s*l*y-a*o*p+n*l*p+s*o*_-n*h*_)/g,e[13]=(s*l*c-a*h*c+a*o*d-n*l*d-s*o*v+n*h*v)/g,e[2]=(u*v*y-l*f*y+l*c*m-o*v*m-u*c*_+o*f*_)/g,e[6]=(a*f*y-r*v*y-a*c*m+n*v*m+r*c*_-n*f*_)/g,e[10]=(r*l*y-a*u*y+a*o*m-n*l*m-r*o*_+n*u*_)/g,e[14]=(a*u*c-r*l*c-a*o*f+n*l*f+r*o*v-n*u*v)/g,e[3]=(h*f*y-u*d*y-h*c*m+o*d*m+u*c*p-o*f*p)/g,e[7]=(r*d*y-s*f*y+s*c*m-n*d*m-r*c*p+n*f*p)/g,e[11]=(s*u*y-r*h*y-s*o*m+n*h*m+r*o*p-n*u*p)/g,e[15]=(r*h*c-s*u*c+s*o*f-n*h*f-r*o*d+n*u*d)/g,this}},{key:"transpose",value:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}},{key:"setBasis",value:function(){}},{key:"setRotationFromEuler",value:function(t){var e=this.elements,i=t.x,n=t.y,r=t.z,s=Math.cos(i),a=Math.sin(i),o=Math.cos(n),u=Math.sin(n),h=Math.cos(r),l=Math.sin(r);if("XYZ"===t.order){var c=s*h,f=s*l,d=a*h,v=a*l;e[0]=o*h,e[4]=-o*l,e[8]=u,e[1]=f+d*u,e[5]=c-v*u,e[9]=-a*o,e[2]=v-c*u,e[6]=d+f*u,e[10]=s*o}else if("YXZ"===t.order){var y=o*h,m=o*l,p=u*h,_=u*l;e[0]=y+_*a,e[4]=p*a-m,e[8]=s*u,e[1]=s*l,e[5]=s*h,e[9]=-a,e[2]=m*a-p,e[6]=_+y*a,e[10]=s*o}else if("ZXY"===t.order){var g=o*h,x=o*l,M=u*h,k=u*l;e[0]=g-k*a,e[4]=-s*l,e[8]=M+x*a,e[1]=x+M*a,e[5]=s*h,e[9]=k-g*a,e[2]=-s*u,e[6]=a,e[10]=s*o}else if("ZYX"===t.order){var w=s*h,b=s*l,E=a*h,A=a*l;e[0]=o*h,e[4]=E*u-b,e[8]=w*u+A,e[1]=o*l,e[5]=A*u+w,e[9]=b*u-E,e[2]=-u,e[6]=a*o,e[10]=s*o}else if("YZX"===t.order){var z=s*o,S=s*u,P=a*o,C=a*u;e[0]=o*h,e[4]=C-z*l,e[8]=P*l+S,e[1]=l,e[5]=s*h,e[9]=-a*h,e[2]=-u*h,e[6]=S*l+P,e[10]=z-C*l}else if("XZY"===t.order){var I=s*o,T=s*u,F=a*o,L=a*u;e[0]=o*h,e[4]=-l,e[8]=u*h,e[1]=I*l+L,e[5]=s*h,e[9]=T*l-F,e[2]=F*l-T,e[6]=a*h,e[10]=L*l+I}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}},{key:"setRotationFromQauternion",value:function(t){return this.compose(rt,t,st)}},{key:"setRotationFromAxisAngle",value:function(t,e){}},{key:"setRotationX",value:function(){}},{key:"setRotationY",value:function(){}},{key:"setRotationZ",value:function(){}},{key:"translate",value:function(t,e,i){var n=this.elements;return n[12]+=n[0]*t+n[4]*e+n[8]*i,n[13]+=n[1]*t+n[5]*e+n[9]*i,n[14]+=n[2]*t+n[6]*e+n[10]*i,n[15]+=n[3]*t+n[7]*e+n[11]*i,this}},{key:"setTranslate",value:function(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1)}},{key:"scale",value:function(t,e,i){var n=this.elements;return n[0]*=t,n[4]*=e,n[8]*=i,n[1]*=t,n[5]*=e,n[9]*=i,n[2]*=t,n[6]*=e,n[10]*=i,n[3]*=t,n[7]*=e,n[11]*=i,this}},{key:"setScale",value:function(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1)}},{key:"lookAt",value:function(t,e,i){var n=this.elements;return it.setFromVectorsDiff(t,e),0===it.lengthSquared()&&(it.z=1),it.normalize(),tt.setFromVectorsCross(i,it),0===tt.lengthSquared()&&(1===Math.abs(i.z)?it.x+=1e-4:it.z+=1e-4,it.normalize(),tt.setFromVectorsCross(i,it)),tt.normalize(),et.setFromVectorsCross(it,tt),n[0]=tt.x,n[4]=et.x,n[8]=it.x,n[1]=tt.y,n[5]=et.y,n[9]=it.y,n[2]=tt.z,n[6]=et.z,n[10]=it.z,this}},{key:"setPerspective",value:function(t,e,i,n,r,s){var a=this.elements;return a[0]=2*r/(e-t),a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*r/(i-n),a[6]=0,a[7]=0,a[8]=(e+t)/(e-t),a[9]=(i+n)/(i-n),a[10]=-(s+r)/(s-r),a[11]=-1,a[12]=0,a[13]=0,a[14]=-2*r*s/(s-r),a[15]=0,this}},{key:"setOrthographic",value:function(t,e,i,n,r,s){var a=this.elements;return a[0]=2/(e-t),a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/(i-n),a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=-2/(s-r),a[11]=0,a[12]=-(e+t)/(e-t),a[13]=-(i+n)/(i-n),a[14]=-(s+r)/(s-r),a[15]=1,this}},{key:"compose",value:function(t,e,i){var n=this.elements,r=e.x,s=e.y,a=e.z,o=e.w,u=i.x,h=i.y,l=i.z;return n[0]=(1-2*s*s-2*a*a)*u,n[1]=(2*r*s+2*a*o)*u,n[2]=(2*r*a-2*s*o)*u,n[3]=0,n[4]=(2*r*s-2*a*o)*h,n[5]=(1-2*r*r-2*a*a)*h,n[6]=(2*s*a+2*r*o)*h,n[7]=0,n[8]=(2*r*a+2*s*o)*l,n[9]=(2*s*a-2*r*o)*l,n[10]=(1-2*r*r-2*s*s)*l,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}},{key:"decompose",value:function(t,e,i){var n=this.elements,r=$.set(n[0],n[1],n[2]).length(),s=$.set(n[4],n[5],n[6]).length(),a=$.set(n[8],n[9],n[10]).length();i.set(r,s,a),t.set(n[12],n[13],n[14]),nt.copy(this);var o=nt.elements;return o[0]/=r,o[1]/=r,o[2]/=r,o[4]/=s,o[5]/=s,o[6]/=s,o[8]/=a,o[9]/=a,o[10]/=a,e.setFromRotationMatrix(nt),this}},{key:"extractRotation",value:function(t){var e=this.elements,i=t.elements,n=$.set(i[0],i[1],i[2]).length(),r=$.set(i[4],i[5],i[6]).length(),s=$.set(i[8],i[9],i[10]).length();return e[0]=i[0]/n,e[4]=i[4]/r,e[8]=i[8]/s,e[12]=0,e[1]=i[1]/n,e[5]=i[5]/r,e[9]=i[9]/s,e[13]=0,e[2]=i[2]/n,e[6]=i[6]/r,e[10]=i[10]/s,e[14]=0,e[3]=0,e[7]=0,e[11]=0,e[15]=1,this}}]),t}(),$=new Q,tt=new Q,et=new Q,it=new Q,nt=new J,rt=new Q(0,0,0),st=new Q(1,1,1),at=function(){function t(){a()(this,t),this.elements=[1,0,0,0,1,0,0,0,1]}return u()(t,[{key:"set",value:function(t,e,i,n,r,s,a,o,u){var h=this.elements;return h[0]=t,h[3]=e,h[6]=i,h[1]=n,h[4]=r,h[7]=s,h[2]=a,h[5]=o,h[8]=u,this}},{key:"setFromMatrix4",value:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}},{key:"setInverseOf",value:function(t){var e=t.elements,i=this.elements,n=e[0],r=e[3],s=e[6],a=e[1],o=e[4],u=e[7],h=e[2],l=e[5],c=e[8],f=this.determinant();return i[0]=(o*c-u*l)/f,i[1]=(u*h-a*c)/f,i[2]=(a*l-o*h)/f,i[3]=(s*l-r*c)/f,i[4]=(n*c-s*h)/f,i[5]=(r*h-n*l)/f,i[6]=(r*u-s*o)/f,i[7]=(s*a-n*u)/f,i[8]=(n*o-r*a)/f,this}},{key:"determinant",value:function(){var t=this.elements,e=t[0],i=t[3],n=t[6],r=t[1],s=t[4],a=t[7],o=t[2],u=t[5],h=t[8];return e*s*h-e*a*u-i*r*h+i*a*o+n*r*u-n*s*o}},{key:"transpose",value:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}},{key:"getNormalMatrix",value:function(t){return this.setFromMatrix4(t).setInverseOf(this).transpose()}}]),t}(),ot=Math.PI/180,ut=180/Math.PI;function ht(t,e,i){return Math.min(i,Math.max(e,t))}function lt(t){return t*ot}function ct(t){return t*ut}var ft="XYZ",dt=new J,vt=new Y,yt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ft;a()(this,t),this._x=e,this._y=i,this._z=n,this._order=r}return u()(t,[{key:"set",value:function(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._order=n||this._order,this}},{key:"copy",value:function(t){return this.set(t.x,t.y,t.z,t.order)}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._order)}},{key:"setFromRotationMatrix",value:function(t,e){var i=t.elements,n=i[0],r=i[4],s=i[8],a=i[1],o=i[5],u=i[9],h=i[2],l=i[6],c=i[10];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(ht(s,-1,1)),Math.abs(s)<1-Number.EPSILON?(this._x=Math.atan2(-u,c),this._z=Math.atan2(-r,n)):(this._x=Math.atan2(l,o),this._z=0)):"YXZ"===e?(this._x=Math.asin(-ht(u,-1,1)),Math.abs(u)<1-Number.EPSILON?(this._y=Math.atan2(s,c),this._z=Math.atan2(a,o)):(this._y=Math.atan2(-h,n),this._z=0)):"ZXY"===e?(this._x=Math.asin(ht(l,-1,1)),Math.abs(l)<1-Number.EPSILON?(this._y=Math.atan2(-h,c),this._z=Math.atan2(-r,o)):(this._y=0,this._z=Math.atan2(a,n))):"ZYX"===e?(this._y=Math.asin(-ht(h,-1,1)),Math.abs(h)<1-Number.EPSILON?(this._x=Math.atan2(l,c),this._z=Math.atan2(a,n)):(this._x=0,this._z=Math.atan2(-r,o))):"YZX"===e?(this._z=Math.asin(ht(a,-1,1)),Math.abs(a)<1-Number.EPSILON?(this._x=Math.atan2(-u,o),this._y=Math.atan2(-h,n)):(this._x=0,this._y=Math.atan2(s,c))):"XZY"===e?(this._z=Math.asin(-ht(r,-1,1)),Math.abs(r)<1-Number.EPSILON?(this._x=Math.atan2(l,o),this._y=Math.atan2(s,n)):(this._x=Math.atan2(-u,c),this._y=0)):console.warn("Euler.setFromRotationMatrix：不支持的参数值order=".concat(e,"$")),this._order=e,this}},{key:"setFromQuaternion",value:function(t,e){return dt.setRotationFromQauternion(t),this.setFromRotationMatrix(dt,e)}},{key:"reorder",value:function(t){return vt.setFromEuler(this),this.setFromQuaternion(vt,t)}},{key:"setFromVector3",value:function(t,e){return this.set(t.x,t.y,t.z,e||this.order)}},{key:"x",set:function(t){this._x=t},get:function(){return this._x}},{key:"y",set:function(t){this._y=t},get:function(){return this._y}},{key:"z",set:function(t){this._z=t},get:function(){return this._z}},{key:"order",set:function(t){this._order=t},get:function(){return this._order}}]),t}(),mt=new Q,pt=new Q,_t=new Y,gt=new J,xt=0,Mt=function(){function t(){a()(this,t),this.uid=++xt,this.children=[],this.parent=null,this.matrix=new J,this.worldMatrix=new J,this.modelViewMatrix=new J,this.normalMatrix=new at,this.position=new Q,this.scale=new Q(1,1,1);var e=new yt,i=new Proxy(e,{set:function(t,e,i){return t[e]=i,n.setFromEuler(t),!0}}),n=new Y,r=new Proxy(n,{set:function(t,i,n){return t[i]=n,e.setFromQuaternion(t),!0}});this.rotation=i,this.quaternion=r,this.up=new Q(0,1,0),this.matrixAutoUpdate=!0,this._worldMatrixNeedsUpdate=!1,this.visible=!0}return u()(t,[{key:"add",value:function(t){null!=t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t)}},{key:"remove",value:function(t){var e=this.children.indexOf(t);e>=0&&(t.parent=null,this.children.splice(e,1))}},{key:"traverse",value:function(t){for(var e=this.children,i=0,n=e.length;i<n;i++){var r=e[i],s=t(r);if(!1===s)return s;if(!1===(s=r.traverse(t)))return s}}},{key:"getChildByUid",value:function(t){var e=null;return this.traverse((function(i){if(i.uid===t)return e=i,!1})),e}},{key:"getChildByName",value:function(t){var e=null;return this.traverse((function(i){if(i.name===t)return e=i,!1})),e}},{key:"update",value:function(){}},{key:"updateMatrix",value:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this._worldMatrixNeedsUpdate=!0}},{key:"updateWorldMatrix",value:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this._worldMatrixNeedsUpdate||t)&&(null===this.parent?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiplyMatrices(this.parent.worldMatrix,this.matrix),this._worldMatrixNeedsUpdate=!1,t=!0);for(var e=this.children,i=0,n=e.length;i<n;i++)e[i].updateWorldMatrix(t)}},{key:"updateRelativeWorldMatrix",value:function(t,e){if(!0===t&&null!==this.parent&&this.parent.updateRelativeWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiplyMatrices(this.parent.worldMatrix,this.matrix),!0===e)for(var i=this.children,n=0,r=i.length;n<r;n++)i[n].updateRelativeWorldMatrix(!1,!0)}},{key:"lookAt",value:function(t,e,i){1===arguments.length?mt.copy(t):mt.set(t,e,i),this.updateRelativeWorldMatrix(!0,!1),pt.setFromMatrixPosition(this.worldMatrix),this.isCamera||this.isLight?gt.lookAt(pt,mt,this.up):gt.lookAt(mt,pt,this.up),this.quaternion.setFromRotationMatrix(gt);var n=this.parent;n&&(gt.extractRotation(n.worldMatrix),_t.setFromRotationMatrix(gt),this.quaternion.premultiply(_t.inverse()))}},{key:"applyMatrix",value:function(t){this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}},{key:"rotateOnAxis",value:function(t,e){return _t.setFromAxisAngle(t,e),this.quaternion.multiply(_t),this}},{key:"rotateOnWorldAxis",value:function(t,e){return _t.setFromAxisAngle(t,e),this.quaternion.premultiply(_t),this}},{key:"copy",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.worldMatrix.copy(t.worldMatrix),this._worldMatrixNeedsUpdate=t._worldMatrixNeedsUpdate,!0===e)for(var i=0,n=this.children.length;i<n;i++){var r=this.children[i];this.add(r.clone(e))}return this}},{key:"clone",value:function(t){return(new this.constructor).copy(this,t)}}]),t}(),kt=function(t){function e(){var t;return a()(this,e),(t=L()(this,R()(e).call(this))).isCamera=!0,t.projectionMatrix=new J,t.projectionMatrixInverse=new J,t.inverseWorldMatrix=new J,t}return B()(e,t),u()(e,[{key:"updateWorldMatrix",value:function(){K()(R()(e.prototype),"updateWorldMatrix",this).call(this),this.inverseWorldMatrix.setInverseOf(this.worldMatrix)}}]),e}(Mt),wt=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;return a()(this,e),(t=L()(this,R()(e).call(this))).type=g,t._left=i,t._right=n,t._top=r,t._bottom=s,t._near=o,t._far=u,t.updateProjectionMatrix(),t}return B()(e,t),u()(e,[{key:"updateProjectionMatrix",value:function(){this.projectionMatrix.setOrthographic(this._left,this._right,this._top,this._bottom,this._near,this._far),this.projectionMatrixInverse.setInverseOf(this.projectionMatrix)}}]),e}(kt),bt=function(t){function e(t,i,n,r){var s;return a()(this,e),(s=L()(this,R()(e).call(this))).type=_,s.fovy=void 0===t?45*Math.PI/180:t,s.aspect=void 0===i?1:i,s.near=void 0===n?.1:n,s.far=void 0===r?1e3:r,s.updateProjectionMatrix(),s}return B()(e,t),u()(e,[{key:"updateProjectionMatrix",value:function(){var t=this.near,e=t*Math.tan(.5*this.fovy),i=2*e,n=this.aspect*i,r=-.5*n;this.projectionMatrix.setPerspective(r,r+n,e,e-i,t,this.far),this.projectionMatrixInverse.setInverseOf(this.projectionMatrix)}}]),e}(kt);var Et=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;a()(this,t),this.radius=e,this._theta=i,this._phi=n}return u()(t,[{key:"set",value:function(t,e,i){return this.radius=t,this.theta=e,this.phi=i,this}},{key:"setFromVector3",value:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}},{key:"setFromCartesianCoords",value:function(t,e,i){var n,r,s;return this.radius=Math.sqrt(t*t+e*e+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.acos((n=e/this.radius,r=-1,s=1,Math.min(s,Math.max(r,n)))),this.phi=Math.atan2(t,i)),this}},{key:"theta",get:function(){return this._theta},set:function(t){this._theta=Math.max(1e-6,Math.min(t,Math.PI-1e-6))}},{key:"phi",get:function(){return this._phi},set:function(t){this._phi=t}}]),t}(),At=function(){function t(e,i){a()(this,t),this.camera=e,this.domElement=i,this.spherical=new Et,this.target=new Q(0,0,0),this._deltaTheta=0,this._deltaPhi=0,this._offset=new Q,this.panSpeed=1,this._scale=1,this.domElement.focus(),i.addEventListener("mousedown",this,!1),i.addEventListener("mousemove",this,!1),i.addEventListener("mouseup",this,!1),i.addEventListener("mouseout",this,!1),i.addEventListener("wheel",this,!1),i.addEventListener("keydown",this,!1),i.addEventListener("keyup",this,!1)}return u()(t,[{key:"handleEvent",value:function(t){switch(t.type){case"mousedown":this._handleMouseDown(t);break;case"mousemove":this._handleMouseMove(t);break;case"mouseup":case"mouseout":this._handleMouseUp(t);break;case"wheel":this._handleMouseWheel(t);break;case"keydown":this._handleKeyDown(t);break;case"keyup":this._handleKeyUp(t)}}},{key:"getMousePosition",value:function(t){return[t.clientX,t.clientY]}},{key:"update",value:function(){var t=this.camera.position;this._offset.copy(t).sub(this.target),this.spherical.setFromVector3(this._offset),this.spherical.theta+=this._deltaTheta,this.spherical.phi+=this._deltaPhi,this.spherical.radius*=this._scale,this._offset.setFromSpherical(this.spherical),t.copy(this.target).add(this._offset),this.camera.lookAt(this.target),this.camera.updateWorldMatrix()}},{key:"_handleMouseDown",value:function(t){this._dragging=!0,this._lastMousePosition=this.getMousePosition(t)}},{key:"_handleMouseMove",value:function(t){if(this._dragging){var e=this.getMousePosition(t),i=e[0]-this._lastMousePosition[0],n=e[1]-this._lastMousePosition[1];if(this._shiftKeyDown)this.target.x-=i*this.panSpeed,this.target.y+=n*this.panSpeed;else{var r=2*Math.PI*n/this.domElement.clientHeight,s=2*Math.PI*i/this.domElement.clientWidth;this._deltaTheta-=r,this._deltaPhi-=s}this.update(),this._deltaTheta=0,this._deltaPhi=0,this._lastMousePosition=e}}},{key:"_handleMouseUp",value:function(){this._dragging=!1}},{key:"_handleMouseWheel",value:function(t){var e=this.domElement.clientHeight;this._scale*=1+t.deltaY/e,this.update(),this._scale=1}},{key:"_handleKeyDown",value:function(t){t.shiftKey&&(this._shiftKeyDown=!0)}},{key:"_handleKeyUp",value:function(){this._shiftKeyDown=!1}},{key:"destroy",value:function(){this.domElement.removeEventListener("mousedown",this),this.domElement.removeEventListener("mousemove",this),this.domElement.removeEventListener("mouseup",this),this.domElement.removeEventListener("mouseout",this),this.domElement.removeEventListener("wheel",this),this.domElement.removeEventListener("keydown",this),this.domElement.removeEventListener("keyup",this)}}]),t}(),zt=function(){function t(){a()(this,t),this._max=new Q(-1/0,-1/0,-1/0),this._min=new Q(1/0,1/0,1/0)}return u()(t,[{key:"setEmpty",value:function(){return this._max.set(-1/0,-1/0,-1/0),this._min.set(1/0,1/0,1/0),this}},{key:"copy",value:function(t){return this._max.copy(t.max),this._min.copy(t.min),this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"setFromObject",value:function(t){return this.setEmpty(),this.expandByObject(t),this}},{key:"expandByObject",value:function(t){t.updateRelativeWorldMatrix(!1,!1);var e=t.geometry;if(e){var i=e.getBoundingBox();St.copy(i),St.applyMatrix4(t.worldMatrix),this.expandByPoint(St.max),this.expandByPoint(St.min)}for(var n=t.children,r=0,s=n.length;r<s;r++)this.expandByObject(n[r]);return this}},{key:"setFromPoints",value:function(t){this.setEmpty();for(var e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}},{key:"expandByPoint",value:function(t){return this._max.max(t),this._min.min(t),this}},{key:"setFromBufferAttribute",value:function(t){for(var e=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,a=-1/0,o=0,u=t.count;o<u;o++){var h=t.getX(o),l=t.getY(o),c=t.getZ(o);h<e&&(e=h),l<i&&(i=l),c<n&&(n=c),h>r&&(r=h),l>s&&(s=l),c>a&&(a=c)}return this.min.set(e,i,n),this.max.set(r,s,a),this}},{key:"getSize",value:function(){var t=new Q;return this.isEmpty()?t.set(0,0,0):t.setFromVectorsDiff(this._max,this._min),t}},{key:"getCenter",value:function(){var t=new Q;return this.isEmpty()?t.set(0,0,0):t.setFromVectorsSum(this._min,this._max).multiplyScalar(.5),t}},{key:"applyMatrix4",value:function(t){return this.isEmpty()||(Pt[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Pt[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Pt[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Pt[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Pt[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Pt[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Pt[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Pt[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Pt)),this}},{key:"max",get:function(){return this._max}},{key:"min",get:function(){return this._min}}]),t}(),St=new zt,Pt=[new Q,new Q,new Q,new Q,new Q,new Q,new Q,new Q],Ct=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5?arguments[5]:void 0,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"STATIC_DRAW";a()(this,t),this.name=void 0,this.array=e,this.target=o,this.itemSize=i,this.count=e.length/i,this.normalized=n,this.usage=u,this.glType=this.getGLType(e),this.bytesPerElement=e.BYTES_PER_ELEMENT,this.offset=s,this.stride=r}return u()(t,[{key:"getGLType",value:function(t){var e;return t instanceof Float32Array?e="FLOAT":t instanceof Float64Array?console.warn("Unsupported data buffer format: Float64Array."):t instanceof Uint16Array?e="UNSIGNED_SHORT":t instanceof Int16Array?e="SHORT":t instanceof Uint32Array?e="UNSIGNED_INT":t instanceof Int32Array?e="INT":t instanceof Int8Array?e="BYTE":t instanceof Uint8Array&&(e="UNSIGNED_BYTE"),e}},{key:"getX",value:function(t){return this.array[this.itemSize*t]}},{key:"getY",value:function(t){return this.array[this.itemSize*t+1]}},{key:"getZ",value:function(t){return this.array[this.itemSize*t+2]}},{key:"getW",value:function(t){return this.array[this.itemSize*t+3]}},{key:"setXYZ",value:function(t,e,i,n){var r=this.itemSize*t;return this.array[r+0]=e,this.array[r+1]=i,this.array[r+2]=n,this}}]),t}(),It=function(){function t(){a()(this,t),this.vertices=[],this.normals=[],this.colors=[],this.indices=[],this._attributes={},this.verticesNeedUpdate=!1,this.colorsNeedUpdate=!1,this.indicesNeedUpdate=!1}return u()(t,[{key:"setIndex",value:function(t){this.setAttribute("index",t),t.isIndex=!0}},{key:"setAttribute",value:function(t,e){this._attributes[t]=e,e.name=t}},{key:"removeAttribue",value:function(t){delete this._attributes[t]}},{key:"getAttribute",value:function(t){return this._attributes[t]}},{key:"getAttributes",value:function(){return this._attributes}},{key:"update",value:function(){!0===this.verticesNeedUpdate&&(this.setAttribute("position",new Ct(new Float32Array(this.vertices),3)),this.verticesNeedUpdate=!1),!0===this.colorsNeedUpdate&&(this.setAttribute("color",new Ct(new Float32Array(this.colors),3)),this.colorsNeedUpdate=!1),!0===this.indicesNeedUpdate&&this.indices.length>0&&(this.setIndex(new Ct(new Int8Array(this.indices),1)),this.indicesNeedUpdate=!1)}},{key:"getBoundingBox",value:function(){return this._boundingBox||(this._boundingBox=this.computeBoundingBox()),this._boundingBox}},{key:"computeBoundingBox",value:function(){var t=new zt,e=this.getAttribute("position");return e?t.setFromBufferAttribute(e):t.setEmpty(),t}}]),t}(),Tt=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;return a()(this,e),(t=L()(this,R()(e).call(this,i,n,r,s,o,u))).numberOfVertices=0,t._buildPlane("x","y","z",1,1,i,n,r,s,o),t._buildPlane("x","y","z",1,1,i,n,-r,s,o),t._buildPlane("x","z","y",1,-1,i,r,n,s,o),t._buildPlane("x","z","y",1,-1,i,r,-n,s,o),t._buildPlane("z","y","x",1,1,r,n,i,s,o),t._buildPlane("z","y","x",1,1,r,n,-i,s,o),t.setIndex(new Ct(new Uint8Array(t.indices),1)),t.setAttribute("position",new Ct(new Float32Array(t.vertices),3)),t.setAttribute("normal",new Ct(new Float32Array(t.normals),3)),t}return B()(e,t),u()(e,[{key:"_buildPlane",value:function(t,e,i,n,r,s,a,o,u,h){for(var l=s/2,c=a/2,f=o/2,d=s/u,v=a/h,y=u+1,m=h+1,p=0,_=new Q,g=0;g<m;g++)for(var x=g*v-c,M=0;M<y;M++){var k=M*d-l;_[t]=k*n,_[e]=x*r,_[i]=f,this.vertices.push(_.x,_.y,_.z),_[t]=0,_[e]=0,_[i]=o>0?1:-1,this.normals.push(_.x,_.y,_.z),p++}for(var w=0;w<h;w++)for(var b=0;b<u;b++){var E=this.numberOfVertices,A=E+b+y*w,z=E+b+y*(w+1),S=E+(b+1)+y*(w+1),P=E+(b+1)+y*w;this.indices.push(A,P,S),this.indices.push(A,S,z)}this.numberOfVertices+=p}}]),e}(It),Ft=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3];a()(this,e);var r=i/2,s=n/2;return(t=L()(this,R()(e).call(this))).vertices.push(r,s,0,-r,s,0,-r,-s,0,r,-s,0),t.indices.push(0,1,3,1,2,3),t.setIndex(new Ct(new Uint8Array(t.indices),1)),t.setAttribute("position",new Ct(new Float32Array(t.vertices),3)),t}return B()(e,t),e}(It),Lt=new Q,Ot=function(t){function e(t){var i;a()(this,e),i=L()(this,R()(e).call(this,t));for(var n=t.getAttribute("index"),r=t.getAttribute("position"),s=0,o=n?n.count:r.count;s<o;s+=3)for(var u=0;u<3;u++){var h=void 0,l=void 0;n?(h=n.getX(s+u),l=n.getX(s+(u+1)%3)):(h=s+u,l=s+(u+1)%3),Lt.setFromBufferAttribute(r,h),i.vertices.push(Lt.x,Lt.y,Lt.z),Lt.setFromBufferAttribute(r,l),i.vertices.push(Lt.x,Lt.y,Lt.z)}return i.setAttribute("position",new Ct(new Float32Array(i.vertices),3)),i}return B()(e,t),e}(It),Rt=function(t){function e(t,i){var n;return a()(this,e),(n=L()(this,R()(e).call(this))).geometry=t,n.material=i,n.type=M,n.drawMode=c,n}return B()(e,t),e}(Mt),Nt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Bt=function(){function t(e,i,n){a()(this,t),1===arguments.length?this.set(e):this.setRGB(e,i,n)}return u()(t,[{key:"set",value:function(e){return e instanceof t?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e?this.setStyle(e):Array.isArray(e)?this.setFromArray(e):console.warn("Color: 错误的参数(".concat(e,")")),this}},{key:"setRGB",value:function(t,e,i){return this.r=t,this.g=e,this.b=i,this}},{key:"setHex",value:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}},{key:"setStyle",value:function(t){var e;if(e=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(t)){var i,n=e[1],r=e[2];"rgb"!==n&&"rgba"!==n||((i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))?(this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,parseFloat(i[5])<1&&console.warn("Alpha component of "+t+" will be ignored.")):(i=/^(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))&&(this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,parseFloat(i[5])<1&&console.warn("Alpha component of "+t+" will be ignored.")))}else if(e=/^#([A-Fa-f0-9]+)$/.exec(t)){var s=e[1],a=s.length;3===a?(this.r=parseInt(s.charAt(0)+s.charAt(0),16)/255,this.g=parseInt(s.charAt(1)+s.charAt(1),16)/255,this.b=parseInt(s.charAt(2)+s.charAt(2),16)/255):6===a&&(this.r=parseInt(s.charAt(0)+s.charAt(1),16)/255,this.g=parseInt(s.charAt(2)+s.charAt(3),16)/255,this.b=parseInt(s.charAt(4)+s.charAt(5),16)/255)}else t&&t.length>0&&this.setColorName(t);return this}},{key:"setColorName",value:function(t){var e=Nt[t];return void 0!==e?this.setHex(e):console.warn("Unknown color "+t),this}},{key:"setFromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}},{key:"copy",value:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}},{key:"clone",value:function(){return new this.constructor(this.r,this.g,this.b)}}]),t}(),Ut=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a()(this,t),this.type=E,e.color&&(this.color=new Bt(e.color)),this.vertexColors=!0===e.vertexColors,this.precision=null},jt=function(t){function e(t){var i;return a()(this,e),(i=L()(this,R()(e).call(this,t))).type=A,i}return B()(e,t),e}(Ut),Dt=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;a()(this,e);var i=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=new It;n.setAttribute("position",new Ct(new Float32Array(i),3)),n.setAttribute("color",new Ct(new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]),3));var r=new jt({vertexColors:!0});return L()(this,R()(e).call(this,n,r))}return B()(e,t),e}(Rt),Gt=new kt,Vt=new Q,Wt=function(t){function e(t){var i;a()(this,e);var n=[],r=[],s={},o=new Bt(16755200),u=new Bt(16711680),h=new Bt(43775),l=new Bt(16777215),c=new Bt(3355443);function f(t,e,i){d(t,i),d(e,i)}function d(t,e){n.push(0,0,0),r.push(e.r,e.g,e.b),void 0===s[t]&&(s[t]=[]),s[t].push(n.length/3-1)}f("p","n1",u),f("p","n2",u),f("p","n3",u),f("p","n4",u),f("n1","n2",o),f("n2","n3",o),f("n3","n4",o),f("n4","n1",o),f("f1","f2",o),f("f2","f3",o),f("f3","f4",o),f("f4","f1",o),f("n1","f1",o),f("n2","f2",o),f("n3","f3",o),f("n4","f4",o),f("u1","u2",h),f("u2","u3",h),f("u3","u1",h),f("p","c",l),f("c","t",l),f("cn1","cn3",c),f("cn2","cn4",c),f("cf1","cf3",c),f("cf2","cf4",c);var v=new It;v.setAttribute("position",new Ct(new Float32Array(n),3)),v.setAttribute("color",new Ct(new Float32Array(r),3));var y=new jt({vertexColors:!0});return(i=L()(this,R()(e).call(this,v,y)))._pointMap=s,i._camera=t,i.matrix=t.worldMatrix,i.matrixAutoUpdate=!1,i.update(),i}return B()(e,t),u()(e,[{key:"update",value:function(){var t=this.geometry.getAttribute("position"),e=this._pointMap;function i(i,n,r,s){Vt.set(n,r,s).unproject(Gt);var a=e[i];if(a&&t)for(var o=0,u=a.length;o<u;o++)t.setXYZ(a[o],Vt.x,Vt.y,Vt.z)}this._camera.updateProjectionMatrix(),Gt.projectionMatrixInverse.copy(this._camera.projectionMatrixInverse),i("c",0,0,-1),i("t",0,0,1),i("n1",1,1,-1),i("n2",-1,1,-1),i("n3",-1,-1,-1),i("n4",1,-1,-1),i("f1",1,1,1),i("f2",-1,1,1),i("f3",-1,-1,1),i("f4",1,-1,1),i("u1",.7,1.1,-1),i("u2",0,2,-1),i("u3",-.7,1.1,-1),i("cn1",0,1,-1),i("cn2",-1,0,-1),i("cn3",0,-1,-1),i("cn4",1,0,-1),i("cf1",0,1,1),i("cf2",-1,0,1),i("cf3",0,-1,1),i("cf4",1,0,1),t.needsUpdate=!0}}]),e}(Rt),Yt=function(t){function e(t,i,n){a()(this,e);for(var r=t/2,s=t/i,o=[],u=0,h=-r;u<=i;u++,h+=s)o.push(-r,0,h,r,0,h),o.push(h,0,-r,h,0,r);var l=new It;l.setAttribute("position",new Ct(new Float32Array(o),3));var c=new jt({color:n});return L()(this,R()(e).call(this,l,c))}return B()(e,t),e}(Rt),qt=function(t){function e(t){var i;return a()(this,e),(i=L()(this,R()(e).call(this,t))).pointSize=t.pointSize,i}return B()(e,t),e}(Ut),Ht=function(t){function e(t,i){var n;return a()(this,e),(n=L()(this,R()(e).call(this))).geometry=t,n.material=i,n.type=x,n}return B()(e,t),u()(e,[{key:"update",value:function(){this.geometry.update(),this.material.update()}}]),e}(Mt),Xt=function(t){function e(t,i){var n;return a()(this,e),(n=L()(this,R()(e).call(this))).geometry=t,n.material=i,n.type=p,n}return B()(e,t),u()(e,[{key:"clone",value:function(t){return new this.constructor(this.geometry,this.material).copy(this,t)}}]),e}(Mt),Zt=function(t){function e(t,i){var n;return a()(this,e),(n=L()(this,R()(e).call(this))).geometry=t,n.material=i,n.type=w,n}return B()(e,t),e}(Mt),Kt=function(t){function e(t,i){var n;return a()(this,e),(n=L()(this,R()(e).call(this))).geometry=t,n.material=i,n.type=b,n}return B()(e,t),e}(Mt),Qt=function(t){function e(){return a()(this,e),L()(this,R()(e).apply(this,arguments))}return B()(e,t),e}(Mt),Jt=function(){function t(e){a()(this,t),this._gl=e,this._buffers=new WeakMap}return u()(t,[{key:"createBuffer",value:function(t){var e=this._gl,i=t.array,n=t.usage,r=t.target,s=e.createBuffer();return"string"==typeof n&&(t.usage=n=e[n]),"string"==typeof t.glType&&(t.glType=e[t.glType]),void 0===r&&(r=!0===t.isIndex?e.ELEMENT_ARRAY_BUFFER:e.ARRAY_BUFFER,t.target=r),e.bindBuffer(r,s),e.bufferData(r,i,n),s}},{key:"get",value:function(t){var e=this._buffers.get(t);return e||(e=this.createBuffer(t),this._buffers.set(t,e)),e}},{key:"remove",value:function(t){var e=this.get(t);e&&(this._gl.deleteBuffer(e),this._buffers.delete(t))}},{key:"update",value:function(){}},{key:"destroy",value:function(){this._gl=null,this._buffers=null}}]),t}(),$t=function(){function t(e,i){var n=i.precision,r=void 0===n?"highp":n;a()(this,t),this._gl=e;var s="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;this.isWebGL2=s;var o=this.getMaxPrecision(r);o!==r&&(r=o),this.precision=r}return u()(t,[{key:"getMaxPrecision",value:function(t){var e=this._gl;if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}}]),t}(),te=function(){function t(e,i,n){a()(this,t),this._path=e,this._source=i,this._dependencies=n,this._compiled=!1}return u()(t,[{key:"getDependency",value:function(t){for(var e=0,i=this._dependencies,n=i.length;e<n;e++){var r=i[e];if(r._path===t)return r}}},{key:"compile",value:function(){if(!this._compiled){for(var t,e=/#include\s+['"]([^'"]*)['"]/g,i=this._source,n=[],r=this._source;null!==(t=e.exec(i));){var s=t[1],a=this.getDependency(s);a&&n.push([t[0],a.compile()])}for(var o=0,u=n.length;o<u;o++){var h=n[o];r=r.replace(h[0],h[1])}this._source=r,this._compiled=!0}return this._source}}]),t}(),ee=new te("./base.vert","attribute vec4 position;\r\nattribute vec3 normal;\r\nuniform mat4 modelMatrix;\r\nuniform mat4 viewMatrix;\r\nuniform mat4 projectionMatrix;\r\nuniform mat3 normalMatrix;\r\nvarying vec3 vNormal;\r\nvoid main() {\r\n    gl_Position = projectionMatrix * viewMatrix * modelMatrix * position;\r\n    vNormal = normalMatrix * normal;\r\n}",[]),ie=new te("./base.frag","uniform vec3 diffuse;\r\nvarying vec3 vNormal;\r\n\r\nvoid main() {\r\n    vec4 diffuseColor = vec4(diffuse, 1);\r\n    vec4 lightColor = vec4(1, 1, 1, 1);\r\n    vec3 lightDirection = normalize(vec3(0.5, 3, 4));\r\n    vec4 ambientColor = vec4(0.2, 0.2, 0.2, 1);\r\n    vec3 normal = normalize(vNormal);\r\n    float fDot = max(dot(lightDirection, normal), 0.0);\r\n    vec4 ambient = ambientColor * diffuseColor;\r\n    gl_FragColor = vec4((lightColor * diffuseColor * fDot).xyz + ambient.xyz, diffuseColor.a);\r\n}",[]),ne="\nattribute vec4 a_Position;\nattribute vec4 a_Color;\nattribute float a_PointSize;\nvarying vec4 v_Color;\nuniform mat4 u_MVPMatrix;\nvoid main() {\n    gl_Position = u_MVPMatrix * a_Position;\n    gl_PointSize = a_PointSize;\n    v_Color = a_Color;\n}\n",re="\n#ifdef GL_ES\nprecision mediump float;\n#endif\nvarying vec4 v_Color;\nvoid main() {\n    float dist = distance(gl_PointCoord, vec2(0.5, 0.5));\n    if (dist < 0.5) {\n        gl_FragColor = v_Color;\n    } else {\n        discard;\n    }\n}\n",se=new te("./chunks/colorHead.vert","#ifdef USE_COLOR\r\n    varying vec3 vColor;\r\n    attribute vec3 color;\r\n#endif",[]),ae=new te("./chunks/colorMain.vert","#ifdef USE_COLOR\r\n    vColor = color;\r\n#endif",[]),oe=new te("./line.vert","#include './chunks/colorHead.vert'\r\n\r\nattribute vec4 position;\r\nuniform mat4 modelMatrix;\r\nuniform mat4 viewMatrix;\r\nuniform mat4 projectionMatrix;\r\n\r\nvoid main() {\r\n\r\n    #include './chunks/colorMain.vert'\r\n\r\n    gl_Position = projectionMatrix * viewMatrix * modelMatrix * position;\r\n\r\n}",[se,ae]),ue=new te("./chunks/colorHead.frag","#ifdef USE_COLOR\r\n    varying vec3 vColor;\r\n#endif",[]),he=new te("./chunks/colorMain.frag","#ifdef USE_COLOR\r\n    diffuseColor.rgb *= vColor;\r\n#endif",[]),le=new te("./line.frag",'#include "./chunks/colorHead.frag"\r\n\r\nuniform vec3 diffuse;\r\n\r\nvoid main() {\r\n\r\n    vec4 diffuseColor = vec4(diffuse, 1);\r\n\r\n    #include "./chunks/colorMain.frag"\r\n\r\n    gl_FragColor = diffuseColor;\r\n\r\n}',[ue,he]),ce={base:{vertex:ee,fragment:ie},points:{vertex:ne,fragment:re},line:{vertex:oe,fragment:le}};function fe(t,e,i){t.uniform1fv(e,i)}function de(t,e,i){t.uniform2fv(e,i)}function ve(t,e,i){t.uniform3fv(e,i)}function ye(t,e,i){t.uniform4fv(e,i)}function me(t,e,i){t.uniformMatrix2fv(e,!1,i)}function pe(t,e,i){t.uniformMatrix3fv(e,!1,i)}function _e(t,e,i){t.uniformMatrix4fv(e,!1,i)}function ge(t,e,i){t.uniform1iv(e,i)}function xe(t,e,i){t.uniform2iv(e,i)}function Me(t,e,i){t.uniform3iv(e,i)}function ke(t,e,i){t.uniform4iv(e,i)}var we=function(){function t(e,i){a()(this,t),this._info=e,this._addr=i}return u()(t,[{key:"setValue",value:function(t,e){var i=this._addr;(function(t){switch(t){case 5126:return fe;case 35664:return de;case 35665:return ve;case 35666:return ye;case 35674:return me;case 35675:return pe;case 35676:return _e;case 5124:case 35670:return ge;case 35667:case 35671:return xe;case 35668:case 35672:return Me;case 35669:case 35673:return ke}})(this._info.type).call(this,t,i,e)}},{key:"calculateValue",value:function(){throw"子类没有实现方法: WebGLUnifrom.calculateValue(object, camera)"}}]),t}(),be=function(t){function e(){return a()(this,e),L()(this,R()(e).apply(this,arguments))}return B()(e,t),u()(e,[{key:"calculateValue",value:function(t){return t.worldMatrix.elements}}]),e}(we),Ee=function(t){function e(){return a()(this,e),L()(this,R()(e).apply(this,arguments))}return B()(e,t),u()(e,[{key:"calculateValue",value:function(t,e){return e.inverseWorldMatrix.elements}}]),e}(we),Ae=function(t){function e(){return a()(this,e),L()(this,R()(e).apply(this,arguments))}return B()(e,t),u()(e,[{key:"calculateValue",value:function(t,e){return e.projectionMatrix.elements}}]),e}(we),ze=function(t){function e(){return a()(this,e),L()(this,R()(e).apply(this,arguments))}return B()(e,t),u()(e,[{key:"calculateValue",value:function(t){var e=t.material.color;return e?[e.r,e.g,e.b]:[1,1,1]}}]),e}(we),Se=function(t){function e(){return a()(this,e),L()(this,R()(e).apply(this,arguments))}return B()(e,t),u()(e,[{key:"calculateValue",value:function(t){return t.normalMatrix.elements}}]),e}(we),Pe={modelMatrix:be,viewMatrix:Ee,projectionMatrix:Ae,diffuse:ze,normalMatrix:Se},Ce=function(){function t(e,i){a()(this,t),this._uniformMap={};for(var n=e.getProgramParameter(i,e.ACTIVE_UNIFORMS),r=0;r<n;r++){var s=e.getActiveUniform(i,r),o=s.name,u=e.getUniformLocation(i,o),h=Pe[o];this._uniformMap[o]=new h(s,u)}}return u()(t,[{key:"getUniform",value:function(t){return this._uniformMap[t]}},{key:"eachUniform",value:function(t){var e=this._uniformMap;for(var i in e){t(e[i])}}}]),t}();function Ie(t){var e,i=t.precision;return"highp"===i?e="#define HIGH_PRECISION":"mediump"===i?e="#define MEDIUM_PRECISION":"lowp"===i&&(e="#define LOW_PRECISION"),"\n        precision ".concat(i," float;\n        precision ").concat(i," int;\n        ").concat(e,"\n    ")}function Te(t){return""!==t}var Fe,Le=function(){function t(e,i){var n,r;a()(this,t),this._gl=e,this._attributes=null,this._uniforms=null,this.debug=!0,i.isRawShaderMaterial||(n=[Ie(i),i.vertexColors?"#define USE_COLOR":"","\n"].filter(Te).join("\n"),r=[Ie(i),i.vertexColors?"#define USE_COLOR":"","\n"].filter(Te).join("\n"));var s=ce[i.shaderType],o=n+s.vertex.compile(),u=r+s.fragment.compile(),h=this.createShader(e.VERTEX_SHADER,o),l=this.createShader(e.FRAGMENT_SHADER,u),c=this.createProgram(h,l);this._program=c,this._vertexShader=h,this._fragmentShader=l,this.usedTimes=0,e.deleteShader(h),e.deleteShader(l)}return u()(t,[{key:"createShader",value:function(t,e){var i=this._gl,n=i.createShader(t);if((i.shaderSource(n,e),i.compileShader(n),!0===this.debug)&&!i.getShaderParameter(n,i.COMPILE_STATUS)){var r=i.getShaderInfoLog(n),s=i.getShaderSource(n);console.error("创建Shader失败！错误信息：".concat(r,"\n").concat(function(t){for(var e=t.split("\n"),i=0,n=e.length;i<n;i++)e[i]=i+1+": "+e[i];return e.join("\n")}(s)))}return n}},{key:"createProgram",value:function(t,e){var i=this._gl,n=i.createProgram();if((i.attachShader(n,t),i.attachShader(n,e),i.linkProgram(n),!0===this.debug)&&!i.getProgramParameter(n,i.LINK_STATUS)){var r=i.getProgramInfoLog(n);console.error("创建program失败！错误信息：".concat(r))}return n}},{key:"getProgram",value:function(){return this._program}},{key:"getAttributes",value:function(){if(this._attributes)return this._attributes;for(var t=this._attributes={},e=this._gl,i=this._program,n=e.getProgramParameter(i,e.ACTIVE_ATTRIBUTES),r=0;r<n;r++){var s=e.getActiveAttrib(i,r).name,a=e.getAttribLocation(i,s);t[s]=a}return t}},{key:"getUniforms",value:function(){if(this._uniforms)return this._uniforms;var t=new Ce(this._gl,this._program);return this._uniforms=t,this._uniforms}},{key:"destroy",value:function(){this._gl.deleteProgram(this._program),this._program=null,this._gl=null}}]),t}(),Oe=i(5),Re=i.n(Oe),Ne=(Fe={},Re()(Fe,E,"base"),Re()(Fe,A,"line"),Fe),Be=function(){function t(e,i){a()(this,t),this._gl=e,this._capabilities=i,this._programs={}}return u()(t,[{key:"getParameters",value:function(t){var e=this._capabilities,i=t.material,n=i.type,r=Ne[n],s=e.precision,a=e.isWebGL2;if(null!==i.precision){var o=e.getMaxPrecision(i.precision);o!==i.precision&&console.warn("不支持material.precision = ".concat(i.precision,"，将使用").concat(o))}return{isWebGL2:a,materialType:n,shaderType:r,vertexColors:i.vertexColors,precision:s}}},{key:"getProgramKey",value:function(t){var e=[];return t.shaderType&&e.push(t.shaderType),e.join()}},{key:"getProgram",value:function(t,e){var i=this._gl,n=this._programs[t];return n||(this._programs[t]=n=new Le(i,e)),n}},{key:"releaseProgram",value:function(t){var e=this._programs[t];e&&(e.destroy(),this._programs.delete(t))}},{key:"destroy",value:function(){for(var t in this._gl=null,this._programs)this.releaseProgram(t);this._programs=null}}]),t}(),Ue=i(6),je=i.n(Ue),De=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.canvas,n=void 0===i?document.createElement("canvas"):i,r=e.autoClear,s=void 0===r||r,o=e.autoClearColor,u=void 0===o||o,h=e.autoClearDepth,l=void 0===h||h,c=e.autoClearStencil,f=void 0===c||c,d=e.precision;a()(this,t),this.domElement=n,this.autoClear=s,this.autoClearColor=u,this.autoClearDepth=l,this.autoClearStencil=f,this._pixelRatio=window.devicePixelRatio,this._clearColor=[0,0,0,1];var v=this.getContext(this.domElement),y=new $t(v,{precision:d});this._capabilities=y,this._programManager=new Be(v,y),this._bufferManager=new Jt(v)}return u()(t,[{key:"getContext",value:function(){if(void 0===this._gl){for(var t=["webgl","experimental-webgl","webkit-3d","moz-webgl"],e=this.domElement,i=null,n=0;n<t.length;n++){try{i=e.getContext(t[n])}catch(t){}if(i)break}i||console.error("WebGLRenderer：读取context失败！"),this._gl=i}return this._gl}},{key:"setSize",value:function(t,e,i){this._width=t,this._height=e,this.domElement.width=Math.floor(t*this._pixelRatio),this.domElement.height=Math.floor(e*this._pixelRatio),!1!==i&&(this.domElement.style.width=t+"px",this.domElement.style.height=e+"px"),this.setViewport(0,0,t,e)}},{key:"setViewport",value:function(t,e,i,n){this._gl.viewport(t,e,i,n)}},{key:"setAttributes",value:function(t,e){var i=this._gl,n=t.getAttributes(),r=e.geometry.getAttributes();for(var s in n){var a=n[s];if(a>=0){var o=r[s];if(o){var u=this._bufferManager.get(o),h=o.itemSize,l=o.glType,c=o.target,f=o.normalized,d=o.stride,v=o.offset;i.enableVertexAttribArray(a),i.bindBuffer(c,u),i.vertexAttribPointer(a,h,l,f,d,v)}}}}},{key:"setUniforms",value:function(t,e,i){var n=this._gl;t.getUniforms().eachUniform((function(t){var r=t.calculateValue(e,i);t.setValue(n,r)}))}},{key:"render",value:function(t,e){var i=this._gl,n=this._programManager;t.updateWorldMatrix(),i.enable(i.DEPTH_TEST),i.clearColor.apply(i,je()(this._clearColor)),this.autoClear&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);for(var r=this.getRenderList(t),s=0;s<r.length;s++){var a=r[s],o=n.getParameters(a),u=n.getProgramKey(o),h=n.getProgram(u,o),l=h.getProgram();this._currentProgram!==l&&(this._currentProgram=l,i.useProgram(l)),a.modelViewMatrix.multiplyMatrices(e.inverseWorldMatrix,a.worldMatrix),a.normalMatrix.getNormalMatrix(a.modelViewMatrix),this.setUniforms(h,a,e),this.setAttributes(h,a);var c=a.geometry.getAttribute("index");if(c){var f=this._bufferManager.get(c);i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,f)}var d=a.drawMode||this.getDrawModeByObjectType(a.type);if(c)i.drawElements(d,c.count,c.glType,0);else{var v=a.geometry.getAttribute("position").count;i.drawArrays(d,0,v)}}}},{key:"getDrawModeByObjectType",value:function(t){var e,i=this._gl;return t===p?e=i.TRIANGLES:t===x?e=i.LINE_STRIP:t===M?e=i.LINES:t===k?e=i.LINE_LOOP:t===b&&(e=i.POINTS),e}},{key:"setClearColor",value:function(t){this._clearColor=t}},{key:"getRenderList",value:function(t){var e=[];!0!==t.visible||t.type!==p&&t.type!==M||e.push(t);for(var i=t.children,n=0,r=i.length;n<r;n++)e.push.apply(e,je()(this.getRenderList(i[n])));return e}},{key:"clear",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=0,r=this._gl;t&&(n|=r.COLOR_BUFFER_BIT),e&&(n|=r.DEPTH_BUFFER_BIT),i&&(n|=r.STENCIL_BUFFER_BIT),r.clear(n)}},{key:"destroy",value:function(){this.domElement=null,this._gl=null,this._programManager.destroy(),this._bufferManager.destroy()}}]),t}();i.d(e,"Clock",(function(){return h})),i.d(e,"constants",(function(){return n})),i.d(e,"AnimationClip",(function(){return I})),i.d(e,"AnimationMixer",(function(){return T})),i.d(e,"KeyFrameTrack",(function(){return V})),i.d(e,"NumberKeyFrameTrack",(function(){return W})),i.d(e,"QuaternionKeyFrameTrack",(function(){return H})),i.d(e,"VectorKeyFrameTrack",(function(){return X})),i.d(e,"Camera",(function(){return kt})),i.d(e,"OrthographicCamera",(function(){return wt})),i.d(e,"PerspectiveCamera",(function(){return bt})),i.d(e,"OrbitController",(function(){return At})),i.d(e,"BoxGeometry",(function(){return Tt})),i.d(e,"Geometry",(function(){return It})),i.d(e,"PlaneGeometry",(function(){return Ft})),i.d(e,"WireframeGeometry",(function(){return Ot})),i.d(e,"AxesHelper",(function(){return Dt})),i.d(e,"CameraHelper",(function(){return Wt})),i.d(e,"GridHelper",(function(){return Yt})),i.d(e,"LineBasicMaterial",(function(){return jt})),i.d(e,"Material",(function(){return Ut})),i.d(e,"PointsMaterial",(function(){return qt})),i.d(e,"Box3",(function(){return zt})),i.d(e,"Color",(function(){return Bt})),i.d(e,"Euler",(function(){return yt})),i.d(e,"Mat3",(function(){return at})),i.d(e,"Mat4",(function(){return J})),i.d(e,"Quaternion",(function(){return Y})),i.d(e,"Spherical",(function(){return Et})),i.d(e,"mathUtils",(function(){return r})),i.d(e,"Vec3",(function(){return Q})),i.d(e,"CubicSplineInterpolant",(function(){return G})),i.d(e,"Interpolant",(function(){return U})),i.d(e,"LinearInterpolant",(function(){return j})),i.d(e,"QuaternionLinearInterpolant",(function(){return q})),i.d(e,"StepInterpolant",(function(){return D})),i.d(e,"GraphObject",(function(){return Mt})),i.d(e,"Line",(function(){return Ht})),i.d(e,"LineSegments",(function(){return Rt})),i.d(e,"Mesh",(function(){return Xt})),i.d(e,"Plane",(function(){return Zt})),i.d(e,"Points",(function(){return Kt})),i.d(e,"Scene",(function(){return Qt})),i.d(e,"BufferAttribute",(function(){return Ct})),i.d(e,"WebGLBufferManager",(function(){return Jt})),i.d(e,"WebGLCapabilities",(function(){return $t})),i.d(e,"WebGLProgram",(function(){return Le})),i.d(e,"WebGLProgramManager",(function(){return Be})),i.d(e,"WebGLRenderer",(function(){return De})),i.d(e,"WebGLUniforms",(function(){return Ce})),i.d(e,"shaders",(function(){return ce})),i.d(e,"pointsFragGLSL",(function(){return re})),i.d(e,"pointsVertGLSL",(function(){return ne})),i.d(e,"ShaderCode",(function(){return te})),i.d(e,"wireframeFragGLSL",(function(){return"\nattribute a_Position;\nattribute a_Barycentric;\nattribute vec3 a_Color;\nuniform mat4 u_MVPMatrix;\nvarying vec3 v_Color;\nvarying vec3 v_Barycentric;\n\nvoid main () {\n    gl_Position = u_MVPMatrix * a_Position;\n    v_Color = a_Color;\n    v_Barycentric = a_Barycentric;\n}\n"})),i.d(e,"wireframeVertGLSL",(function(){return"\nvarying vec3 v_Color;\nvarying vec3 v_Barycentric;\n\nvoid main() {\n    if (any(lessThan(v_Barycentric, vec3(0.1)))) {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n    } else {\n        gl_FragColor = vec4(v_Color, 1.0);\n    }\n}\n"})),i.d(e,"DiffuseUniform",(function(){return ze})),i.d(e,"uniforms",(function(){return Pe})),i.d(e,"ModelMatrixUniform",(function(){return be})),i.d(e,"NormalMatrixUniform",(function(){return Se})),i.d(e,"ProjectionMatrixUniform",(function(){return Ae})),i.d(e,"ViewMatrixUniform",(function(){return Ee})),i.d(e,"WebGLUniform",(function(){return we}))}])}));